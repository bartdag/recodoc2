<!DOCTYPE html>













 
 
 
 
 





<html>
  <head>
    
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<title>Coding Basics - History - Google Web Toolkit - Google Code</title>
<script type="text/javascript"><!--
(function(){function a(){this.t={};this.tick=function(c){this.t[c]=(new Date).getTime()};this.tick("start")}var b=new a;window.jstiming={Timer:a,load:b};if(window.external&&window.external.pageT)window.jstiming.pt=window.external.pageT;})();

var _tocPath_ = '/webtoolkit/_doc_toc.ezt';
var codesite_token = null;
var logged_in_user_email = null;
//--></script>
<link href="/css/codesite.pack.04102009.css" type="text/css" rel="stylesheet">
<script src="/js/codesite_head.pack.04102009.js" type="text/javascript"></script>
<script type="text/javascript">CODESITE_CSITimer['load'].tick('bhs');</script>
<link rel="search" type="application/opensearchdescription+xml" title="Google Code" href="/osd.xml">

<!--[if IE]><link rel="stylesheet" type="text/css" href="/css/iehacks.css"><![endif]-->

    <link href="/css/semantic_headers.css" rel="stylesheet" type="text/css" />
       <link href="/webtoolkit/css/local_extensions.css" rel="stylesheet" type="text/css"/>
  </head>

  <body class="gc-documentation">
    
    

    <div id="gb">
 <span>
  
   
    <a href="#"
       id="projects-dropdown" onclick="return false;"
       ><span style="text-decoration:underline">My favorites</span> <span style="font-size:.75em;">&#9660;</span></a>
    |
  
    <a id="lang-dropdown" href="/" onclick="return false;"><span style="text-decoration:underline">English</span> <span style="font-size:.75em;">&#9660;</span></a>
  
   
    | <a href="https://www.google.com/accounts/Login?continue=http%3A%2F%2Fcode.google.com%2Fwebtoolkit%2Fdoc%2Flatest%2FDevGuideCodingBasicsHistory.html&amp;followup=http%3A%2F%2Fcode.google.com%2Fwebtoolkit%2Fdoc%2Flatest%2FDevGuideCodingBasicsHistory.html" onclick="CODESITE_click('/gb/sc/signin');"><span style="style:text-decoration:underline">Sign in</span></a>
   
  
 </span>
</div>

<div class="gbh" style="left:0px;"></div>
<div class="gbh" style="right:0px;"></div>

<div id="gc-container">
<a id="top"></a>
<div id="skipto">
  <a href="#gc-pagecontent">Skip to page content</a>
  <a href="#gc-toc">Skip to main navigation</a>
</div>

<div id="gc-header">
  <div id="logo"><a href="/">
  
  
     <img src="//www.google.com/images/logos/code_logo.gif" height="40" width="167" alt="Google Code" style="border:0;margin:3px 0 0 0;">
  
  
  </a></div>
  <div id="search">
    <div id="searchForm" class="searchForm">
      <form id="cse" action="http://www.google.com/cse" accept-charset="utf-8" class="gsc-search-box" onsubmit="executeGSearch(document.getElementById('gsearchInput').value); return false;">
      <noscript>
      <input type="hidden" name="cref" value="http://code.google.com/cse/googlecode-context.xml">
      </noscript>
      <div id="gsc-search-box">
        <input id="gsearchInput" type="text" name="q" maxlength="2048" class="gsc-input" autocomplete="off" title="Google Code Search" style="width:345px">
        <div id="cs-searchresults" onclick="event.cancelBubble = true;"></div>
        <input title="Search" id="gsearchButton" class="gsc-search-button" name="sa" value="Search" type="submit">
        <div class="greytext">e.g. "ajax apis" or "open source"</div>
      </div>
      </form>
    </div> <!-- end searchForm -->
  </div> <!-- end search -->




</div> <!-- end gc-header -->


<div id="codesiteContent">

<a id="gc-topnav-anchor"></a>
<div id="gc-topnav">
  <h1 style="padding:0 0 0 6px;">Google Web Toolkit</h1>
  <ul id="docs" class="gc-topnav-tabs">

    <li id="home_link">
      <a href="/webtoolkit/" title="Google Web Toolkit home page">Home</a>
    </li>
  
    <li id="docs_link">
      <a href="/webtoolkit/overview.html" class="selected" title="Official Google Web Toolkit documentation">Docs</a>
    </li>
  
    <li>
      <a href="http://googlewebtoolkit.blogspot.com/" title="Official Google Web Toolkit blog">Blog</a>
    </li>
  
    <li>
      <a href="/webtoolkit/community.html" title="Community home for Google Web Toolkit">Community</a>
    </li>
  
    <li>
      <a href="/webtoolkit/terms.html" title="Google Web Toolkit terms of service">Terms</a>
    </li>
  
    <li>
      <a href="/webtoolkit/download.html" title="Download Google Web Toolkit">Download</a>
    </li>
  

  </ul>
</div> <!-- end gc-topnav -->


    <div class="g-section g-tpl-230">

      <div class="g-unit g-first" id="gc-toc">
        <ul>
  <li>
    <ul>
      <li><a href="/webtoolkit/download.html">Downloads</a></li>
    </ul>
  </li>
</ul>

<div class="line"></div>

<ul>
  <li><h2>Learn More</h2>
    <ul>
      <li><a href="/webtoolkit/overview.html">Overview</a></li>
      <li><a href="/webtoolkit/business.html">Business Apps</a></li>
      <li><a href="/webtoolkit/learnmore-sdk.html">SDK</a></li>
      <li><a href="/webtoolkit/speedtracer/">Speed Tracer</a></li>
      <li><a href="/eclipse/index.html">Plugin for Eclipse</a></li>
      <li><a href="/webtoolkit/examples/">Examples</a></li>
    </ul>
  </li>
    <li><h2>Get Started</h2>
    <ul>
      <li><a href="/webtoolkit/gettingstarted.html">SDK</a></li>
      <li><a href="/webtoolkit/usingeclipse.html">Set up Eclipse</a></li>
      <li><a href="/webtoolkit/speedtracer/get-started.html">Speed Tracer</a></li>
      <li><a href="/webtoolkit/doc/latest/tutorial/index.html">Tutorials</a>
        <ul>
          <li><a href="/webtoolkit/doc/latest/tutorial/gettingstarted.html">Get Started</a>
            <ul>
              <li><a href="/webtoolkit/doc/latest/tutorial/create.html">Create a GWT Project</a></li>
              <li><a href="/webtoolkit/doc/latest/tutorial/design.html">Design the Application</a></li>
              <li><a href="/webtoolkit/doc/latest/tutorial/buildui.html">Build the User Interface</a></li>
              <li><a href="/webtoolkit/doc/latest/tutorial/manageevents.html">Manage Events on the Client</a></li>
              <li><a href="/webtoolkit/doc/latest/tutorial/codeclient.html">Code Functionality on the Client</a></li>
              <li><a href="/webtoolkit/doc/latest/tutorial/debug.html">Debug a GWT Application</a></li>
              <li><a href="/webtoolkit/doc/latest/tutorial/style.html">Apply Style</a></li>
              <li><a href="/webtoolkit/doc/latest/tutorial/compile.html">Compile a GWT Application</a></li>
            </ul>
          </li>
          <li><a href="/webtoolkit/doc/latest/tutorial/i18n.html">Internationalization</a></li>
          <li><a href="/webtoolkit/doc/latest/tutorial/clientserver.html">Client-Server Communication</a>
            <ul>
              <li><a href="/webtoolkit/doc/latest/tutorial/RPC.html">GWT RPC</a></li>
              <li><a href="/webtoolkit/doc/latest/tutorial/JSON.html">JSON</a></li>
              <li><a href="/webtoolkit/doc/latest/tutorial/JSONphp.html">JSON - PHP</a></li>
              <li><a href="/webtoolkit/doc/latest/tutorial/Xsite.html">Cross-Site</a></li>
            </ul>
          </li>
          <li><a href="/webtoolkit/doc/latest/tutorial/JUnit.html">JUnit Testing</a></li>
          <li><a href="/webtoolkit/doc/latest/tutorial/appengine.html">Google App Engine</a></li>
          <li><a href="/webtoolkit/doc/latest/tutorial/mvp-architecture.html">MVP Architecture</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><h2>Documentation</h2>
    <ul>
      <li><a href="/webtoolkit/doc/latest/ReleaseNotes.html">What's Coming in 2.1?</a>
        <ul>
          <li><a href="/webtoolkit/release-notes.html">Release Notes</a></li>
        </ul>
      </li>
      <li><a href="/webtoolkit/doc/latest/DevGuideOrganizingProjects.html">Organize Projects</a></li>
      <li><a href="/webtoolkit/doc/latest/DevGuideCompilingAndDebugging.html">Compile &amp; Debug</a></li>
      <li><a href="/webtoolkit/doc/latest/DevGuideCodingBasics.html">Coding Basics</a>
        <ul>
          <li><a href="/webtoolkit/doc/latest/DevGuideCodingBasicsClient.html">Client-Side Code</a></li>
          <li><a href="/webtoolkit/doc/latest/DevGuideCodingBasicsCompatibility.html">Compatibility with the Java Language and Libraries</a></li>
          <li><a href="/webtoolkit/doc/latest/DevGuideCodingBasicsHistory.html">History</a></li>
          <li><a href="/webtoolkit/doc/latest/DevGuideCodingBasicsFormatting.html">Number and Date Formatting</a></li>
          <li><a href="/webtoolkit/doc/latest/DevGuideCodingBasicsDelayed.html">Programming Delayed Logic</a></li>
          <li><a href="/webtoolkit/doc/latest/DevGuideCodingBasicsJSON.html">Working with JSON</a></li>
          <li><a href="/webtoolkit/doc/latest/DevGuideCodingBasicsXML.html">Working with XML</a></li>
          <li><a href="/webtoolkit/doc/latest/DevGuideCodingBasicsJSNI.html">JavaScript Native Interface (JSNI)</a></li>
          <li><a href="/webtoolkit/doc/latest/DevGuideCodingBasicsOverlay.html">JavaScript Overlay Types</a></li>
          <li><a href="/webtoolkit/doc/latest/DevGuideCodingBasicsDeferred.html">Deferred Binding</a></li>
        </ul>
      </li>
      <li><a href="/webtoolkit/doc/latest/DevGuideUi.html">Build User Interfaces</a>
        <ul>
          <li><a href="/webtoolkit/doc/latest/DevGuideUiBrowser.html">Cross-Browser Support</a></li>
          <li><a href="/webtoolkit/doc/latest/DevGuideUiPanels.html">Layout Using Panels</a></li>
          <li><a href="/webtoolkit/doc/latest/DevGuideUiWidgets.html">Widgets</a></li>
          <li><a href="/webtoolkit/doc/latest/DevGuideUiCustomWidgets.html">Creating Custom Widgets</a></li>
          <li><a href="/webtoolkit/doc/latest/DevGuideUiDom.html">Working with the DOM</a></li>
          <li><a href="/webtoolkit/doc/latest/DevGuideUiHandlers.html">Events and Handlers</a></li>
          <li><a href="/webtoolkit/doc/latest/DevGuideUiCss.html">Working with CSS</a></li>
          <li><a href="/webtoolkit/doc/latest/DevGuideUiBinder.html">Declarative UI with UiBinder</a></li>
          <li><a href="/webtoolkit/doc/latest/DevGuideUiImageBundles.html">Bundling Image Resources</a></li>
        </ul>
      </li>
      <li><a href="/webtoolkit/doc/latest/DevGuideA11y.html">Accessibility</a></li>
      <li><a href="/webtoolkit/doc/latest/DevGuideI18n.html">Internationalization</a>
        <ul>
         <li><a href="/webtoolkit/doc/latest/DevGuideI18nLocale.html">Locale</a></li>
         <li><a href="/webtoolkit/doc/latest/DevGuideI18nConstants.html">Constants</a></li>
         <li><a href="/webtoolkit/doc/latest/DevGuideI18nMessages.html">Messages</a></li>
         <li><a href="/webtoolkit/doc/latest/DevGuideI18nPluralForms.html">Plural Forms</a></li>
         <li><a href="/webtoolkit/doc/latest/DevGuideUiBinderI18n.html">UiBinder</a></li>
        </ul>
      </li>
      <li><a href="/webtoolkit/doc/latest/DevGuideServerCommunication.html">Communicate with a Server</a></li>
      <li><a href="/webtoolkit/doc/latest/DevGuideTesting.html">Test with JUnit</a>
        <ul>
          <li><a href="/webtoolkit/doc/latest/DevGuideTestingHtmlUnit.html">HtmlUnit</a></li>
          <li><a href="/webtoolkit/doc/latest/DevGuideTestingRemoteTesting.html">Remote Testing</a></li>
          <li><a href="/webtoolkit/doc/latest/DevGuideTestingCoverage.html">Code Coverage</a></li>
        </ul>
      </li>
      <li><a href="/webtoolkit/doc/latest/DevGuideDeploying.html">Deploy</a></li>
      <li><a href="/webtoolkit/doc/latest/DevGuideOptimizing.html">Optimize</a>
        <ul>
          <li><a href="/webtoolkit/doc/latest/DevGuideCodeSplitting.html">Code Splitting</a></li>
          <li><a href="/webtoolkit/doc/latest/DevGuideCompileReport.html">Compile Report</a></li>
          <li><a href="/webtoolkit/doc/latest/DevGuideClientBundle.html">Client Bundle</a></li>
          <li><a href="/webtoolkit/doc/latest/DevGuideLightweightMetrics.html">Lightweight Metrics</a></li>
        </ul>
      </li>
      <li><a href="/webtoolkit/doc/latest/RefGuide.html">Reference</a>
        <ul>
          <li><a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.1/index.html?overview-summary.html">SDK API Reference (Javadoc)</a></li>
          <li><a href="/webtoolkit/doc/latest/RefJreEmulation.html">JRE Emulation Reference</a></li>
          <li><a href="/webtoolkit/doc/latest/RefWidgetGallery.html">Widget List</a></li>
        </ul>
      </li>
      <li><a href="/webtoolkit/doc/latest/FAQ.html">FAQ</a>
        <ul>
          <li><a href="/webtoolkit/doc/latest/FAQ_GettingStarted.html">Get Started</a></li>
          <li><a href="/webtoolkit/doc/latest/FAQ_DebuggingAndCompiling.html">Debug and Compile</a></li>
          <li><a href="/webtoolkit/doc/latest/FAQ_UI.html">Build the User Interface</a></li>
          <li><a href="/webtoolkit/doc/latest/FAQ_Client.html">Develop Client-side Code</a></li>
          <li><a href="/webtoolkit/doc/latest/FAQ_Server.html">Communicate with a Server</a></li>
          <li><a href="/webtoolkit/doc/latest/FAQ_Troubleshooting.html">Troubleshoot</a></li>
        </ul>
      </li>
      <li><a href="/webtoolkit/doc/latest/DevGuideGlossary.html">Glossary</a></li>
      <li><a href="/webtoolkit/previousdocs.html">Docs for Previous Versions</a></li>
    </ul>
  </li>
  <li><h2>Tools</h2>
    <ul>
      <li><a href="/eclipse/">Plugin for Eclipse</a></li>    
      <li><a href="/webtoolkit/doc/latest/RefCommandLineTools.html">SDK Command-line Tools</a></li>
      <li><a href="/webtoolkit/speedtracer/">Speed Tracer</a>
        <ul>
          <li><a href="/webtoolkit/speedtracer/get-started.html">Getting Started</a></li>
          <li><a href="/webtoolkit/speedtracer/speed-tracer-examples.html">Examples</a></li>
          <li><a href="/webtoolkit/speedtracer/hint-description.html">Hints</a></li>
          <li><a href="/webtoolkit/speedtracer/data-dump-format.html">Data Dump Format</a></li>
          <li><a href="/webtoolkit/speedtracer/logging-api.html">Logging API</a></li>
          <li><a href="/webtoolkit/speedtracer/faq.html">FAQ</a></li>
        </ul>
      </li>
      <li><a href="/webtoolkit/tools/gwtdesigner/index.html">GWT Designer</a></li>
      <li><a href="/webtoolkit/tools/wbpro/index.html">WindowBuilder Pro</a></li>
      <li><a href="/webtoolkit/tools/wintester/html/index.html">WindowTester Pro</a></li>
      <li><a href="/webtoolkit/tools/codepro/doc/index.html">CodePro AnalytiX</a></li>
    </ul>
  </li>



  <li><h2>Resources</h2>
    <ul>
      <li><a href="/webtoolkit/articles.html">Articles</a></li>
      <li><a href="/webtoolkit/books.html">Books</a></li>
      <li><a href="/webtoolkit/community.html">Community</a>
        <ul>
          <li><a href="http://gwtgallery.appspot.com">App Gallery</a></li>
          <li><a href="/webtoolkit/developer_spotlight.html">Developer Spotlight</a></li>
         </ul>
      </li>
      <li><a href="/webtoolkit/googleapilibraries.html">Google API Libraries</a></li>
      <li><a href="/webtoolkit/tools.html">Tools &amp; Libraries</a></li>
      <li><a href="/webtoolkit/media_gallery.html">Presentations</a></li>
      <li><a href="/webtoolkit/makinggwtbetter.html">Making GWT Better</a></li>
      <li><a href="/webtoolkit/lifeofanissue.html">Issue Tracking</a></li>
    </ul>
  </li>
</ul>



        <a class="hidden" href="#gc-topnav-anchor">More Google Web Toolkit resource links</a>
      </div>

      <div class="g-unit" id="gc-pagecontent">
        <script type="text/javascript">CODESITE_docEarlyProcessing();</script>


        <h1 class="page_title">Coding Basics - History</h1>




<p>Ajax applications sometimes fail to meet user's expectations because they do not interact with the browser in the same way as static web pages. This is often apparent &mdash; and
frustrating for users &mdash; when an Ajax application does not integrate with browser history. For example, users expect browsers to be able to navigate back to previous pages visited
using back and forward actions. Because an Ajax application is a usually single page running JavaScript logic and not a series of pages, the browser history needs help from the
application to support this use case. Thankfully, GWT's history mechanism makes history support fairly straightforward.</p>

<ol class="toc" id="pageToc">
  <li><a href="#mechanism">The GWT History Mechanism</a></li>
  <li><a href="#tokens">History Tokens</a></li>
  <li><a href="#example">Example</a></li>
  <li><a href="#widgets">Hyperlink Widgets</a></li>
  <li><a href="#stateful">Stateful applications</a></li>
  <li><a href="#onvaluechange">Handling an onValueChange() callback</a></li>
</ol>


<h2 id="mechanism">The GWT History Mechanism</h2>

<p>GWT's History mechanism has a lot in common with other Ajax history implementations, such as <a href="http://code.google.com/p/reallysimplehistory">RSH (Really
Simple History)</a>. The basic premise is to keep track of the application's &quot;internal state&quot; in the url fragment identifier. This works because updating the fragment doesn't
typically cause the page to be reloaded.</p>

<p>This approach has several benefits:</p>

<ul>
<li>It's about the only way to control the browser's history reliably.</li>

<li>It provides good feedback to the user.</li>

<li>It's &quot;bookmarkable&quot;. I.e., the user can create a bookmark to the current state and save it, email it, et cetera.</li>
</ul>



<h2 id="tokens">History Tokens</h2>

<p>GWT includes a mechanism to help Ajax developers activate browser history. For each page that is to be navigable in the history, the application should generate a unique
history token. A token is simply a string that the application can parse to return to a particular state. This token will be saved in browser history as a URL fragment (in the
location bar, after the &quot;#&quot;), and this fragment is passed back to the application when the user goes back or forward in history, or follows a link.</p>

<p>For example, a history token named &quot;page1&quot; would be added to a URL as follows:</p>

<pre class="prettyprint">
http://www.example.com/com.example.gwt.HistoryExample/HistoryExample.html#page1
</pre>

<p>When the application wants to push a placeholder onto the browser's history stack, it simply invokes <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.0/com/google/gwt/user/client/History.html#newItem(java.lang.String)">History.newItem(token)</a>. When
the user uses the back button, a call will be made to any object that was added as a handler with <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.0/com/google/gwt/user/client/History.html#addValueChangeHandler(com.google.gwt.event.logical.shared.ValueChangeHandler)">History.addValueChangeHandler()</a>. It is up to the application to restore the state according to the value of the new token.</p>

<h2 id="example">Example</h2>

<p>To use GWT History support, you must first embed an iframe into your <a href="DevGuideOrganizingProjects.html#DevGuideHostPage">host HTML page</a>.</p>

<pre class="prettyprint">
  &lt;iframe src=&quot;javascript:''&quot;
          id=&quot;__gwt_historyFrame&quot;
          style=&quot;width:0;height:0;border:0&quot;&gt;&lt;/iframe&gt;
</pre>

<p>Then, in your GWT application, perform the following steps:</p>

<ul>
<li>Add a history token to the history stack when you want to enable a history event.</li>

<li>Create an object that implements the <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.0/com/google/gwt/event/logical/shared/ValueChangeHandler.html">ValueChangeHandler</a> interface, parses the new token (available by calling <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.0/com/google/gwt/event/logical/shared/ValueChangeEvent.html#getValue()">ValueChangeEvent.getValue()</a>) and changes the application state to match.</li>
</ul>

<p>The following short example shows how to add a history event each time the user selects a new tab in a <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.0/com/google/gwt/user/client/ui/TabPanel.html">TabPanel</a>.</p>

<pre class="prettyprint">
import com.google.gwt.core.client.EntryPoint;
import com.google.gwt.event.logical.shared.SelectionEvent;
import com.google.gwt.event.logical.shared.SelectionHandler;
import com.google.gwt.event.logical.shared.ValueChangeEvent;
import com.google.gwt.event.logical.shared.ValueChangeHandler;
import com.google.gwt.user.client.History;
import com.google.gwt.user.client.ui.HTML;
import com.google.gwt.user.client.ui.RootPanel;
import com.google.gwt.user.client.ui.TabPanel;

/**
 * Entry point classes define &lt;code&gt;onModuleLoad()&lt;/code&gt;.
 */
public class BrowserHistoryExample implements EntryPoint {

  TabPanel tabPanel;
  /**
   * This is the entry point method.
   */
  public void onModuleLoad() {
    tabPanel = new TabPanel();

    tabPanel.add(new HTML(&quot;&lt;h1&gt;Page 0 Content: Llamas&lt;/h1&gt;&quot;), &quot; Page 0 &quot;);
    tabPanel.add(new HTML(&quot;&lt;h1&gt;Page 1 Content: Alpacas&lt;/h1&gt;&quot;), &quot; Page 1 &quot;);
    tabPanel.add(new HTML(&quot;&lt;h1&gt;Page 2 Content: Camels&lt;/h1&gt;&quot;), &quot; Page 2 &quot;);

    tabPanel.addSelectionHandler(new SelectionHandler&lt;Integer&gt;(){
      public void onSelection(SelectionEvent&lt;Integer&gt; event) {
        // TODO Auto-generated method stub
        History.newItem(&quot;page&quot; + event.getSelectedItem());
      }});

    History.addValueChangeHandler(new ValueChangeHandler&lt;String&gt;() {
      public void onValueChange(ValueChangeEvent&lt;String&gt; event) {
        String historyToken = event.getValue();

        // Parse the history token
        try {
          if (historyToken.substring(0, 4).equals(&quot;page&quot;)) {
            String tabIndexToken = historyToken.substring(4, 5);
            int tabIndex = Integer.parseInt(tabIndexToken);
            // Select the specified tab panel
            tabPanel.selectTab(tabIndex);
          } else {
            tabPanel.selectTab(0);
          }

        } catch (IndexOutOfBoundsException e) {
          tabPanel.selectTab(0);
        }
      }
    });

    tabPanel.selectTab(0);
    RootPanel.get().add(tabPanel);
  }
}
</pre>

<h2 id="widgets">Hyperlink Widgets</h2>

<p>Hyperlinks are convenient to use to incorporate history support into an application. Hyperlink widgets are GWT widgets that look like regular HTML anchors. You can associate a
history token with the <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.0/com/google/gwt/user/client/ui/Hyperlink.html">Hyperlink</a>, and when it is
clicked, the history token is automatically added to the browser's history stack. The <tt>History.newItem(token)</tt> step is done automatically.</p>

<h2 id="stateful">Stateful applications</h2>

<p>Special care must be taken in handling history for applications that store state. Enough information must be coded into the history token to restore the application state back
to the point at which the history token was set. The application must also be careful to clear away any state not relevant to navigating back to a previously visited page.</p>

<p>As an example, an application that presents a multi-page questionnaire could encode the page number as a token as well as some other states. When a new page in the
questionnaire is presented, a history token is added to the history stack. Note that with stateful applications, such as a questionnaire, some careful thought needs to be given to
implementing the history callback. When returning to a page using a token, some logic needs to restore the previous state.</p>

<table>
<tr>
<td style="border: 1px solid #aaa; padding: 5px;">Token</td>
<td style="border: 1px solid #aaa; padding: 5px;">Action</td>
</tr>

<tr>
<td style="border: 1px solid #aaa; padding: 5px;">&quot;info&quot;</td>
<td style="border: 1px solid #aaa; padding: 5px;">Navigate to page where user enters biographic info. Restore previously entered data</td>
</tr>

<tr>
<td style="border: 1px solid #aaa; padding: 5px;">&quot;page1&quot;</td>
<td style="border: 1px solid #aaa; padding: 5px;">Navigate to page 1 in the questionnaire. Restore previous answers.</td>
</tr>

<tr>
<td style="border: 1px solid #aaa; padding: 5px;">&quot;page2&quot;</td>
<td style="border: 1px solid #aaa; padding: 5px;">Navigate to page 2 in the questionnaire. Restore previous answers.</td>
</tr>

<tr>
<td style="border: 1px solid #aaa; padding: 5px;">&quot;page&quot;

<pre>
<span class="error">&lt;n&gt;</span>
</pre>
</td>
<td style="border: 1px solid #aaa; padding: 5px;">Navigate to page

<pre>
<span class="error">&lt;n&gt;</span>
</pre>

...</td>
</tr>

<tr>
<td style="border: 1px solid #aaa; padding: 5px;">&quot;end&quot;</td>
<td style="border: 1px solid #aaa; padding: 5px;">Navigate to the end of the questionnaire. Validate that all questions were answered. Make sure not to re-submit the
questionnaire.</td>
</tr>
</table>



<p>In the above case, navigating back to a page would be possible, but there isn't enough information in the history token to restore the user's previous answers. A better
encoding for the token would be a syntax such as:</p>

<pre class="prettyprint">
  page=&lt;pagename&gt;;session=&lt;sessionname&gt;
</pre>

<p>Where <tt>&lt;pagename&gt;</tt> tells the application which page to go to and <tt>&lt;sessionname&gt;</tt> is a key to finding the user's previously entered data in a
database.</p>

<h2 id="onvaluechange">Handling an onValueChange() callback</h2>

<p>The first step of handling the <tt>onValueChange()</tt> callback method in a <tt>ValueChangeHandler</tt> is to get the new history token with <a href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.0/com/google/gwt/event/logical/shared/ValueChangeEvent.html#getValue()">ValueChangeEvent.getValue()</a>; you'll then want to parse the token. Keep in mind that your parsing needs to be robust! A user may type a URL by hand or have a URL
stored from an old version of your application. Once the token is parsed, you can reset the state of the application.</p>

<p>When the <tt>onValueChange()</tt> method is invoked, your application must handle two cases:</p>

<ol>
<li>The application was just started and was passed a history token.</li>

<li>The application is already running and was passed a history token.</li>
</ol>

<p>In the first case, the application must properly initialize itself before handing the state token. In the second case, some parts of the application may need to be
re-initialized.</p>




      </div><!-- end gc-pagecontent -->
   </div><!-- end gooey wrapper -->

    </div> <!-- end codesite content -->


<div id="gc-footer" dir="ltr">
  <div class="text">
    
      <div class="notice"><div id="notice" style="text-align: center; border: 1em 0em 1em 0em">
  Except as otherwise <a
  href="http://code.google.com/policies.html#restrictions">noted</a>,
  the content of this page is licensed under the <a rel="license"
  href="http://creativecommons.org/licenses/by/3.0/">Creative Commons
  Attribution 3.0 License</a>.
<!-- <rdf:RDF xmlns="http://web.resource.org/cc/" 
              xmlns:dc="http://purl.org/dc/elements/1.1/"
              xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
  <Work rdf:about="">
    <license rdf:resource="http://creativecommons.org/licenses/by/3.0/" />
  </Work>
  <License rdf:about="http://creativecommons.org/licenses/by/3.0/">
    <permits rdf:resource="http://web.resource.org/cc/Reproduction"/>
    <permits rdf:resource="http://web.resource.org/cc/Distribution"/>
    <requires rdf:resource="http://web.resource.org/cc/Notice"/>
    <requires rdf:resource="http://web.resource.org/cc/Attribution"/>
    <permits rdf:resource="http://web.resource.org/cc/DerivativeWorks"/>
  </License>
</rdf:RDF> -->
</div>
</div>
    
    &copy;2010 Google -
    <a href="/">Code Home</a> -
    <a href="/terms.html">Terms of Service</a> -
    <a href="/privacy.html">Privacy Policy</a> -
    <a href="/more/">Site Directory</a>
    <br> <br>
    Google Code offered in:
    <a href="/intl/en/">English</a> -
    <a href="/intl/es/">Español</a> -
    <a href="/intl/ja/">日本語</a> -
    <a href="/intl/ko/">한국어</a> -
    <a href="/intl/pt-BR/">Português</a> -
    <a href="/intl/ru/">Pусский</a> -
    <a href="/intl/zh-CN/">中文(简体)</a> -
    <a href="/intl/zh-TW/">中文(繁體)</a>
  </div>
</div><!-- end gc-footer -->

</div><!-- end gc-container -->

<script type="text/javascript">CODESITE_CSITimer['load'].tick('ats');</script>
<script src="/js/codesite_tail.pack.04102009.js" type="text/javascript"></script>




<script type="text/javascript">
var _gaq = _gaq || [];

_gaq.push(


    ['siteTracker._setAccount', 'UA-18071-1'],
    ['siteTracker._setDomainName', 'code.google.com'],
    ['siteTracker._setCookiePath', window.location.pathname.substring(0,
        window.location.pathname.lastIndexOf('/') + 1)],
    ['siteTracker._trackPageview']
);
(function() {
  var ga = document.createElement('script');

  ga.type = 'text/javascript';
  ga.async = true;
  ga.src = 'http://www.google-analytics.com/ga.js';
  (document.getElementsByTagName('head')[0] ||
   document.getElementsByTagName('body')[0]).appendChild(ga);
 })();
</script>




  </body>
</html>

