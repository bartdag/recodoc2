<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<html lang="en-US">
    <head>
        <title>Converting Legacy Code to Use Generics (The Java&trade; Tutorials &gt;        
            Bonus &gt; Generics)
</title>

     <meta name="description" content="This Java tutorial describes generics, full screen mode API, and Java certification related resources" />
     <meta name="keywords" content="java programming, learn java, java sample code, java generics, full screen mode API, certification" />
        
<style type="text/css">
    .FigureCaption   { 
        margin-left: 1in; 
        margin-right: 1in; 
        font-family: sans-serif; 
        font-size: smaller; 
        text-align: justify;
    }
    #TopBar_bl {
        background: url(../../images/java_bar_bl.gif) 0 100% no-repeat;
        width: 100%;
        height: 60px;
    }
    #TopBar_br {
        background: url(../../images/java_bar_br.gif) 100% 100% no-repeat;
        width: 100%;
        height: 60px;
    }
    #TopBar_tl {
        background: url(../../images/java_bar_tl.gif) 0 0 no-repeat;
        width: 100%;
        height: 60px;
    }
    #TopBar_tr {
        background: url(../../images/java_bar_tr.gif) 100% 0 no-repeat;
        width: 100%;
        height: 60px;
    }
    #TopBar {
        background: #35556B url(../../images/java_bar.gif);
        margin: 10px 10px 0 10px;
        height:60px;
        min-width:700px;
        color: white;
        font-family: sans-serif; 
        font-weight: bold;
    }
    @media print {
        #BreadCrumbs, #Download {
            display: none;
        }
    }
    #TopBar_right {
        line-height: 14px;
        float: right;
        padding-top: 2px;
        padding-right: 30px;
        text-align: center;
    }
    @media print {
        #TopBar_right {
            display: none;
        }
    }
    #TopBar_right a {
        font-size: 12px;
        margin: 3px;
        padding: 0;
    }
    #TopBar a:visited, #TopBar a:link {
        color: white;
        text-decoration: none;
    }
    #TopBar a:hover, #TopBar a:active  {
        background-color: white;
        color: #35556B;
    }
    #BreadCrumbs {
        padding: 4px 5px 0.5em 0;
        font-family: sans-serif; 
        float: right;
    }
    #BreadCrumbs a {
        color: blue;
    }
    #BreadCrumbs a:visited, #BreadCrumbs a:link {
        text-decoration: none;
    }
    #BreadCrumbs a:hover, #BreadCrumbs a:active {
        text-decoration: underline;
    }
    #PageTitle {
        margin: 0 5px 0.5em 0;
        color: #F90000;
    }    
    #PageContent{
        margin: 0 5px 0 20px;
    }
    .LeftBar_shown {
        width: 13em;
        float: left;
        margin-left: 10px;
        margin-top: 4px;
        margin-bottom: 2em;
        margin-right: 10px;
    }
    @media print {
        .LeftBar_shown {
            display: none;
        }
    }
    .LeftBar_hidden {
        display: none;
    }
    #Footer {
        padding-top: 10px;
        padding-left: 10px;
        margin-right: 10px;
    }
    
    .footertext {
        font-size: 10px;
        font-family: sans-serif; 
        margin-top: 1px;
    }
    
    #Footer2 {
        padding-top: 10px;
        padding-left: 10px;
        margin-right: 10px;
    }
    .NavBit  {
        padding: 4px 5px 0.5em 0;
        font-family: sans-serif; 
    }
    @media print {
        .NavBit {
            display: none;
        }
    }
    #TagNotes {
        text-align: right;        
    }
    
    @media print {
        #TagNotes a:visited, #TagNotes a:link {
            color: #35556B;
            text-decoration: none;
        }
    }
    #Contents a, .NavBit a, #TagNotes a {
        color: blue
    }
    #TagNotes a:visited, #TagNotes a:link,
    #Contents a:visited, #Contents a:link,
    .NavBit a:visited, .NavBit a:link {
        text-decoration: none;
    }
    #TagNotes a:hover, #TagNotes a:active,   
    #Contents a:hover, #Contents a:active,   
    .NavBit a:hover, .NavBit a:active {  
        text-decoration: underline;
    }
    #Contents {
        float: left;
        font-family: sans-serif; 
    }
    @media print {
        #Contents {
            display: none;
        }
    }
    @media screen {
        div.PrintHeaders {
            display: none;
        }
    }
    .linkLESSON, .nolinkLESSON {
        margin-left: 0.5em;
        text-indent: -0.5em
    }
    .linkAHEAD, .nolinkAHEAD, .linkQUESTIONS, .nolinkQUESTIONS   {
        margin-left: 1.5em; 
        text-indent: -0.5em
    }
    .linkBHEAD, .nolinkBHEAD   {
        margin-left: 2.5em;
        text-indent: -0.5em
    }
    .linkCHEAD, .nolinkCHEAD   {
        margin-left: 3.5em;
        text-indent: -0.5em
    }
    .nolinkLESSON, .nolinkAHEAD, .nolinkBHEAD, .nolinkCHEAD,
    .nolinkQUESTIONS {
        font-weight: bold;
        color: #F90000;
    }
    .MainFlow_indented {
        margin-right: 10px;
        margin-left: 15em;
        margin-bottom: 2em;

    }
    .MainFlow_wide {
        margin-right: 10px;
        margin-left: 10px;
        margin-bottom: 2em;

    }
    @media print {
        .MainFlow_indented, .MainFlow_wide {
            padding-top: 0;
            margin-top: 10px;
            margin-right: 10px;
            margin-left: 0;
        }
    }
    h1, h2, h3, h4, h5 {
        color: #F90000;
        font-family: sans-serif;
    }

    h1 {
        font-weight: bold;
        font-size: 20px;
    }

    h2 {
        font-weight: bold;
        font-size: 17px;
    }

    h3 {
        font-weight: bold;
        font-size: 14px;
    }

    h4 {
        font-size: 15px;
    }

    h5 {
        font-size: 12px;
    }


    #ToggleLeft {
        display: none;
    }
    
    .note {
        margin: 0 30px 0px 30px;
    }
    
    .codeblock {
        margin: 0 30px 0px 30px;
    }

    /t

</style>
<script type="text/javascript">
    function leftBar() {
        var nameq = 'tutorial_showLeftBar='
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
            var cookieString = cookies[i];
            while (cookieString.charAt(0) == ' ') {
                cookieString = cookieString.substring(1, cookieString.length);
            }
            if (cookieString.indexOf(nameq) == 0) {
                cookieValue =  cookieString.substring(nameq.length,
                        cookieString.length);
                return cookieValue == 'yes';
            }
        }
        return true;
    }

    function showLeft(b) {
        var contents = document.getElementById("LeftBar");
        var main = document.getElementById("MainFlow");
        var toggle = document.getElementById("ToggleLeft");
        if (b) {
            contents.className = "LeftBar_shown";
            main.className = "MainFlow_indented";
            toggle.innerHTML = "Hide the TOC";
            document.cookie = 'tutorial_showLeftBar=yes; path=/';
        } else {
            contents.className = "LeftBar_hidden";
            main.className = "MainFlow_wide";
            toggle.innerHTML = "Show the TOC";
            document.cookie = 'tutorial_showLeftBar=no; path=/';
        }
    }

    function toggleLeft() {
        showLeft(document.getElementById("LeftBar").className ==
                "LeftBar_hidden");
        document.getElementById("ToggleLeft").blur();
    }

    function load() {
        showLeft(leftBar());
        document.getElementById("ToggleLeft").style.display="inline";
    }
    
</script>
<noscript> 
A browser with JavaScript enabled is required for this page to operate properly.
</noscript>

    </head>
<body onload="load()">
    <div id=TopBar> <div id=TopBar_tr> <div id=TopBar_tl> <div id=TopBar_br> <div id=TopBar_bl> 
                        <div id=TopBar_right> 
                            <a target="_blank"
                                href="http://java.sun.com/javase/6/download.jsp">Download
                                the JDK</a>
                            <br>
                            <a href="../../search.html" target="_blank">Search the
                                Tutorials</a>
                            <br>
                            <a href="javascript:toggleLeft()"
                                id="ToggleLeft">Hide the TOC</a>
                        </div>
                    </div> </div> </div> </div> </div>
    <div class=PrintHeaders>
        <b>Trail:</b> Bonus
        <br><b>Lesson:</b> Generics
    </div>

    <div id=LeftBar class=LeftBar_shown>
        <div id=Contents>
            <div class="linkLESSON"><a href="index.html">Generics</a></div>
<div class="linkAHEAD"><a href="intro.html">Introduction</a></div>
<div class="linkAHEAD"><a href="simple.html">Defining Simple Generics</a></div>
<div class="linkAHEAD"><a href="subtype.html">Generics and Subtyping</a></div>
<div class="linkAHEAD"><a href="wildcards.html">Wildcards</a></div>
<div class="linkAHEAD"><a href="methods.html">Generic Methods</a></div>
<div class="linkAHEAD"><a href="legacy.html">Interoperating with Legacy Code</a></div>
<div class="linkAHEAD"><a href="fineprint.html">The Fine Print</a></div>
<div class="linkAHEAD"><a href="literals.html">Class Literals as Runtime-Type Tokens</a></div>
<div class="linkAHEAD"><a href="morefun.html">More Fun with Wildcards</a></div>
<div class="nolinkAHEAD">Converting Legacy Code to Use Generics</div>
<div class="linkAHEAD"><a href="acknowledgements.html">Acknowledgements</a></div>
</div>
    </div>
    <div id=MainFlow class=MainFlow_indented>
            <span id=BreadCrumbs>
                <a href=../../index.html target=_top>Home Page</a>
                &gt;
                <a href=../index.html target=_top>Bonus</a>
                &gt;
                <a href=index.html target=_top>Generics</a>
            </span>
            <div class=NavBit>
                <a target=_top href=morefun.html>&laquo;&nbsp;Previous</a>&nbsp;&bull;&nbsp;<a target=_top href=../TOC.html>Trail</a>&nbsp;&bull;&nbsp;<a target=_top href=acknowledgements.html>Next&nbsp;&raquo;</a>
            </div>
            <div id=PageTitle><h1>Converting Legacy Code to Use Generics</h1></div>
            <div id=PageContent>
<!--Converting Legacy Code to Use Generics-->


Earlier, we showed how new and legacy code can interoperate. Now, it's 
time to look at the harder problem of "generifying" old code.
<P>
If you decide to convert old code to use generics, you need to think
carefully about how you modify the API. 
<P>
You need to make certain that the generic API is not unduly restrictive;
it must continue to support the original contract of the API.
Consider again some examples from <code>java.util.Collection</code>. The pre-generic
API looks like:

<div class="codeblock"><pre>
<b>interface</b> Collection {
    <b>public boolean</b> containsAll(Collection c);
    <b>public boolean</b> addAll(Collection c);
}
</pre></div>

A naive attempt to generify it would be the following:

<div class="codeblock"><pre>
<b>interface</b> Collection&lt;E&gt; {

    <b>public boolean</b> containsAll(Collection&lt;E&gt; c);
    <b>public boolean</b> addAll(Collection&lt;E&gt; c);
}
</pre></div>


While this is certainly type safe, it doesn't live up to the API's original
contract. The <code>containsAll()</code> method works with any kind of
incoming collection. It will only succeed if the incoming collection 
really contains only instances of <code>E</code>, but:
<UL>
<li>The static type of the incoming collection might differ, perhaps because
the caller doesn't know the precise type of the collection being passed in,
or perhaps because it is a <code>Collection&lt;S&gt;</code>,where <code>S</code> is a 
subtype of
<code>E</code>.
<li>It's perfectly legitimate to call <code>containsAll()</code> with a
collection of a different type. The routine should work, returning
<code>false</code>.
</UL>

In the case of <code>addAll()</code>, we should be able to add any collection
that consists of instances of a subtype of <code>E</code>. We saw how to
handle this situation correctly in section 
<a class="TutorialLink" target="_top" href="methods.html">Generic Methods</a>.
<P>
You also need to ensure that the revised
API retains binary compatibility with old clients. This implies that the
erasure of the API must be the same as the original, ungenerified API. In most 
cases, this falls out naturally, but there are some subtle cases. We'll 
examine one of the subtlest cases we've encountered, 
the method <code>Collections.max()</code>. 
As we saw in section 
<a class="TutorialLink" target="_top" href="morefun.html">More Fun with Wildcards</a>, a plausible signature for <code>max()</code> is:

<div class="codeblock"><pre>
<b>public static</b> &lt;T <b>extends</b> Comparable&lt;? <b>super</b> T&gt;&gt; 
        T max(Collection&lt;T&gt; coll)
</pre></div>

This is fine, except that the erasure of this signature is:

<div class="codeblock"><pre>
<b>public static</b> Comparable max(Collection coll)
</pre></div>

which is different than the original signature of <code>max()</code>:

<div class="codeblock"><pre>
<b>public static</b> Object max(Collection coll)
</pre></div>

One could
certainly have specified this signature for <code>max()</code>, but it was not
done, and all the old binary class files that call <code>Collections.max()</code>
depend on a signature that returns <code>Object</code>.
<P>
We can force the erasure to be different, by explicitly specifying a
superclass in the bound for the formal type parameter <code>T</code>. 

<div class="codeblock"><pre>
<b>public static</b> &lt;T <b>extends</b> Object &amp; Comparable&lt;? <b>super</b> T&gt;&gt; 
        T max(Collection&lt;T&gt; coll)
</pre></div>

This is an example of giving <i>multiple bounds</i> for a type parameter, using the syntax
<code>T1 &amp; T2 ... &amp; Tn</code>.  A type variable with multiple bounds is known to be a subtype of all
of the types listed in the bound. When a multiple bound is used, the first type mentioned in
the bound is used as the erasure of the type variable.
<P>
Finally, we should recall that <code>max</code> only reads from its input 
collection, and so is applicable to collections of any subtype of <code>T</code>.
<P>
This brings
us to the actual signature used in the JDK:

<div class="codeblock"><pre>
<b>public static</b> &lt;T <b>extends</b> Object &amp; Comparable&lt;? <b>super</b> T&gt;&gt; 
        T max(Collection&lt;? <b>extends</b> T&gt; coll)
</pre></div>

It's very rare that anything so involved comes up in practice, but expert
library designers should be prepared to think very carefully when
converting existing APIs.
<P>
Another issue to watch out for is <i>covariant returns</i>, that is, refining
the return type of a method in a subclass. You should not take advantage
of this feature in an old API. To see why, let's look at an example.
<P>
Assume your original API was of the form:

<div class="codeblock"><pre>
<b>public class</b> Foo {
    <b>public</b> Foo create() {
        ...
    } // <i>Factory. Should create an instance of whatever class it is declared in.</i>
}

<b>public class</b> Bar <b>extends</b> Foo {
    <b>public</b> Foo create() {
        ...
    } // <i>Actually creates a Bar.</i>
}
</pre></div>

Taking advantage of covariant returns, you modify it to:
 
<div class="codeblock"><pre>
<b>public class</b> Foo {
    <b>public</b> Foo create() {
        ...
    } // <i>Factory. Should create an instance of whatever class it is declared in.</i>
}

<b>public class</b> Bar <b>extends</b> Foo {
    <b>public</b> Bar create() {
        ...
    } // <i>Actually creates a Bar.</i>
}
</pre></div>

Now, assume a third party client of your code wrote the following:

<div class="codeblock"><pre>
<b>public class</b> Baz <b>extends</b> Bar {
    <b>public</b> Foo create() {
        ...
    } // <i>Actually creates a Baz.</i>
}
</pre></div>

The Java virtual machine does not directly support overriding of methods
with different return types. This feature is supported by the compiler.
Consequently, unless the class <code>Baz</code> is recompiled, 
it will not  properly override the <code>create()</code> method of 
<code>Bar</code>. Furthermore, <code>Baz</code> will
have to be modified, since the code will be rejected as written--the 
return type of <code>create()</code>
in <code>Baz</code> is not a subtype of the return type of  <code>create()</code>
in <code>Bar</code>.

        </div>
        <div class=NavBit>
            <a target=_top href=morefun.html>&laquo; Previous</a>
            &bull;
            <a target=_top href=../TOC.html>Trail</a>
            &bull;
            <a target=_top href=acknowledgements.html>Next &raquo;</a>
        </div>
    </div>
    <div id=Footer2>
<hr>
<div id=TagNotes>
    <p class="footertext">Problems with the examples? Try <a target="_blank"
        href=../../information/run-examples.html>Compiling and Running
        the Examples: FAQs</a>.
    <br>
    Complaints? Compliments? Suggestions? <a target="_blank"
        href="http://download.oracle.com/javase/feedback.html">Give
    us your feedback</a>.
    </p>
</div> 

<div id=Footer>
<p class="footertext"><a name="license_info">Your use of this</a> page and all the material on pages under &quot;The Java Tutorials&quot; banner,
and all the material on pages under &quot;The Java Tutorials&quot; banner is subject to the <a href="../../information/license.html">Java SE Tutorial Copyright
and License</a>.
Additionally, any example code contained in any of these Java
Tutorials pages is licensed under the
<a href="http://developers.sun.com/license/berkeley_license.html">Code
Sample License</a>.
</p>
<table border="0" cellspacing="0" cellpadding="5" summary="">
    <tr>
         <td headers="h1" width="20%">
	 <table width="100%" border="0" cellspacing="0" cellpadding="5">
            <tr>
              <td headers="h1" align="center"><img id=duke src=../../images/DukeWave.gif width=55 height=55 alt="duke image"></td>
              <td headers="h2" align="left" valign="middle"><img id=oracle src=../../images/logo_oracle_footer.gif width=100 height=29 alt="Oracle logo"></td>
           </tr>
          </table>
          </td>

          <td width="55%" valign="middle" align="center">
		<p class="footertext"><a href="http://www.oracle.com/us/corporate/index.html">About Oracle</a> | <a href="http://www.oracle.com/technology/index.html">Oracle Technology Network</a> | <a href="https://www.samplecode.oracle.com/servlets/CompulsoryClickThrough?type=TermsOfService">Terms of Service</a></p> 
	 </td>
          <td width="25%" valign="middle" align="right">
      		<p class="footertext">Copyright &copy; 1995, 2011 Oracle and/or its affiliates. All rights reserved.</p>
	 </td>
     </tr>     
</table>
</div>
    </div>
    <div class=PrintHeaders>
        <b>Previous page:</b> More Fun with Wildcards
        <br><b>Next page:</b> Acknowledgements
    </div>

<!-- Start SiteCatalyst code   -->
<script language="JavaScript" src="http://www.oracle.com/ocom/groups/systemobject/@mktg_admin/documents/systemobject/s_code_download.js"></script>
<script language="JavaScript" src="http://www.oracle.com/ocom/groups/systemobject/@mktg_admin/documents/systemobject/s_code.js"></script>
<noscript> 
A browser with JavaScript enabled is required for this page to operate properly.
</noscript>
 
<!-- ********** DO NOT ALTER ANYTHING BELOW THIS LINE ! *********** -->
<!--  Below code will send the info to Omniture server -->
<script language="javascript">var s_code=s.t();if(s_code)document.write(s_code)</script>

 
<!-- End SiteCatalyst code -->

</body>
</html> 
