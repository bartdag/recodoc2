<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<html lang="en-US">
    <head>
        <title>Example Code (The Java&trade; Tutorials &gt;        
            Java API for XML Processing (JAXP) &gt; Streaming API for XML)
</title>

     <meta name="description" content="This JAXP Java tutorial describes Java API for XML Processing (jaxp), XSLT, SAX, and related XML topics" />
     <meta name="keywords" content="java programming, learn java, java sample code, jaxp, xml, xslt, sax" />
        
<style type="text/css">
    .FigureCaption   { 
        margin-left: 1in; 
        margin-right: 1in; 
        font-family: sans-serif; 
        font-size: smaller; 
        text-align: justify;
    }
    #TopBar_bl {
        background: url(../../images/java_bar_bl.gif) 0 100% no-repeat;
        width: 100%;
        height: 60px;
    }
    #TopBar_br {
        background: url(../../images/java_bar_br.gif) 100% 100% no-repeat;
        width: 100%;
        height: 60px;
    }
    #TopBar_tl {
        background: url(../../images/java_bar_tl.gif) 0 0 no-repeat;
        width: 100%;
        height: 60px;
    }
    #TopBar_tr {
        background: url(../../images/java_bar_tr.gif) 100% 0 no-repeat;
        width: 100%;
        height: 60px;
    }
    #TopBar {
        background: #35556B url(../../images/java_bar.gif);
        margin: 10px 10px 0 10px;
        height:60px;
        min-width:700px;
        color: white;
        font-family: sans-serif; 
        font-weight: bold;
    }
    @media print {
        #BreadCrumbs, #Download {
            display: none;
        }
    }
    #TopBar_right {
        line-height: 14px;
        float: right;
        padding-top: 2px;
        padding-right: 30px;
        text-align: center;
    }
    @media print {
        #TopBar_right {
            display: none;
        }
    }
    #TopBar_right a {
        font-size: 12px;
        margin: 3px;
        padding: 0;
    }
    #TopBar a:visited, #TopBar a:link {
        color: white;
        text-decoration: none;
    }
    #TopBar a:hover, #TopBar a:active  {
        background-color: white;
        color: #35556B;
    }
    #BreadCrumbs {
        padding: 4px 5px 0.5em 0;
        font-family: sans-serif; 
        float: right;
    }
    #BreadCrumbs a {
        color: blue;
    }
    #BreadCrumbs a:visited, #BreadCrumbs a:link {
        text-decoration: none;
    }
    #BreadCrumbs a:hover, #BreadCrumbs a:active {
        text-decoration: underline;
    }
    #PageTitle {
        margin: 0 5px 0.5em 0;
        color: #F90000;
    }    
    #PageContent{
        margin: 0 5px 0 20px;
    }
    .LeftBar_shown {
        width: 13em;
        float: left;
        margin-left: 10px;
        margin-top: 4px;
        margin-bottom: 2em;
        margin-right: 10px;
    }
    @media print {
        .LeftBar_shown {
            display: none;
        }
    }
    .LeftBar_hidden {
        display: none;
    }
    #Footer {
        padding-top: 10px;
        padding-left: 10px;
        margin-right: 10px;
    }
    
    .footertext {
        font-size: 10px;
        font-family: sans-serif; 
        margin-top: 1px;
    }
    
    #Footer2 {
        padding-top: 10px;
        padding-left: 10px;
        margin-right: 10px;
    }
    .NavBit  {
        padding: 4px 5px 0.5em 0;
        font-family: sans-serif; 
    }
    @media print {
        .NavBit {
            display: none;
        }
    }
    #TagNotes {
        text-align: right;        
    }
    
    @media print {
        #TagNotes a:visited, #TagNotes a:link {
            color: #35556B;
            text-decoration: none;
        }
    }
    #Contents a, .NavBit a, #TagNotes a {
        color: blue
    }
    #TagNotes a:visited, #TagNotes a:link,
    #Contents a:visited, #Contents a:link,
    .NavBit a:visited, .NavBit a:link {
        text-decoration: none;
    }
    #TagNotes a:hover, #TagNotes a:active,   
    #Contents a:hover, #Contents a:active,   
    .NavBit a:hover, .NavBit a:active {  
        text-decoration: underline;
    }
    #Contents {
        float: left;
        font-family: sans-serif; 
    }
    @media print {
        #Contents {
            display: none;
        }
    }
    @media screen {
        div.PrintHeaders {
            display: none;
        }
    }
    .linkLESSON, .nolinkLESSON {
        margin-left: 0.5em;
        text-indent: -0.5em
    }
    .linkAHEAD, .nolinkAHEAD, .linkQUESTIONS, .nolinkQUESTIONS   {
        margin-left: 1.5em; 
        text-indent: -0.5em
    }
    .linkBHEAD, .nolinkBHEAD   {
        margin-left: 2.5em;
        text-indent: -0.5em
    }
    .linkCHEAD, .nolinkCHEAD   {
        margin-left: 3.5em;
        text-indent: -0.5em
    }
    .nolinkLESSON, .nolinkAHEAD, .nolinkBHEAD, .nolinkCHEAD,
    .nolinkQUESTIONS {
        font-weight: bold;
        color: #F90000;
    }
    .MainFlow_indented {
        margin-right: 10px;
        margin-left: 15em;
        margin-bottom: 2em;

    }
    .MainFlow_wide {
        margin-right: 10px;
        margin-left: 10px;
        margin-bottom: 2em;

    }
    @media print {
        .MainFlow_indented, .MainFlow_wide {
            padding-top: 0;
            margin-top: 10px;
            margin-right: 10px;
            margin-left: 0;
        }
    }
    h1, h2, h3, h4, h5 {
        color: #F90000;
        font-family: sans-serif;
    }

    h1 {
        font-weight: bold;
        font-size: 20px;
    }

    h2 {
        font-weight: bold;
        font-size: 17px;
    }

    h3 {
        font-weight: bold;
        font-size: 14px;
    }

    h4 {
        font-size: 15px;
    }

    h5 {
        font-size: 12px;
    }


    #ToggleLeft {
        display: none;
    }
    
    .note {
        margin: 0 30px 0px 30px;
    }
    
    .codeblock {
        margin: 0 30px 0px 30px;
    }

    /t

</style>
<script type="text/javascript">
    function leftBar() {
        var nameq = 'tutorial_showLeftBar='
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
            var cookieString = cookies[i];
            while (cookieString.charAt(0) == ' ') {
                cookieString = cookieString.substring(1, cookieString.length);
            }
            if (cookieString.indexOf(nameq) == 0) {
                cookieValue =  cookieString.substring(nameq.length,
                        cookieString.length);
                return cookieValue == 'yes';
            }
        }
        return true;
    }

    function showLeft(b) {
        var contents = document.getElementById("LeftBar");
        var main = document.getElementById("MainFlow");
        var toggle = document.getElementById("ToggleLeft");
        if (b) {
            contents.className = "LeftBar_shown";
            main.className = "MainFlow_indented";
            toggle.innerHTML = "Hide the TOC";
            document.cookie = 'tutorial_showLeftBar=yes; path=/';
        } else {
            contents.className = "LeftBar_hidden";
            main.className = "MainFlow_wide";
            toggle.innerHTML = "Show the TOC";
            document.cookie = 'tutorial_showLeftBar=no; path=/';
        }
    }

    function toggleLeft() {
        showLeft(document.getElementById("LeftBar").className ==
                "LeftBar_hidden");
        document.getElementById("ToggleLeft").blur();
    }

    function load() {
        showLeft(leftBar());
        document.getElementById("ToggleLeft").style.display="inline";
    }
    
</script>
<noscript> 
A browser with JavaScript enabled is required for this page to operate properly.
</noscript>

    </head>
<body onload="load()">
    <div id=TopBar> <div id=TopBar_tr> <div id=TopBar_tl> <div id=TopBar_br> <div id=TopBar_bl> 
                        <div id=TopBar_right> 
                            <a target="_blank"
                                href="http://java.sun.com/javase/6/download.jsp">Download
                                the JDK</a>
                            <br>
                            <a href="../../search.html" target="_blank">Search the
                                Tutorials</a>
                            <br>
                            <a href="javascript:toggleLeft()"
                                id="ToggleLeft">Hide the TOC</a>
                        </div>
                    </div> </div> </div> </div> </div>
    <div class=PrintHeaders>
        <b>Trail:</b> Java API for XML Processing (JAXP)
        <br><b>Lesson:</b> Streaming API for XML
    </div>

    <div id=LeftBar class=LeftBar_shown>
        <div id=Contents>
            <div class="linkLESSON"><a href="index.html">Streaming API for XML</a></div>
<div class="linkAHEAD"><a href="why.html">Why StAX?</a></div>
<div class="linkAHEAD"><a href="api.html">StAX API</a></div>
<div class="linkAHEAD"><a href="using.html">Using StAX</a></div>
<div class="linkAHEAD"><a href="parser.html">Oracle's Streaming XML Parser Implementation</a></div>
<div class="nolinkAHEAD">Example Code</div>
<div class="linkAHEAD"><a href="info.html">Further Information</a></div>
</div>
    </div>
    <div id=MainFlow class=MainFlow_indented>
            <span id=BreadCrumbs>
                <a href=../../index.html target=_top>Home Page</a>
                &gt;
                <a href=../index.html target=_top>Java API for XML Processing (JAXP)</a>
                &gt;
                <a href=index.html target=_top>Streaming API for XML</a>
            </span>
            <div class=NavBit>
                <a target=_top href=parser.html>&laquo;&nbsp;Previous</a>&nbsp;&bull;&nbsp;<a target=_top href=../TOC.html>Trail</a>&nbsp;&bull;&nbsp;<a target=_top href=info.html>Next&nbsp;&raquo;</a>
            </div>
            <div id=PageTitle><h1>Example Code</h1></div>
            <div id=PageContent>
<!-- Example Code -->

<a name="indexterm-48"></a><a name="indexterm-49"></a><p>This section steps through the example StAX code included in the JAXP reference
implementation bundle. All example directories used in this section are located in the
<tt></tt><i>INSTALL_DIR</i><tt>/jaxp-</tt><i>version</i><tt>/samples/stax</tt> directory.</p><p>The topics covered in this section are as follows:</p>
<ul><li><p><a href="#bnbfm">Example Code Organization</a></p></li>
<li><p><a href="#bnbfn">Example XML Document</a></p></li>
<li><p><a href="#bnbfo">Cursor Example</a></p></li>
<li><p><a href="#bnbft">Cursor-to-Event Example</a></p></li>
<li><p><a href="#bnbfz">Event Example</a></p></li>
<li><p><a href="#bnbgh">Filter Example</a></p></li>
<li><p><a href="#bnbgq">Read-and-Write Example</a></p></li>
<li><p><a href="#bnbgx">Writer Example</a></p></li></ul>


<a name="bnbfm"></a><h2>Example Code Organization</h2>
<p>The <tt></tt><i>INSTALL_DIR</i><tt>/jaxp-</tt><i>version</i><tt>/samples/stax</tt> directory contains the six StAX example directories:</p>
<ul><li><p><b>Cursor example</b>: The <tt>cursor</tt> directory contains <tt>CursorParse.java</tt>, which illustrates how to use the <tt>XMLStreamReader</tt> (cursor) API to read an XML file.</p></li>
<li><p><b>Cursor-to-Event example</b>: The <tt>cursor2event</tt> directory contains <tt>CursorApproachEventObject.java</tt>, which illustrates how an application can get information as an <tt>XMLEvent</tt> object when using the cursor API.</p></li>
<li><p><b>Event example</b>: The <tt>event</tt> directory contains <tt>EventParse.java</tt>, which illustrates how to use the <tt>XMLEventReader</tt> (event iterator) API to read an XML file.</p></li>
<li><p><b>Filter example</b>: The <tt>filter</tt> directory contains <tt>MyStreamFilter.java</tt>, which illustrates how to use the StAX Stream Filter APIs. In this example, the filter accepts only <tt>StartElement</tt> and <tt>EndElement</tt> events, and filters out the remainder of the events.</p></li>
<li><p><b>Read-and-Write example</b>: The <tt>readnwrite</tt> directory contains <tt>EventProducerConsumer.java</tt>, which illustrates how the StAX producer/consumer mechanism can be used to simultaneously read and write XML streams.</p></li>
<li><p><b>Writer example</b>: The <tt>writer</tt> directory contains <tt>CursorWriter.java</tt>, which illustrates how to use <tt>XMLStreamWriter</tt> to write an XML file programatically.</p></li></ul>
<p>All the StAX examples except for the Writer example use an example
XML document, <tt>BookCatalog.xml</tt>.</p>

<a name="bnbfn"></a><h2>Example XML Document</h2>
<p>The example XML document, <tt>BookCatalog.xml</tt>, used by most of the StAX example classes,
is a simple book catalog based on the common <tt>BookCatalogue</tt> namespace. The contents
of <tt>BookCatalog.xml</tt> are listed below:</p>
<div class="codeblock"><pre>
&lt;?xml version="1.0" encoding="UTF-8"?>
&lt;BookCatalogue xmlns="http://www.publishing.org">
    &lt;Book>
        &lt;Title>Yogasana Vijnana: the Science of Yoga&lt;/Title>
        &lt;author>Dhirendra Brahmachari&lt;/Author>
        &lt;Date>1966&lt;/Date>
        &lt;ISBN>81-40-34319-4&lt;/ISBN>
        &lt;Publisher>Dhirendra Yoga Publications&lt;/Publisher>
        &lt;Cost currency="INR">11.50&lt;/Cost>
    &lt;/Book>
    &lt;Book>
        &lt;Title>The First and Last Freedom&lt;/Title>
        &lt;Author>J. Krishnamurti&lt;/Author>
        &lt;Date>1954&lt;/Date>
        &lt;ISBN>0-06-064831-7&lt;/ISBN>
        &lt;Publisher>Harper &amp;amp; Row&lt;/Publisher>
        &lt;Cost currency="USD">2.95&lt;/Cost>
    &lt;/Book>
&lt;/BookCatalogue>
</pre></div>

<a name="bnbfo"></a><h2>Cursor Example</h2>
<a name="indexterm-50"></a><a name="indexterm-51"></a><p>Located in the <tt></tt><i>INSTALL_DIR</i><tt>/jaxp-</tt><i>version</i><tt>/samples/stax/cursor/</tt> directory, <tt>CursorParse.java</tt> demonstrates using the StAX cursor API
to read an XML document. In the Cursor example, the application instructs the
parser to read the next event in the XML input stream by calling
<tt>next()</tt>.</p><p>Note that <tt>next()</tt> just returns an integer constant corresponding to an underlying event
where the parser is positioned. The application needs to call the relevant function
to get more information related to the underlying event.</p><p>You can imagine this approach as a virtual cursor moving across the XML
input stream. There are various accessor methods which can be called when that
virtual cursor is at a particular event.</p>

<a name="bnbfp"></a><h3>Stepping through Events</h3>
<p>In this example, the client application pulls the next event in the XML
stream by calling the <tt>next</tt> method on the parser; for example:</p>
<div class="codeblock"><pre>
try {
    for (int i = 0 ; i &lt; count ; i++) {
        // pass the file name.. all relative entity
        // references will be resolved against this as
        // base URI.
        XMLStreamReader xmlr =
            xmlif.createXMLStreamReader(filename,
                new FileInputStream(filename));
        // when XMLStreamReader is created, it is positioned
        // at START_DOCUMENT event.
        int eventType = xmlr.getEventType();
        printEventType(eventType);
        printStartDocument(xmlr);
        // check if there are more events in the input stream
        while(xmlr.hasNext()) {
            eventType = xmlr.next();
            printEventType(eventType);
            // these functions print the information about
            // the particular event by calling the relevant
            // function
            printStartElement(xmlr);
            printEndElement(xmlr);
            printText(xmlr);
            printPIData(xmlr);
            printComment(xmlr);
        }
    }
}
</pre></div>

<p>Note that <tt>next</tt> just returns an integer constant corresponding to the event underlying
the current cursor location. The application calls the relevant function to get more
information related to the underlying event. There are various accessor methods which can
be called when the cursor is at a particular event.</p>

<a name="bnbfq"></a><h3>Returning String Representations</h3>
<p>Because the <tt>next</tt> method only returns integers corresponding to underlying event types, you
typically need to map these integers to string representations of the events; for
example:</p>
<div class="codeblock"><pre>
public final static String getEventTypeString(int eventType) {
    switch (eventType) {
        case XMLEvent.START_ELEMENT:
            return "START_ELEMENT";
        case XMLEvent.END_ELEMENT:
            return "END_ELEMENT";
        case XMLEvent.PROCESSING_INSTRUCTION:
            return "PROCESSING_INSTRUCTION";
        case XMLEvent.CHARACTERS:
            return "CHARACTERS";
        case XMLEvent.COMMENT:
            return "COMMENT";
        case XMLEvent.START_DOCUMENT:
            return "START_DOCUMENT";
        case XMLEvent.END_DOCUMENT:
            return "END_DOCUMENT";
        case XMLEvent.ENTITY_REFERENCE:
            return "ENTITY_REFERENCE";
        case XMLEvent.ATTRIBUTE:
            return "ATTRIBUTE";
        case XMLEvent.DTD:
            return "DTD";
        case XMLEvent.CDATA:
            return "CDATA";
        case XMLEvent.SPACE:
            return "SPACE";
    }
    return "UNKNOWN_EVENT_TYPE , " + eventType;
}
</pre></div>

<a name="gfyfg"></a><h3>To Run the Cursor Example</h3>
<ol>
<li><b>To compile and run the cursor example, in a terminal window, go to
the <tt></tt><i>INSTALL_DIR</i><tt>/jaxp-</tt><i>version</i><tt>/samples/</tt> directory and type the following:</b>
</li>
<div class="codeblock"><pre>
<tt><b>javac stax/cursor/*.java</b></tt>
</pre></div>

<li><b>Run the <tt>CursorParse</tt> sample on the <tt>BookCatalogue.xml</tt> file, with the following command.</b>
<p><tt>CursorParse</tt> will print out each element of the <tt>BookCatalogue.xml</tt> file.</p></li></ol>
<div class="codeblock"><pre>
<tt><b>java stax/event/CursorParse stax/data/BookCatalogue.xml</b></tt>
</pre></div>


<a name="bnbft"></a><h2>Cursor-to-Event Example</h2>
<a name="indexterm-52"></a><a name="indexterm-53"></a><p>Located in the <tt></tt><i>tut-install</i><tt>/javaeetutorial5/examples/stax/cursor2event/</tt> directory, <tt>CursorApproachEventObject.java</tt> demonstrates how to get information returned by
an <tt>XMLEvent</tt> object even when using the cursor API.</p><p>The idea here is that the cursor API&rsquo;s <tt>XMLStreamReader</tt> returns integer constants corresponding
to particular events, while the event iterator API&rsquo;s <tt>XMLEventReader</tt> returns immutable and persistent event
objects. <tt>XMLStreamReader</tt> is more efficient, but <tt>XMLEventReader</tt> is easier to use, because
all the information related to a particular event is encapsulated in a returned
<tt>XMLEvent</tt> object. However, the disadvantage of the event approach is the extra overhead
of creating objects for every event, which consumes both time and memory.</p><p>With this mind, <tt>XMLEventAllocator</tt> can be used to get event information as an
<tt>XMLEvent</tt> object, even when using the cursor API.</p>

<a name="bnbfu"></a><h3>Instantiating an XMLEventAllocator</h3>
<a name="indexterm-54"></a><p>The first step is to create a new <tt>XMLInputFactory</tt> and instantiate an <tt>XMLEventAllocator</tt>:</p>
<div class="codeblock"><pre>
XMLInputFactory xmlif = XMLInputFactory.newInstance();
System.out.println("FACTORY: " + xmlif);
xmlif.setEventAllocator(new XMLEventAllocatorImpl());
allocator = xmlif.getEventAllocator();
XMLStreamReader xmlr = xmlif.createXMLStreamReader(filename,
    new FileInputStream(filename));
</pre></div>

<a name="bnbfv"></a><h3>Creating an Event Iterator</h3>
<p>The next step is to create an event iterator:</p>
<div class="codeblock"><pre>
int eventType = xmlr.getEventType();
while(xmlr.hasNext()){
    eventType = xmlr.next();
    //Get all "Book" elements as XMLEvent object
    if(eventType == XMLStreamConstants.START_ELEMENT &amp;&amp;
        xmlr.getLocalName().equals("Book")){
        //get immutable XMLEvent
        StartElement event = getXMLEvent(xmlr).asStartElement();
        System.out.println("EVENT: " + event.toString());
    }
}
</pre></div>

<a name="bnbfw"></a><h3>Creating the Allocator Method</h3>
<p>The final step is to create the <tt>XMLEventAllocator</tt> method:</p>
<div class="codeblock"><pre>
private static XMLEvent getXMLEvent(XMLStreamReader reader)
         throws XMLStreamException {
    return allocator.allocate(reader);
}
</pre></div>

<a name="gfyeb"></a><h3>To Run the Cursor-to-Event Example</h3>
<ol>
<li><b>To compile and run the cursor&mdash;to&mdash;event example, in a terminal window, go to
the <tt></tt><i>INSTALL_DIR</i><tt>/jaxp-</tt><i>version</i><tt>/samples/</tt> directory and type the following:</b>
</li>
<div class="codeblock"><pre>
<tt><b>javac -classpath ../lib/jaxp-ri.jar stax/cursor2event/*.java</b></tt>
</pre></div>
<li><b>Run the <tt>CursorApproachEventObject</tt> sample on the <tt>BookCatalogue.xml</tt> file, with the following command.</b></li>
<div class="codeblock"><pre>
<tt><b>java stax/cursor2event/CursorApproachEventObject stax/data/BookCatalogue.xml</b></tt>
</pre></div>

<p><tt>CursorApproachEventObject</tt> will print out the list of events defined by the <tt>BookCatalogue.xml</tt> file.</p></li></ol>

<a name="bnbfz"></a><h2>Event Example</h2>
<a name="indexterm-55"></a><a name="indexterm-56"></a><p>Located in the <tt></tt><i>INSTALL_DIR</i><tt>/jaxp-</tt><i>version</i><tt>/samples/stax/event/</tt> directory, <tt>EventParse.java</tt> demonstrates how to use the StAX
event API to read an XML document.</p>

<a name="bnbga"></a><h3>Creating an Input Factory</h3>
<p>The first step is to create a new instance of <tt>XMLInputFactory</tt>:</p>
<div class="codeblock"><pre>
XMLInputFactory factory = XMLInputFactory.newInstance();
System.out.println("FACTORY: " + factory);
</pre></div>

<a name="bnbgb"></a><h3>Creating an Event Reader</h3>
<p>The next step is to create an instance of <tt>XMLEventReader</tt>:</p>
<div class="codeblock"><pre>
XMLEventReader r = factory.createXMLEventReader(filename,
     new FileInputStream(filename));
</pre></div>

<a name="bnbgc"></a><h3>Creating an Event Iterator</h3>
<p>The third step is to create an event iterator:</p>
<div class="codeblock"><pre>
XMLEventReader r = factory.createXMLEventReader(filename,
     new FileInputStream(filename));
while(r.hasNext()) {
    XMLEvent e = r.nextEvent();
    System.out.println(e.toString());
}
</pre></div>

<a name="bnbgd"></a><h3>Getting the Event Stream</h3>
<p>The final step is to get the underlying event stream:</p>
<div class="codeblock"><pre>
public final static String getEventTypeString(int eventType) {
    switch (eventType) {
        case XMLEvent.START_ELEMENT:
            return "START_ELEMENT";
        case XMLEvent.END_ELEMENT:
            return "END_ELEMENT";
        case XMLEvent.PROCESSING_INSTRUCTION:
            return "PROCESSING_INSTRUCTION";
        case XMLEvent.CHARACTERS:
            return "CHARACTERS";
        case XMLEvent.COMMENT:
            return "COMMENT";
        case XMLEvent.START_DOCUMENT:
            return "START_DOCUMENT";
        case XMLEvent.END_DOCUMENT:
            return "END_DOCUMENT";
        case XMLEvent.ENTITY_REFERENCE:
            return "ENTITY_REFERENCE";
        case XMLEvent.ATTRIBUTE:
            return "ATTRIBUTE";
        case XMLEvent.DTD:
            return "DTD";
        case XMLEvent.CDATA:
            return "CDATA";
        case XMLEvent.SPACE:
            return "SPACE";
    }
    return "UNKNOWN_EVENT_TYPE " + "," + eventType;
}
</pre></div>

<a name="bnbge"></a><h3>Returning the Output</h3>
<p>When you run the Event example, the <tt>EventParse</tt> class is compiled, and the
XML stream is parsed as events and returned to <tt>STDOUT</tt>. For example,
an instance of the <tt>Author</tt> element is returned as:</p>
<div class="codeblock"><pre>
&lt;[&rsquo;http://www.publishing.org&rsquo;]::Author>
    Dhirendra Brahmachari
&lt;/[&rsquo;http://www.publishing.org&rsquo;]::Author>
</pre></div>

<p>Note in this example that the event comprises an opening and closing tag,
both of which include the namespace. The content of the element is
returned as a string within the tags.</p><p>Similarly, an instance of the <tt>Cost</tt> element is returned as:</p>
<div class="codeblock"><pre>
&lt;[&rsquo;http://www.publishing.org&rsquo;]::Cost currency=&rsquo;INR&rsquo;>
    11.50
&lt;/[&rsquo;http://www.publishing.org&rsquo;]::Cost
</pre></div>

<p>In this case, the <tt>currency</tt> attribute and value are returned in the opening
tag for the event.</p>

<a name="gfyek"></a><h3>To Run the Event Example</h3>
<ol>
<li><b>To compile and run the event example, in a terminal window, go to
the <tt></tt><i>INSTALL_DIR</i><tt>/jaxp-</tt><i>version</i><tt>/samples/</tt> directory and type the following:</b>
<div class="codeblock"><pre>
<tt><b>javac -classpath ../lib/jaxp-ri.jar stax/event/*.java</b></tt>
</pre></div>
</li>
<li><b>Run the <tt>EventParse</tt> sample on the <tt>BookCatalogue.xml</tt> file, with the following command.</b>
<div class="codeblock"><pre>
<tt><b>java stax/event/EventParse stax/data/BookCatalogue.xml</b></tt>
</pre></div>

<p><tt>EventParse</tt> will print out the data from all the elements defined by the
<tt>BookCatalogue.xml</tt> file.</p></li></ol>

<a name="bnbgh"></a><h2>Filter Example</h2>
<a name="indexterm-57"></a><a name="indexterm-58"></a><p>Located in the <tt></tt><i>INSTALL_DIR</i><tt>/jaxp-</tt><i>version</i><tt>/samples/stax/filter/</tt> directory, <tt>MyStreamFilter.java</tt> demonstrates how to use the StAX
stream filter API to filter out events not needed by your application. In
this example, the parser filters out all events except <tt>StartElement</tt> and <tt>EndElement</tt>.</p>

<a name="bnbgi"></a><h3>Implementing the StreamFilter Class</h3>
<p>The <tt>MyStreamFilter</tt> class implements <tt>javax.xml.stream.StreamFilter</tt>:</p>
<div class="codeblock"><pre>
public class MyStreamFilter
     implements javax.xml.stream.StreamFilter {
</pre></div>

<a name="bnbgj"></a><h3>Creating an Input Factory</h3>
<p>The next step is to create an instance of <tt>XMLInputFactory</tt>. In this case,
various properties are also set on the factory:</p>
<div class="codeblock"><pre>
XMLInputFactory xmlif = null ;
try {
    xmlif = XMLInputFactory.newInstance();
    xmlif.setProperty(
        XMLInputFactory.IS_REPLACING_ENTITY_REFERENCES,
        Boolean.TRUE);
    xmlif.setProperty(
        XMLInputFactory.IS_SUPPORTING_EXTERNAL_ENTITIES,
        Boolean.FALSE);
    xmlif.setProperty(XMLInputFactory.IS_NAMESPACE_AWARE,
        Boolean.TRUE);
    xmlif.setProperty(XMLInputFactory.IS_COALESCING,
        Boolean.TRUE);
} catch (Exception ex) {
    ex.printStackTrace();
}
System.out.println("FACTORY: " + xmlif);
System.out.println("filename = "+ filename);
</pre></div>

<a name="bnbgk"></a><h3>Creating the Filter</h3>
<p>The next step is to instantiate a file input stream and create
the stream filter:</p>
<div class="codeblock"><pre>
FileInputStream fis = new FileInputStream(filename);
                
XMLStreamReader xmlr = xmlif.createFilteredReader(
    xmlif.createXMLStreamReader(fis), new MyStreamFilter());

int eventType = xmlr.getEventType();
printEventType(eventType);
while(xmlr.hasNext()) {
    eventType = xmlr.next();
    printEventType(eventType);
    printName(xmlr,eventType);
    printText(xmlr);
    if (xmlr.isStartElement()) {
        printAttributes(xmlr);
    }
    printPIData(xmlr);
    System.out.println("-----------------------------");
}
</pre></div>

<a name="bnbgl"></a><h3>Capturing the Event Stream</h3>
<p>The next step is to capture the event stream. This is done
in basically the same way as in the Event example.</p>

<a name="bnbgm"></a><h3>Filtering the Stream</h3>
<p>The final step is to filter the stream:</p>
<div class="codeblock"><pre>
public boolean accept(XMLStreamReader reader) {
    if (!reader.isStartElement() &amp;&amp; !reader.isEndElement())
        return false;
    else
        return true;
}
</pre></div>

<a name="bnbgn"></a><h3>Returning the Output</h3>
<p>When you run the Filter example, the <tt>MyStreamFilter</tt> class is compiled, and the
XML stream is parsed as events and returned to <tt>STDOUT</tt>. For example,
an <tt>Author</tt> event is returned as follows:</p>
<div class="codeblock"><pre>
EVENT TYPE(1):START_ELEMENT
HAS NAME: Author
HAS NO TEXT
HAS NO ATTRIBUTES
-----------------------------
EVENT TYPE(2):END_ELEMENT
HAS NAME: Author
HAS NO TEXT
-----------------------------
</pre></div>

<p>Similarly, a <tt>Cost</tt> event is returned as follows:</p>
<div class="codeblock"><pre>
EVENT TYPE(1):START_ELEMENT
HAS NAME: Cost
HAS NO TEXT

HAS ATTRIBUTES:
 ATTRIBUTE-PREFIX:
 ATTRIBUTE-NAMESP: null
ATTRIBUTE-NAME:   currency
ATTRIBUTE-VALUE: USD
ATTRIBUTE-TYPE:  CDATA

-----------------------------
EVENT TYPE(2):END_ELEMENT
HAS NAME: Cost
HAS NO TEXT
-----------------------------
</pre></div>
<p>See 
<a class="TutorialLink" target="_top" href="api.html#bnbee">Iterator API</a> and 
<a class="TutorialLink" target="_top" href="using.html#bnbew">Reading XML Streams</a> for a more detailed discussion of StAX event parsing.</p>

<a name="gfygs"></a><h3>To Run the Filter Example</h3>
<ol>
<li><b>To compile and run the Filter example, in a terminal window, go to
the <tt></tt><i>INSTALL_DIR</i><tt>/jaxp-</tt><i>version</i><tt>/samples/</tt> directory and type the following:</b>
<div class="codeblock"><pre>
<tt><b>javac -classpath ../lib/jaxp-ri.jar stax/filter/*.java</b></tt>
</pre></div>

</li>
<li><b>Run the <tt>MyStreamFilter</tt> sample on the <tt>BookCatalogue.xml</tt> file, with the following command.
This example requires the <tt>java.endorsed.dirs</tt> system property to be set, to point
to the <tt>samples/lib</tt> directory. </b>
<div class="codeblock"><pre>
<tt><b>java -Djava.endorsed.dirs=../lib stax/filter/MyStreamFilter -f stax/data/BookCatalogue.xml</b></tt>
</pre></div>

<p><tt>MyStreamFilter</tt> will print out the events defined by the <tt>BookCatalogue.xml</tt> file as an
XML stream.</p></li></ol>

<a name="bnbgq"></a><h2>Read-and-Write Example</h2>
<a name="indexterm-59"></a><a name="indexterm-60"></a><p>Located in the <tt></tt><i>INSTALL_DIR</i><tt>/jaxp-</tt><i>version</i><tt>/samples/stax/readnwrite/</tt> directory, <tt>EventProducerConsumer.java</tt> demonstrates how to use a StAX
parser simultaneously as both a producer and a consumer.</p><p>The StAX <tt>XMLEventWriter</tt> API extends from the <tt>XMLEventConsumer</tt> interface, and is referred
to as an <b>event consumer</b>. By contrast, <tt>XMLEventReader</tt> is an <b>event producer</b>. StAX supports simultaneous reading
and writing, such that it is possible to read from one XML stream
sequentially and simultaneously write to another stream.</p><p>The Read-and-Write example shows how the StAX producer/consumer mechanism can be used to
read and write simultaneously. This example also shows how a stream can be
modified and how new events can be added dynamically and then written to
a different stream.</p>

<a name="bnbgr"></a><h3>Creating an Event Producer/Consumer</h3>
<p>The first step is to instantiate an event factory and then create
an instance of an event producer/consumer:</p>

<div class="codeblock"><pre>
XMLEventFactory m_eventFactory = XMLEventFactory.newInstance();
public EventProducerConsumer() {
}
...
try {
    EventProducerConsumer ms = new EventProducerConsumer();
    
    XMLEventReader reader =
        XMLInputFactory.newInstance().createXMLEventReader(
            new java.io.FileInputStream(args[0]));
    XMLEventWriter writer =
        XMLOutputFactory.newInstance().createXMLEventWriter(
            System.out);
</pre></div>

<a name="bnbgs"></a><h3>Creating an Iterator</h3>
<p>The next step is to create an iterator to parse the stream:</p>
<div class="codeblock"><pre>
while(reader.hasNext()) {
    XMLEvent event = (XMLEvent)reader.next();
    if (event.getEventType() == event.CHARACTERS) {
        writer.add(ms.getNewCharactersEvent(event.asCharacters()));
    } else {
        writer.add(event);
    }
}
writer.flush();
</pre></div>

<a name="bnbgt"></a><h3>Creating a Writer</h3>
<p>The final step is to create a stream writer in the form
of a new <tt>Character</tt> event:</p>
<div class="codeblock"><pre>
Characters getNewCharactersEvent(Characters event) {
    if (event.getData().equalsIgnoreCase("Name1")) {
        return m_eventFactory.createCharacters(
            Calendar.getInstance().getTime().toString());
    }
    //else return the same event
    else {
        return event;
    }
}
</pre></div>

<a name="bnbgu"></a><h3>Returning the Output</h3>
<p>When you run the Read-and-Write example, the <tt>EventProducerConsumer</tt> class is compiled, and
the XML stream is parsed as events and written back to <tt>STDOUT</tt>. The
output is the contents of the <tt>BookCatalog.xml</tt> file described in <a href="#bnbfn">Example XML Document</a>.</p>

<a name="gfyfk"></a><h3>To Run the Read-and-Write Example</h3>
<ol>
<li><b>To compile and run the Read&mdash;and&mdash;Write example, in a terminal window, go to
the <tt></tt><i>INSTALL_DIR</i><tt>/jaxp-</tt><i>version</i><tt>/samples/</tt> directory and type the following:</b>
<div class="codeblock"><pre>
<tt><b>javac -classpath ../lib/jaxp-ri.jar stax/readnwrite/*.java</b></tt>
</pre></div>
</li>
<li><b>Run the <tt>EventProducerConsumer</tt> sample on the <tt>BookCatalogue.xml</tt> file, with the following command.</b>
<div class="codeblock"><pre>
<tt><b>java stax/readnwrite/EventProducerConsumer stax/data/BookCatalogue.xml</b></tt>
</pre></div>
<p><tt>EventProducerConsumer</tt> will print out the content of the <tt>BookCatalogue.xml</tt> file.</p></li></ol>

<a name="bnbgx"></a><h2>Writer Example</h2>
<a name="indexterm-61"></a><a name="indexterm-62"></a><p>Located in the <tt></tt><i>INSTALL_DIR</i><tt>/jaxp-</tt><i>version</i><tt>/samples/stax/writer/</tt> directory, <tt>CursorWriter.java</tt> demonstrates how to use the StAX
cursor API to write an XML stream.</p>

<a name="bnbgy"></a><h3>Creating the Output Factory</h3>
<p>The first step is to create an instance of <tt>XMLOutputFactory</tt>:</p>
<div class="codeblock"><pre>
XMLOutputFactory xof =  XMLOutputFactory.newInstance();
</pre></div>

<a name="bnbgz"></a><h3>Creating a Stream Writer</h3>
<p>The next step is to create an instance of <tt>XMLStreamWriter</tt>:</p>
<div class="codeblock"><pre>
XMLStreamWriter xtw = null;
</pre></div>

<a name="bnbha"></a><h3>Writing the Stream</h3>
<p>The final step is to write the XML stream. Note that the
stream is flushed and closed after the final <tt>EndDocument</tt> is written:</p>
<div class="codeblock"><pre>
xtw = xof.createXMLStreamWriter(new FileWriter(fileName));
xtw.writeComment("all elements here are explicitly in the HTML namespace");
xtw.writeStartDocument("utf-8","1.0");
xtw.setPrefix("html", "http://www.w3.org/TR/REC-html40");
xtw.writeStartElement("http://www.w3.org/TR/REC-html40","html");
xtw.writeNamespace("html", "http://www.w3.org/TR/REC-html40");
xtw.writeStartElement("http://www.w3.org/TR/REC-html40","head");
xtw.writeStartElement("http://www.w3.org/TR/REC-html40","title");
xtw.writeCharacters("Frobnostication");
xtw.writeEndElement();
xtw.writeEndElement();
xtw.writeStartElement("http://www.w3.org/TR/REC-html40","body");
xtw.writeStartElement("http://www.w3.org/TR/REC-html40","p");
xtw.writeCharacters("Moved to");
xtw.writeStartElement("http://www.w3.org/TR/REC-html40","a");
xtw.writeAttribute("href","http://frob.com");
xtw.writeCharacters("here");
xtw.writeEndElement();
xtw.writeEndElement();
xtw.writeEndElement();
xtw.writeEndElement();
xtw.writeEndDocument();
xtw.flush();
xtw.close();
</pre></div>

<a name="bnbhb"></a><h3>Returning the Output</h3>
<p>When you run the Writer example, the <tt>CursorWriter</tt> class is compiled, and the
XML stream is parsed as events and written to a file named <tt>dist/CursorWriter-Output</tt>:</p>

<div class="codeblock"><pre>
&lt;!--all elements here are explicitly in the HTML namespace-->
&lt;?xml version="1.0" encoding="utf-8"?>
&lt;html:html xmlns:html="http://www.w3.org/TR/REC-html40">
&lt;html:head>
&lt;html:title>Frobnostication&lt;/html:title>&lt;/html:head>
&lt;html:body>
&lt;html:p>Moved to &lt;html:a href="http://frob.com">here&lt;/html:a>
&lt;/html:p>
&lt;/html:body>
&lt;/html:html>
</pre></div>

<p>In the actual <tt>dist/CursorWriter-Output</tt> file, this stream is written without any line breaks;
the breaks have been added here to make the listing easier to read.
In this example, as with the object stream in the Event example, the
namespace prefix is added to both the opening and closing HTML tags. Adding
this prefix is not required by the StAX specification, but it is good
practice when the final scope of the output stream is not definitively known.</p>

<a name="gfyez"></a><h3>To Run the Writer Example</h3>
<ol>
<li><b>To compile and run the Writer example, in a terminal window, go to
the <tt></tt><i>INSTALL_DIR</i><tt>/jaxp-</tt><i>version</i><tt>/samples/</tt> directory and type the following:</b>
<div class="codeblock"><pre>
<tt><b>javac -classpath ../lib/jaxp-ri.jar stax/writer/*.java</b></tt>
</pre></div>
</li>
<li><b>Run the <tt>CursorWriter</tt> sample, specifying the name of the file the output should
be written to.</b>
<div class="codeblock"><pre>
<tt><b>java stax/writer/CursorWriter -f </tt><i>output_file</i><tt></b></tt>
</pre></div>

<p><tt>CursorWriter</tt> will create an output file of the appropriate name, which contains the
data shown in <a href="#bnbhb">Returning the Output</a>.</p></li></ol>
        </div>
        <div class=NavBit>
            <a target=_top href=parser.html>&laquo; Previous</a>
            &bull;
            <a target=_top href=../TOC.html>Trail</a>
            &bull;
            <a target=_top href=info.html>Next &raquo;</a>
        </div>
    </div>
    <div id=Footer2>
<hr>
<div id=TagNotes>
    <p class="footertext">Problems with the examples? Try <a target="_blank"
        href=../../information/run-examples.html>Compiling and Running
        the Examples: FAQs</a>.
    <br>
    Complaints? Compliments? Suggestions? <a target="_blank"
        href="http://download.oracle.com/javase/feedback.html">Give
    us your feedback</a>.
    </p>
</div> 

<div id=Footer>
<p class="footertext"><a name="license_info">Your use of this</a> page and all the material on pages under &quot;The Java Tutorials&quot; banner,
and all the material on pages under &quot;The Java Tutorials&quot; banner is subject to the <a href="../../information/license.html">Java SE Tutorial Copyright
and License</a>.
Additionally, any example code contained in any of these Java
Tutorials pages is licensed under the
<a href="http://developers.sun.com/license/berkeley_license.html">Code
Sample License</a>.
</p>
<table border="0" cellspacing="0" cellpadding="5" summary="">
    <tr>
         <td headers="h1" width="20%">
	 <table width="100%" border="0" cellspacing="0" cellpadding="5">
            <tr>
              <td headers="h1" align="center"><img id=duke src=../../images/DukeWave.gif width=55 height=55 alt="duke image"></td>
              <td headers="h2" align="left" valign="middle"><img id=oracle src=../../images/logo_oracle_footer.gif width=100 height=29 alt="Oracle logo"></td>
           </tr>
          </table>
          </td>

          <td width="55%" valign="middle" align="center">
		<p class="footertext"><a href="http://www.oracle.com/us/corporate/index.html">About Oracle</a> | <a href="http://www.oracle.com/technology/index.html">Oracle Technology Network</a> | <a href="https://www.samplecode.oracle.com/servlets/CompulsoryClickThrough?type=TermsOfService">Terms of Service</a></p> 
	 </td>
          <td width="25%" valign="middle" align="right">
      		<p class="footertext">Copyright &copy; 1995, 2011 Oracle and/or its affiliates. All rights reserved.</p>
	 </td>
     </tr>     
</table>
</div>
    </div>
    <div class=PrintHeaders>
        <b>Previous page:</b> Oracle's Streaming XML Parser Implementation
        <br><b>Next page:</b> Further Information
    </div>

<!-- Start SiteCatalyst code   -->
<script language="JavaScript" src="http://www.oracle.com/ocom/groups/systemobject/@mktg_admin/documents/systemobject/s_code_download.js"></script>
<script language="JavaScript" src="http://www.oracle.com/ocom/groups/systemobject/@mktg_admin/documents/systemobject/s_code.js"></script>
<noscript> 
A browser with JavaScript enabled is required for this page to operate properly.
</noscript>
 
<!-- ********** DO NOT ALTER ANYTHING BELOW THIS LINE ! *********** -->
<!--  Below code will send the info to Omniture server -->
<script language="javascript">var s_code=s.t();if(s_code)document.write(s_code)</script>

 
<!-- End SiteCatalyst code -->

</body>
</html> 
