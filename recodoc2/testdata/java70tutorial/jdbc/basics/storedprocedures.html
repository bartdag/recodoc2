<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<html lang="en-US">
    <head>
        <title>Using Stored Procedures (The Java&trade; Tutorials &gt;        
            JDBC(TM) Database Access &gt; JDBC Basics)
</title>

     <meta name="description" content="This JDBC Java tutorial describes how to use JDBC API to create, insert into, update, and query tables. You will also learn how to use simple and prepared statements, stored procedures and perform transactions" />
     <meta name="keywords" content="java programming, learn java, java sample code, jdbc, prepared statement, result set" />
        
<style type="text/css">
    .FigureCaption   { 
        margin-left: 1in; 
        margin-right: 1in; 
        font-family: sans-serif; 
        font-size: smaller; 
        text-align: justify;
    }
    #TopBar_bl {
        background: url(../../images/java_bar_bl.gif) 0 100% no-repeat;
        width: 100%;
        height: 60px;
    }
    #TopBar_br {
        background: url(../../images/java_bar_br.gif) 100% 100% no-repeat;
        width: 100%;
        height: 60px;
    }
    #TopBar_tl {
        background: url(../../images/java_bar_tl.gif) 0 0 no-repeat;
        width: 100%;
        height: 60px;
    }
    #TopBar_tr {
        background: url(../../images/java_bar_tr.gif) 100% 0 no-repeat;
        width: 100%;
        height: 60px;
    }
    #TopBar {
        background: #35556B url(../../images/java_bar.gif);
        margin: 10px 10px 0 10px;
        height:60px;
        min-width:700px;
        color: white;
        font-family: sans-serif; 
        font-weight: bold;
    }
    @media print {
        #BreadCrumbs, #Download {
            display: none;
        }
    }
    #TopBar_right {
        line-height: 14px;
        float: right;
        padding-top: 2px;
        padding-right: 30px;
        text-align: center;
    }
    @media print {
        #TopBar_right {
            display: none;
        }
    }
    #TopBar_right a {
        font-size: 12px;
        margin: 3px;
        padding: 0;
    }
    #TopBar a:visited, #TopBar a:link {
        color: white;
        text-decoration: none;
    }
    #TopBar a:hover, #TopBar a:active  {
        background-color: white;
        color: #35556B;
    }
    #BreadCrumbs {
        padding: 4px 5px 0.5em 0;
        font-family: sans-serif; 
        float: right;
    }
    #BreadCrumbs a {
        color: blue;
    }
    #BreadCrumbs a:visited, #BreadCrumbs a:link {
        text-decoration: none;
    }
    #BreadCrumbs a:hover, #BreadCrumbs a:active {
        text-decoration: underline;
    }
    #PageTitle {
        margin: 0 5px 0.5em 0;
        color: #F90000;
    }    
    #PageContent{
        margin: 0 5px 0 20px;
    }
    .LeftBar_shown {
        width: 13em;
        float: left;
        margin-left: 10px;
        margin-top: 4px;
        margin-bottom: 2em;
        margin-right: 10px;
    }
    @media print {
        .LeftBar_shown {
            display: none;
        }
    }
    .LeftBar_hidden {
        display: none;
    }
    #Footer {
        padding-top: 10px;
        padding-left: 10px;
        margin-right: 10px;
    }
    
    .footertext {
        font-size: 10px;
        font-family: sans-serif; 
        margin-top: 1px;
    }
    
    #Footer2 {
        padding-top: 10px;
        padding-left: 10px;
        margin-right: 10px;
    }
    .NavBit  {
        padding: 4px 5px 0.5em 0;
        font-family: sans-serif; 
    }
    @media print {
        .NavBit {
            display: none;
        }
    }
    #TagNotes {
        text-align: right;        
    }
    
    @media print {
        #TagNotes a:visited, #TagNotes a:link {
            color: #35556B;
            text-decoration: none;
        }
    }
    #Contents a, .NavBit a, #TagNotes a {
        color: blue
    }
    #TagNotes a:visited, #TagNotes a:link,
    #Contents a:visited, #Contents a:link,
    .NavBit a:visited, .NavBit a:link {
        text-decoration: none;
    }
    #TagNotes a:hover, #TagNotes a:active,   
    #Contents a:hover, #Contents a:active,   
    .NavBit a:hover, .NavBit a:active {  
        text-decoration: underline;
    }
    #Contents {
        float: left;
        font-family: sans-serif; 
    }
    @media print {
        #Contents {
            display: none;
        }
    }
    @media screen {
        div.PrintHeaders {
            display: none;
        }
    }
    .linkLESSON, .nolinkLESSON {
        margin-left: 0.5em;
        text-indent: -0.5em
    }
    .linkAHEAD, .nolinkAHEAD, .linkQUESTIONS, .nolinkQUESTIONS   {
        margin-left: 1.5em; 
        text-indent: -0.5em
    }
    .linkBHEAD, .nolinkBHEAD   {
        margin-left: 2.5em;
        text-indent: -0.5em
    }
    .linkCHEAD, .nolinkCHEAD   {
        margin-left: 3.5em;
        text-indent: -0.5em
    }
    .nolinkLESSON, .nolinkAHEAD, .nolinkBHEAD, .nolinkCHEAD,
    .nolinkQUESTIONS {
        font-weight: bold;
        color: #F90000;
    }
    .MainFlow_indented {
        margin-right: 10px;
        margin-left: 15em;
        margin-bottom: 2em;

    }
    .MainFlow_wide {
        margin-right: 10px;
        margin-left: 10px;
        margin-bottom: 2em;

    }
    @media print {
        .MainFlow_indented, .MainFlow_wide {
            padding-top: 0;
            margin-top: 10px;
            margin-right: 10px;
            margin-left: 0;
        }
    }
    h1, h2, h3, h4, h5 {
        color: #F90000;
        font-family: sans-serif;
    }

    h1 {
        font-weight: bold;
        font-size: 20px;
    }

    h2 {
        font-weight: bold;
        font-size: 17px;
    }

    h3 {
        font-weight: bold;
        font-size: 14px;
    }

    h4 {
        font-size: 15px;
    }

    h5 {
        font-size: 12px;
    }


    #ToggleLeft {
        display: none;
    }
    
    .note {
        margin: 0 30px 0px 30px;
    }
    
    .codeblock {
        margin: 0 30px 0px 30px;
    }

    /t

</style>
<script type="text/javascript">
    function leftBar() {
        var nameq = 'tutorial_showLeftBar='
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
            var cookieString = cookies[i];
            while (cookieString.charAt(0) == ' ') {
                cookieString = cookieString.substring(1, cookieString.length);
            }
            if (cookieString.indexOf(nameq) == 0) {
                cookieValue =  cookieString.substring(nameq.length,
                        cookieString.length);
                return cookieValue == 'yes';
            }
        }
        return true;
    }

    function showLeft(b) {
        var contents = document.getElementById("LeftBar");
        var main = document.getElementById("MainFlow");
        var toggle = document.getElementById("ToggleLeft");
        if (b) {
            contents.className = "LeftBar_shown";
            main.className = "MainFlow_indented";
            toggle.innerHTML = "Hide the TOC";
            document.cookie = 'tutorial_showLeftBar=yes; path=/';
        } else {
            contents.className = "LeftBar_hidden";
            main.className = "MainFlow_wide";
            toggle.innerHTML = "Show the TOC";
            document.cookie = 'tutorial_showLeftBar=no; path=/';
        }
    }

    function toggleLeft() {
        showLeft(document.getElementById("LeftBar").className ==
                "LeftBar_hidden");
        document.getElementById("ToggleLeft").blur();
    }

    function load() {
        showLeft(leftBar());
        document.getElementById("ToggleLeft").style.display="inline";
    }
    
</script>
<noscript> 
A browser with JavaScript enabled is required for this page to operate properly.
</noscript>

    </head>
<body onload="load()">
    <div id=TopBar> <div id=TopBar_tr> <div id=TopBar_tl> <div id=TopBar_br> <div id=TopBar_bl> 
                        <div id=TopBar_right> 
                            <a target="_blank"
                                href="http://java.sun.com/javase/6/download.jsp">Download
                                the JDK</a>
                            <br>
                            <a href="../../search.html" target="_blank">Search the
                                Tutorials</a>
                            <br>
                            <a href="javascript:toggleLeft()"
                                id="ToggleLeft">Hide the TOC</a>
                        </div>
                    </div> </div> </div> </div> </div>
    <div class=PrintHeaders>
        <b>Trail:</b> JDBC(TM) Database Access
        <br><b>Lesson:</b> JDBC Basics
    </div>

    <div id=LeftBar class=LeftBar_shown>
        <div id=Contents>
            <div class="linkLESSON"><a href="index.html">JDBC Basics</a></div>
<div class="linkAHEAD"><a href="gettingstarted.html">Getting Started</a></div>
<div class="linkAHEAD"><a href="processingsqlstatements.html">Processing SQL Statements with JDBC</a></div>
<div class="linkAHEAD"><a href="connecting.html">Establishing a Connection</a></div>
<div class="linkAHEAD"><a href="sqldatasources.html">Connecting with DataSource Objects</a></div>
<div class="linkAHEAD"><a href="sqlexception.html">Handling SQLExceptions</a></div>
<div class="linkAHEAD"><a href="tables.html">Setting Up Tables</a></div>
<div class="linkAHEAD"><a href="retrieving.html">Retrieving and Modifying Values from Result Sets</a></div>
<div class="linkAHEAD"><a href="prepared.html">Using Prepared Statements</a></div>
<div class="linkAHEAD"><a href="transactions.html">Using Transactions</a></div>
<div class="linkAHEAD"><a href="rowset.html">Using RowSet Objects</a></div>
<div class="linkAHEAD"><a href="jdbcrowset.html">Using JdbcRowSet Objects</a></div>
<div class="linkAHEAD"><a href="cachedrowset.html">Using CachedRowSetObjects</a></div>
<div class="linkAHEAD"><a href="joinrowset.html">Using JoinRowSet Objects</a></div>
<div class="linkAHEAD"><a href="filteredrowset.html">Using FilteredRowSet Objects</a></div>
<div class="linkAHEAD"><a href="webrowset.html">Using WebRowSet Objects</a></div>
<div class="linkAHEAD"><a href="sqltypes.html">Using Advanced Data Types</a></div>
<div class="linkAHEAD"><a href="blob.html">Using Large Objects</a></div>
<div class="linkAHEAD"><a href="sqlxml.html">Using SQLXML Objects</a></div>
<div class="linkAHEAD"><a href="array.html">Using Array Objects</a></div>
<div class="linkAHEAD"><a href="distinct.html">Using DISTINCT Data Type</a></div>
<div class="linkAHEAD"><a href="sqlstructured.html">Using Structured Objects</a></div>
<div class="linkAHEAD"><a href="sqlcustommapping.html">Using Customized Type Mappings</a></div>
<div class="linkAHEAD"><a href="sqldatalink.html">Using Datalink Objects</a></div>
<div class="linkAHEAD"><a href="sqlrowid.html">Using RowId Objects</a></div>
<div class="nolinkAHEAD">Using Stored Procedures</div>
<div class="linkAHEAD"><a href="jdbcswing.html">Using JDBC with GUI API</a></div>
</div>
    </div>
    <div id=MainFlow class=MainFlow_indented>
            <span id=BreadCrumbs>
                <a href=../../index.html target=_top>Home Page</a>
                &gt;
                <a href=../index.html target=_top>JDBC(TM) Database Access</a>
                &gt;
                <a href=index.html target=_top>JDBC Basics</a>
            </span>
            <div class=NavBit>
                <a target=_top href=sqlrowid.html>&laquo;&nbsp;Previous</a>&nbsp;&bull;&nbsp;<a target=_top href=../TOC.html>Trail</a>&nbsp;&bull;&nbsp;<a target=_top href=jdbcswing.html>Next&nbsp;&raquo;</a>
            </div>
            <div id=PageTitle><h1>Using Stored Procedures</h1></div>
            <div id=PageContent>
<P>A stored procedure is a group of SQL statements that form a logical unit and perform a particular task, and they are used to encapsulate a set of operations or queries to execute on a database server. For example, operations on an employee database (hire, fire, promote, lookup) could be coded as stored procedures executed by application code. Stored procedures can be compiled and executed with different parameters and results, and they can have any combination of input, output, and input/output parameters. </P>

<p>Note that stored procedures are supported by most DBMSs, but there is a fair amount of variation in their syntax and capabilities. Consequently, the tutorial contains two classes, <code><a href="gettingstarted.html">StoredProcedureJavaDBSample</a></code> and <code><a href="gettingstarted.html">StoredProcedureMySQLSample</a></code> to demonstrate how to create stored procedures in Java DB and MySQL, respectively.</p>

<p>This page covers the following topics:</p>

<ul>
  <li><a href="#overview_stored_procedues_examples">Overview of Stored Procedures Examples</a></li>
  <li><a href="#parameter_modes">Parameter Modes</a></li>
  <li><a href="#creating_stored_procedures_java_db">Creating Stored Procedures in Java DB</a>
    <ul>
      <li><a href="#creating_javadb_sql_jdbc">Creating Stored Procedures in Java DB with SQL Scripts or JDBC API</a></li>
      <li><a href="#creating_stored_procedures_java_db">Creating Stored Procedures in Java DB</a></li>
      <li><a href="#package_java_class_in_jar_file">Package Java Class in JAR File</a></li>
    </ul>
  </li>
  <li><a href="#creating_stored_procedure_mysql">Creating Stored Procedure in MySQL</a>
    <ul>
      <li><a href="#create_jdbc_mysql">Creating Stored Procedure in MySQL with SQL Scripts or JDBC API</a></li>
    </ul>
  </li>
  <li><a href="#calling_javadb_mysql">Calling Stored Procedures in Java DB and MySQL</a></li>
</ul>

<!-- *********************************** -->

<h2><a name="overview_stored_procedues_examples">Overview of Stored Procedures Examples</a></h2>

<p>The examples <code><a href="gettingstarted.html">StoredProcedureJavaDBSample.java</a></code> and <code><a href="gettingstarted.html">StoredProcedureMySQLSample.java</a></code> create and call the following stored procedures:</p>

<ul>
  <li><p><code>SHOW_SUPPLIERS</code>: Prints a result set that contains the names of coffee suppliers and the coffees they supply to The Coffee Break. This stored procedure does not require any parameters. When the example calls this stored procedure, the example produces output similar to the following:</p>

<div class="codeblock"><pre>
Acme, Inc.: Colombian_Decaf
Acme, Inc.: Colombian
Superior Coffee: French_Roast_Decaf
Superior Coffee: French_Roast
The High Ground: Espresso
</pre></div>

</li>

  <li><p><code>GET_SUPPLIER_OF_COFFEE</code>: Prints the name of the supplier <code>supplierName</code> for the coffee <code>coffeeName</code>. It requires the following parameters:</p>
    <ul>
      <li><code>IN coffeeName varchar(32)</code>: The name of the coffee</li>
      <li><code>OUT supplierName varchar(40)</code>: The name of the coffee supplier</li>
    </ul>
    
  <p>When the example calls this stored procedure with <code>Colombian</code> as the value for <code>coffeeName</code>, the example produces output similar to the following:</p>

<div class="codeblock"><pre>
Supplier of the coffee Colombian: Acme, Inc.
</pre></div>

  </li>

  <li><p><code>RAISE_PRICE</code>: Raises the price of the coffee <code>coffeeName</code> to the price <code>newPrice</code>. If the price increase is greater than the percentage <code>maximumPercentage</code>, then the price is raised by that percentage. This procedure will not change the price if the price <code>newPrice</code> is lower than the original price of the coffee. It requires the following parameters:</p>
    <ul>
      <li><code>IN coffeeName varchar(32)</code>: The name of the coffee</li>
      <li><code>IN maximumPercentage float</code>: The maximum percentage to raise the coffee's price</li>
      <li><code>INOUT newPrice numeric(10,2)</code>: The new price of the coffee. After the <code>RAISE_PRICE</code> stored procedure has been called, this parameter will contain the current price of the coffee <code>coffeeName</code>.</li>
    </ul>

  <p>When the example calls this stored procedure with <code>Colombian</code> as the value for <code>coffeeName</code>, <code>0.10</code> as the value for <code>maximumPercentage</code>, and <code>19.99</code> as the value for <code>newPrice</code>, the example produces output similar to the following:</p>

<div class="codeblock"><pre>
Contents of COFFEES table before calling RAISE_PRICE:
Colombian, 101, <strong>7.99</strong>, 0, 0
Colombian_Decaf, 101, 8.99, 0, 0
Espresso, 150, 9.99, 0, 0
French_Roast, 49, 8.99, 0, 0
French_Roast_Decaf, 49, 9.99, 0, 0

Calling the procedure RAISE_PRICE

Value of newPrice after calling RAISE_PRICE: <strong>8.79</strong>

Contents of COFFEES table after calling RAISE_PRICE:
Colombian, 101, <strong>8.79</strong>, 0, 0
Colombian_Decaf, 101, 8.99, 0, 0
Espresso, 150, 9.99, 0, 0
French_Roast, 49, 8.99, 0, 0
French_Roast_Decaf, 49, 9.99, 0, 0
</pre></div>

  </li>
</ul>

<!-- *********************************** -->

<h2><a name="parameter_modes">Parameter Modes</a></h2>

<p>The parameter attributes <code>IN</code> (the default), <code>OUT</code>, and <code>INOUT</code> are parameter modes. They define the action of formal parameters. The following table summarizes the information about parameter modes.</p>

<table summary="This table summarizes parameter modes." border="1">

<thead>
  <tr>
	   <th id="h1">Characteristic of Parameter Mode</th>  
	   <th id="h2">IN</th>
     <th id="h3">OUT</th>
     <th id="h4">INOUT</th>
</tr>
</thead>

<tbody>
  <tr>
	  <td headers="h1"><p>Must it be specified in the stored procedure definition?</p></td>
    <td headers="h2">
      <p>No; if omitted, then the parameter mode of the formal parameter is <code>IN</code>.</p>
    </td>
    <td headers="h3">
      <p>Must be specified.</p>
    </td>
    <td headers="h4">
      <p>Must be specified.</p>
    </td>
  </tr>

  <tr>
	  <td headers="h1"><p>Does the parameter pass a value to the stored procedure or return a value?</p></td> 
    <td headers="h2">
      <p>Passes values to a stored procedure.</p>
    </td>
    <td headers="h3">
      <p>Returns values to the caller.</p>
    </td>
    <td headers="h4">
      <p>Both; passes initial values to a stored procedure; returns updated values to the caller.</p>
    </td>
  </tr>

  <tr>
	  <td headers="h1"><p>Does the formal parameter act as a constant or a variable in the stored procedure?</p></td>  
    <td headers="h2">
      <p>Formal parameter acts like a constant.</p>
    </td>
    <td headers="h3">
      <p>Formal parameter acts like an uninitialized variable.</p>
    </td>
    <td headers="h4">
      <p>Formal parameter acts like an initialized variable.</p>
    </td>
  </tr>

  <tr>
	  <td headers="h1"><p>Can the formal parameter be assigned a value in the stored procedure?</p></td>
    <td headers="h2">
      <p>Formal parameter cannot be assigned a value.</p>
    </td>
    <td headers="h3">
      <p>Formal parameter cannot be used in an expression; must be assigned a value.</p>
    </td>
    <td headers="h4">
      <p>Formal parameter must be assigned a value.</p>
    </td>
  </tr>

  <tr>
	  <td headers="h1"><p>What kinds of actual parameters (arguments) can be passed to the stored procedure?</p></td>
		
    <td headers="h2">
      <p>Actual parameter can be a constant, initialized variable, literal, or expression.</p>
    </td>
		
    <td headers="h3">
      <p>Actual parameter must be a variable.</p>
    </td>

    <td headers="h4">
      <p>Actual parameter must be a variable.</p>
    </td>
   </tr>

</tbody>

</table>


<!-- *********************************** -->

<h2><a name="creating_stored_procedures_java_db">Creating Stored Procedures in Java DB</a></h2>

<p><strong>Note</strong>: See the section "CREATE PROCEDURE statement" in <a href="http://download.oracle.com/javadb/index.html"><em>Java DB Reference Manual</em></a> for more information about creating stored procedures in Java DB.</p>

<p>Creating and using a stored procedure in Java DB involves the following steps:</p>

<ol>
  <li><a href="#creating_public_static_java_method">Create a public static Java method in a Java class</a>: This method performs the required task of the stored procedure.</li>
  <li><a href="#creating_javadb_sql_jdbc">Create the stored procedure</a>: This stored procedure calls the Java method you created.</li>
  <li><a href="#package_java_class_in_jar_file">Package the Java class (that contains the public static Java method you created earlier) in a JAR file.</a></li>
  <li>Call the stored procedure with the <code>CALL</code> SQL statement. See the section <a href="#calling_javadb_mysql">Calling Stored Procedures in Java DB and MySQL</a>.</li>
</ol>


<!-- ====================================== -->

<h3><a name="creating_public_static_java_method">Creating Public Static Java Method</a></h3>

<p>The following method, <code><a href="gettingstarted.html">StoredProcedureJavaDBSample.showSuppliers</a></code>, contains the SQL statements that the stored procedure <code>SHOW_SUPPLIERS</code> calls:</p>

<div class="codeblock"><pre>
  public static void showSuppliers(ResultSet[] rs) throws SQLException {
    Connection con = DriverManager.getConnection("jdbc:default:connection");
    Statement stmt = null;
    String query =
      "select SUPPLIERS.SUP_NAME, COFFEES.COF_NAME " +
        "from SUPPLIERS, COFFEES " +
        "where SUPPLIERS.SUP_ID = COFFEES.SUP_ID " +
        "order by SUP_NAME";
    stmt = con.createStatement();
    rs[0] = stmt.executeQuery(query);
  }
</pre></div>

<p>The <code>SHOW_SUPPLIERS</code> stored procedure takes no arguments. You can specify arguments in a stored procedure by defining them in the method signature of your public static Java method. Note that the method <code>showSuppliers</code> contains a parameter of type <code>ResultSet[]</code>. If your stored procedure returns any number of <code>ResultSet</code> objects, specify one parameter of type <code>ResultSet[]</code> in your Java method. In addition, ensure that this Java method is public and static.</p>

<p>Retrieve the <code>Connection</code> object from the URL <code>jdbc:default:connection</code>. This is a convention in Java DB to indicate that the stored procedure will use the currently existing <code>Connection</code> object.</p>

<p>Note that the <code>Statement</code> object is not closed in this method. Do not close any <code>Statement</code> objects in the Java method of your stored procedure; if you do so, the <code>ResultSet</code> object will not exist when you issue the <code>CALL</code> statement when you call your stored procedure.</p>

<p>In order for the stored procedure to return a generated result set, you must assign the result set to an array component of the <code>ResultSet[]</code> parameter. In this example, the generated result set is assigned to the array component <code>rs[0]</code>.

<p>The following method is <code><a href="gettingstarted.html">StoredProcedureJavaDBSample.showSuppliers</a></code>:</p>

<div class="codeblock"><pre>
  public static void getSupplierOfCoffee(String coffeeName, String[] supplierName) throws SQLException {
    Connection con = DriverManager.getConnection("jdbc:default:connection");
    PreparedStatement pstmt = null;
    ResultSet rs = null;
    
    String query = 
        "select SUPPLIERS.SUP_NAME " +
          "from SUPPLIERS, COFFEES " +
          "where SUPPLIERS.SUP_ID = COFFEES.SUP_ID " +
          "and ? = COFFEES.COF_NAME";
    
    pstmt = con.prepareStatement(query);
    pstmt.setString(1, coffeeName);
    rs = pstmt.executeQuery();
    
    if (rs.next()) {
      supplierName[0] = rs.getString(1);
    } else {
      supplierName[0] = null;
    }
  }
</pre></div>

<p>The formal parameter <code>coffeeName</code> has the parameter mode <code>IN</code>. This formal parameter is used like any other parameter in a Java method. Because the formal parameter <code>supplierName</code> has the parameter mode <code>OUT</code>, it must use a one dimensional array data type. Because this method does not produce a result set, the method definition does not contain a parameter of type <code>ResultSet[]</code>. In order to retrieve a value from an <code>OUT</code> formal parameter, you must assign the value to be retrieved to an array component of the <code>OUT</code> formal parameter. In this example, the retrieved name of the coffee supplier is assigned to the array component <code>supplierName[0]</code>.</p>

<p>The following is the method signature of the <code><a href="gettingstarted.html">StoredProcedureJavaDBSample.raisePrice</a> method:</code></p>

<div class="codeblock"><pre>
 public static void raisePrice(String coffeeName, double maximumPercentage, BigDecimal[] newPrice)
  throws SQLException
</pre></div>
  
<p>Because the formal parameter <code>newPrice</code> has the parameter mode <code>INOUT</code>, it must use a one dimensional array data type. Java DB maps the <code>FLOAT</code> and <code>NUMERIC</code> SQL data types to the <code>double</code> and <code>java.math.BigDecimal</code> Java data types, respectively.</p>

<!-- ====================================== -->

<h3><a name="creating_javadb_sql_jdbc">Creating Stored Procedures in Java DB with SQL Scripts or JDBC API</a></h3>

<p>Java DB uses the Java programming language for its stored procedures. Consequently, when you define a stored procedure, you specify which Java class to call and where Java DB can find it.</p>

<p>The following excerpt from <code><a href="gettingstarted.html">StoredProcedureJavaDBSample.createProcedures</a></code> creates a stored procedure named <code>SHOW_SUPPLIERS</code>:</p>

<div class="codeblock"><pre>
  public void createProcedures(Connection con) throws SQLException {

    Statement stmtCreateShowSuppliers = null;
    
    // ...
       
    String queryShowSuppliers =
      "CREATE PROCEDURE SHOW_SUPPLIERS() " +
        "PARAMETER STYLE JAVA " +
        "LANGUAGE JAVA " +
        "DYNAMIC RESULT SETS 1 " +
        "EXTERNAL NAME 'com.oracle.tutorial.jdbc.StoredProcedureJavaDBSample.showSuppliers'";
        
    // ...

    try {
      System.out.println("Calling CREATE PROCEDURE");
      stmtCreateShowSuppliers = con.createStatement();
      
      // ...

      
    } catch (SQLException e) {
      JDBCTutorialUtilities.printSQLException(e);
    } finally {
      if (stmtCreateShowSuppliers != null) { stmtCreateShowSuppliers.close(); }
      
      // ...
      
    }
    
  }
</pre></div>

<p>The following list describes the procedure elements you can specify in the <code>CREATE PROCEDURE</code> statement:</p>

<ul>

  <li><code>PARAMETER STYLE JAVA</code>: Specifies that the stored procedure uses a parameter-passing convention that conforms to the Java language and the SQL routines specification (currently, <code>JAVA</code> is the only option).</li>

  <li><code>LANGUAGE JAVA</code>: Specifies the programming language of the stored procedure (currently, <code>JAVA</code> is the only option).</li>

  <li><code>DYNAMIC RESULT SETS 1</code>: Specifies the maximum number of result sets retrieved; in this case, it is <code>1</code>.</li>

  <li><code>EXTERNAL NAME 'com.oracle.tutorial.jdbc.StoredProcedureJavaDBSample.showSuppliers'</code> specifies the fully qualified Java method that this stored procedure calls.</li>

</ul>

<p>The following statement (which is found in <code><a href="gettingstarted.html">StoredProcedureJavaDBSample.createProcedures</a></code>) creates a stored procedure named <code>GET_SUPPLIERS_OF_COFFEE</code>:</p>

<div class="codeblock"><pre>
CREATE PROCEDURE GET_SUPPLIER_OF_COFFEE(IN coffeeName varchar(32), OUT supplierName varchar(40))
  PARAMETER STYLE JAVA
  LANGUAGE JAVA
  DYNAMIC RESULT SETS 0
  EXTERNAL NAME 'com.oracle.tutorial.jdbc.StoredProcedureJavaDBSample.getSupplierOfCoffee'
</pre></div>
	
<p>This stored procedure has two formal parameters, <code>coffeeName</code> and <code>supplierName</code>. The parameter specifiers <code>IN</code> and <code>OUT</code> are called parameter modes. They define the action of formal parameters. See <a href="parameter_modes">Parameter Modes</a> for more information. This stored procedure does not retrieve a result set, so the procedure element <code>DYNAMIC RESULT SETS</code> is <code>0</code>.</p>

<p>The following statement creates a stored procedure named <code>RAISE_PRICE</code>:</p>

<div class="codeblock"><pre>
CREATE PROCEDURE RAISE_PRICE(IN coffeeName varchar(32), IN maximumPercentage float, INOUT newPrice float)
  PARAMETER STYLE JAVA
  LANGUAGE JAVA
  DYNAMIC RESULT SETS 0
  EXTERNAL NAME 'com.oracle.tutorial.jdbc.StoredProcedureJavaDBSample.raisePrice'

</pre></div>

<p>You can use SQL scripts to create stored procedures in Java DB. See the script <code><a href="gettingstarted.html">javadb/create-procedures.sql</a></code> and the Ant target <code>javadb-create-procedure</code> in the <code><a href="gettingstarted.html">build.xml</a></code> Ant build script.</p>

<!-- ====================================== -->

<h3><a name="package_java_class_in_jar_file">Package Java Class in JAR File</a></h3>

<p>The Ant build script <code><a href="gettingstarted.html">build.xml</a></code> contains targets to compile and package the tutorial in a JAR file. At a command prompt, change the current directory to <code><em>&lt;JDBC tutorial directory&gt;</em></code>. From this directory, run the following command to compile and package the tutorial in a JAR file:</p>

<p><code>ant jar</code></p>

<p>The name of the JAR file is <code><em>&lt;JDBC tutorial directory&gt;</em>/lib/JDBCTutorial.jar</code>.</p>

<p><strong>Note</strong>: Ensure that you have modified <code><a href="gettingstarted.html">sampleproperties.xml</a></code> so that the value of the property <code>jar_file</code> is set to the full path name of <code>JDBCTutorial.jar</code>.</p>

<p>The Ant build script adds the file <code>JDBCTutorial.jar</code> to the class path. You can also specify the location of the JAR file in your <code>CLASSPATH</code> environment variable.</p>

<p>Alternatively, you can use the following system procedures to add the JAR file directly to the database:</p>

<div class="codeblock"><pre>
CALL sqlj.install_jar('<em>&lt;JDBC tutorial directory&gt;</em>/lib/JDBCTutorial.jar', 'APP.JDBCTutorial', 0)
CALL sqlj.replace_jar('<em>&lt;JDBC tutorial directory&gt;</em>/lib/JDBCTutorial.jar', 'APP.JDBCTutorial')";
CALL syscs_util.syscs_set_database_property('derby.database.classpath', 'APP.JDBCTutorial')";
</pre></div>

<p>The <code>install_jar</code> procedure in the <code>SQL</code> schema adds a JAR file to the database. The first argument of this procedure is the full path name of the JAR file on the computer from which this procedure is run. The second argument is an identifier that Java DB uses to refer to the JAR file. (The identifier <code>APP</code> is the Java DB default schema.) The <code>replace_jar</code> procedure replaces a JAR file already in the database.</p>

<p>The system procedure <code>SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY</code> sets or deletes the value of a property of the database on the current connection. This method sets the property <code>derby.database.classpath</code> to the identifier specified in the <code>install_jar</code> file. Java DB first looks in your Java class path for a class, then it looks in <code>derby.database.classpath</code>.


<!-- *********************************** -->

<h2><a name="creating_stored_procedure_mysql">Creating Stored Procedure in MySQL</a></h2>

<p>Creating and using a stored procedure in Java DB involves the following steps:</p>

<ol>
  <li><a href="#create_jdbc_mysql">Create the stored procedure with an SQL script or JDBC API</a></li>
  <li>Call the stored procedure with the <code>CALL</code> SQL statement. See the section <a href="#calling_javadb_mysql">Calling Stored Procedures in Java DB and MySQL</a></li>
</ol>

<!-- *********************************** -->

<h3><a name="create_jdbc_mysql">Creating Stored Procedure in MySQL with SQL Scripts or JDBC API</a></h3>

<p>MySQL uses a SQL-based syntax for its stored procedures. The following excerpt from the SQL script <code><a href="gettingstarted.html">mysql/create-procedures.sql</a></code> creates a stored procedure named <code>SHOW_SUPPLIERS</code>:</p>

<div class="codeblock"><pre>
SELECT 'Dropping procedure SHOW_SUPPLIERS' AS ' '|
drop procedure if exists SHOW_SUPPLIERS|

# ...

SELECT 'Creating procedure SHOW_SUPPLIERS' AS ' '|
create procedure SHOW_SUPPLIERS()
  begin
    select SUPPLIERS.SUP_NAME, COFFEES.COF_NAME
    from SUPPLIERS, COFFEES
    where SUPPLIERS.SUP_ID = COFFEES.SUP_ID
    order by SUP_NAME;
  end|
</pre></div>

<p>The <code>DROP PROCEDURE</code> statement deletes that procedure <code>SHOW_SUPPLIERS</code> if it exists. In MySQL, statements in a stored procedure are separated by semicolons. However, a different delimiter is required to end the <code>create procedure</code> statement. This example uses the pipe (<code>|</code>) character; you can use another character (or more than one character). This character that separates statements is defined in the <code>delimiter</code> attribute in the Ant target that calls this script. This excerpt is from the Ant build file <code><a href="gettingstarted.html">build.xml</a></code>:</p>

<div class="codeblock"><pre>
  &lt;target name="mysql-create-procedure"&gt;

    &lt;sql driver="${DB.DRIVER}" url="${DB.URL}" userid="${DB.USER}"
         password="${DB.PASSWORD}" classpathref="CLASSPATH" print="true" <strong>delimiter="|"</strong>
         autocommit="false" onerror="abort"&gt;
       &lt;transaction src="./sql/${DB.VENDOR}/create-procedures.sql"&gt;&lt;/transaction&gt;
    &lt;/sql&gt;

  &lt;/target&gt;
</pre></div>

<p>Alternatively, you can use the <code>DELIMITER</code> SQL statement to specify a different delimiter character.</p>

<p>The <code>CREATE PROCEDURE</code> statement consists of the name of the procedure, a comma-separated list of parameters in parentheses, and SQL statements within the <code>BEGIN</code> and <code>END</code> keywords.</p>

<p>You can use the JDBC API to create a stored procedure. The following method, <code><a href="gettingstarted.html">StoredProcedureMySQLSample.createProcedureShowSuppliers</a></code>, performs the same tasks as the previous script:</p>

<div class="codeblock"><pre>
  public void createProcedureShowSuppliers() throws SQLException {
    String createProcedure = null;

    String queryDrop = "DROP PROCEDURE IF EXISTS SHOW_SUPPLIERS";

    createProcedure =
        "create procedure SHOW_SUPPLIERS() " +
          "begin " +
            "select SUPPLIERS.SUP_NAME, COFFEES.COF_NAME " +
              "from SUPPLIERS, COFFEES " +
              "where SUPPLIERS.SUP_ID = COFFEES.SUP_ID " +
              "order by SUP_NAME; " +
          "end";
    Statement stmt = null;
    Statement stmtDrop = null;

    try {
      System.out.println("Calling DROP PROCEDURE");
      stmtDrop = con.createStatement();
      stmtDrop.execute(queryDrop);
    } catch (SQLException e) {
      JDBCTutorialUtilities.printSQLException(e);
    } finally {
      if (stmtDrop != null) { stmtDrop.close(); }
    }

    try {
      stmt = con.createStatement();
      stmt.executeUpdate(createProcedure);
    } catch (SQLException e) {
      JDBCTutorialUtilities.printSQLException(e);
    } finally {
      if (stmt != null) { stmt.close(); }
    }
  }
</pre></div>
  
<p>Note that the delimiter has not been changed in this method.</p> 
  
<p>The stored procedure <code>SHOW_SUPPLIERS</code> generates a result set, even though the return type of the method <code>createProcedureShowSuppliers</code> is <code>void</code> and the method does not contain any parameters. A result set is returned when the stored procedure <code>SHOW_SUPPLIERS</code> is called with the method <code>CallableStatement.executeQuery</code>:</p>

<div class="codeblock"><pre>

CallableStatement cs = null;
cs = this.con.prepareCall("{call SHOW_SUPPLIERS}");
ResultSet rs = cs.executeQuery();
</pre></div> 

<p>The following excerpt from the method <code><a href="gettingstarted.html">StoredProcedureMySQLSample.createProcedureGetSupplierOfCoffee</a></code> contains the SQL query that creates a stored procedure named <code>GET_SUPPLIER_OF_COFFEE</code>:</p>

<div class="codeblock"><pre>
  public void createProcedureGetSupplierOfCoffee() throws SQLException {

    String createProcedure = null;

    // ...
    
    createProcedure =
        "create procedure GET_SUPPLIER_OF_COFFEE(IN coffeeName varchar(32), OUT supplierName varchar(40)) " +
          "begin " +
            "select SUPPLIERS.SUP_NAME into supplierName " +
              "from SUPPLIERS, COFFEES " +
              "where SUPPLIERS.SUP_ID = COFFEES.SUP_ID " +
              "and coffeeName = COFFEES.COF_NAME; " +
            "select supplierName; " +
          "end";
  // ...
  
  }
</pre></div>

<p>This stored procedure has two formal parameters, <code>coffeeName</code> and <code>supplierName</code>. The parameter specifiers <code>IN</code> and <code>OUT</code> are called parameter modes. They define the action of formal parameters. See <a href="parameter_modes">Parameter Modes</a> for more information. The formal parameters are defined in the SQL query, not in the method <code>createProcedureGetSupplierOfCoffee</code>. To assign a value to the <code>OUT</code> parameter <code>supplierName</code>, this stored procedure uses a <code>SELECT</code> statement.</p> 

<p>The following excerpt from the method <code><a href="gettingstarted.html">StoredProcedureMySQLSample.createProcedureRaisePrice</a></code> contains the SQL query that creates a stored procedure named <code>RAISE_PRICE</code>:</p>

<div class="codeblock"><pre>
  public void createProcedureRaisePrice() throws SQLException {
    
    String createProcedure = null;

    // ...

    createProcedure =
        "create procedure RAISE_PRICE(IN coffeeName varchar(32), IN maximumPercentage float, INOUT newPrice numeric(10,2)) " +
          "begin " +
            "main: BEGIN " +
              "declare maximumNewPrice numeric(10,2); " +
              "declare oldPrice numeric(10,2); " +
              "select COFFEES.PRICE into oldPrice " +
                "from COFFEES " +
                "where COFFEES.COF_NAME = coffeeName; " +
              "set maximumNewPrice = oldPrice * (1 + maximumPercentage); " +
              "if (newPrice &gt; maximumNewPrice) " +
                "then set newPrice = maximumNewPrice; " +
              "end if; " +
              "if (newPrice &lt;= oldPrice) " +
                "then set newPrice = oldPrice; " +
                "leave main; " +
              "end if; " +
              "update COFFEES " +
                "set COFFEES.PRICE = newPrice " +
                "where COFFEES.COF_NAME = coffeeName; " +
              "select newPrice; " +
            "END main; " +
          "end";
          
    // ...
        
  }
</pre></div>
  
<p>The stored procedure assigns a value to the <code>INOUT</code> parameter <code>newPrice</code> with the <code>SET</code> and <code>SELECT</code> statements. To exit the stored procedure, the stored procedure first encloses the statements in a <code>BEGIN ... END</code> block labeled <code>main</code>. To exit the procedure, the method uses the statement <code>leave main</code>.</p> 


<!-- ====================================== -->

<h2><a name="calling_javadb_mysql">Calling Stored Procedures in Java DB and MySQL</a></h2>

<p>The following excerpt from method <code><a href="gettingstarted.html">runStoredProcedures</a></code>, calls the stored procedure <code>SHOW_SUPPLIERS</code> and prints the generated result set:</p>

<div class="codeblock"><pre>
      cs = this.con.prepareCall("{call SHOW_SUPPLIERS()}");
      ResultSet rs = cs.executeQuery();

      while (rs.next()) {
        String supplier = rs.getString("SUP_NAME");
        String coffee = rs.getString("COF_NAME");
        System.out.println(supplier + ": " + coffee);
      }
</pre></div>
      
<p><strong>Note</strong>: As with <code>Statement</code> objects, to call the stored procedure, you can call <code>execute</code>, <code>executeQuery</code>, or <code>executeUpdate</code> depending on how many <code>ResultSet</code> objects the procedure returns. However, if you are not sure how many <code>ResultSet</code> objects the procedure returns, call <code>execute</code>.</p>

<p>Calling the stored procedure <code>SHOW_SUPPLIERS</code> is demonstrated in the section <a href="#create_jdbc_mysql">Creating Stored Procedure with JDBC API in MySQL</a>.</p> 

<p>The following excerpt from method <code><a href="gettingstarted.html">runStoredProcedures</a></code>, calls the stored procedure <code>GET_SUPPLIER_OF_COFFEE</code>:</p>

<div class="codeblock"><pre>
      cs = this.con.prepareCall("{call GET_SUPPLIER_OF_COFFEE(?, ?)}");
      cs.setString(1, coffeeNameArg);
      cs.registerOutParameter(2, Types.VARCHAR);
      cs.executeQuery();
            
      String supplierName = cs.getString(2);

</pre></div>

<p>The interface <code>CallableStatement</code> extends <code>PreparedStatement</code>. It is used to call stored procedures. Specify values for <code>IN</code> parameters (such as <code>coffeeName</code> in this example) just like you would with a <code>PreparedStatement</code> object by calling the appropriate setter method. However, if a stored procedure contains an <code>OUT</code> parameter, you must register it with the <code>registerOutParameter</code> method.</p>

<p>The following excerpt from the method <code><a href="gettingstarted.html">runStoredProcedures</a></code>, calls the stored procedure <code>RAISE_PRICE</code>:</p>

<div class="codeblock"><pre>
      cs = this.con.prepareCall("{call RAISE_PRICE(?,?,?)}");
      cs.setString(1, coffeeNameArg);
      cs.setFloat(2, maximumPercentageArg);
      cs.registerOutParameter(3, Types.NUMERIC);
      cs.setFloat(3, newPriceArg);
      
      cs.execute();
</pre></div>
      
<p>Because the parameter <code>newPrice</code> (the third parameter in the procedure <code>RAISE_PRICE</code>) has the parameter mode <code>INOUT</code>, you must both specify its value by calling the appropriate setter method and register it with the <code>registerOutParameter</code> method.</p>        </div>
        <div class=NavBit>
            <a target=_top href=sqlrowid.html>&laquo; Previous</a>
            &bull;
            <a target=_top href=../TOC.html>Trail</a>
            &bull;
            <a target=_top href=jdbcswing.html>Next &raquo;</a>
        </div>
    </div>
    <div id=Footer2>
<hr>
<div id=TagNotes>
    <p class="footertext">Problems with the examples? Try <a target="_blank"
        href=../../information/run-examples.html>Compiling and Running
        the Examples: FAQs</a>.
    <br>
    Complaints? Compliments? Suggestions? <a target="_blank"
        href="http://download.oracle.com/javase/feedback.html">Give
    us your feedback</a>.
    </p>
</div> 

<div id=Footer>
<p class="footertext"><a name="license_info">Your use of this</a> page and all the material on pages under &quot;The Java Tutorials&quot; banner,
and all the material on pages under &quot;The Java Tutorials&quot; banner is subject to the <a href="../../information/license.html">Java SE Tutorial Copyright
and License</a>.
Additionally, any example code contained in any of these Java
Tutorials pages is licensed under the
<a href="http://developers.sun.com/license/berkeley_license.html">Code
Sample License</a>.
</p>
<table border="0" cellspacing="0" cellpadding="5" summary="">
    <tr>
         <td headers="h101" width="20%">
	 <table width="100%" border="0" cellspacing="0" cellpadding="5">
            <tr>
              <td headers="h101" align="center"><img id=duke src=../../images/DukeWave.gif width=55 height=55 alt="duke image"></td>
              <td headers="h102" align="left" valign="middle"><img id=oracle src=../../images/logo_oracle_footer.gif width=100 height=29 alt="Oracle logo"></td>
           </tr>
          </table>
          </td>

          <td width="55%" valign="middle" align="center">
		<p class="footertext"><a href="http://www.oracle.com/us/corporate/index.html">About Oracle</a> | <a href="http://www.oracle.com/technology/index.html">Oracle Technology Network</a> | <a href="https://www.samplecode.oracle.com/servlets/CompulsoryClickThrough?type=TermsOfService">Terms of Service</a></p> 
	 </td>
          <td width="25%" valign="middle" align="right">
      		<p class="footertext">Copyright &copy; 1995, 2011 Oracle and/or its affiliates. All rights reserved.</p>
	 </td>
     </tr>     
</table>
</div>
    </div>
    <div class=PrintHeaders>
        <b>Previous page:</b> Using RowId Objects
        <br><b>Next page:</b> Using JDBC with GUI API
    </div>

<!-- Start SiteCatalyst code   -->
<script language="JavaScript" src="http://www.oracle.com/ocom/groups/systemobject/@mktg_admin/documents/systemobject/s_code_download.js"></script>
<script language="JavaScript" src="http://www.oracle.com/ocom/groups/systemobject/@mktg_admin/documents/systemobject/s_code.js"></script>
<noscript> 
A browser with JavaScript enabled is required for this page to operate properly.
</noscript>
 
<!-- ********** DO NOT ALTER ANYTHING BELOW THIS LINE ! *********** -->
<!--  Below code will send the info to Omniture server -->
<script language="javascript">var s_code=s.t();if(s_code)document.write(s_code)</script>

 
<!-- End SiteCatalyst code -->

</body>
</html> 
