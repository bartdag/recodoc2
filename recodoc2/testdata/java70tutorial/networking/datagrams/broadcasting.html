<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<html lang="en-US">
    <head>
        <title>Broadcasting to Multiple Recipients (The Java&trade; Tutorials &gt;        
            Custom Networking &gt; All About Datagrams)
</title>

     <meta name="description" content="This networking Java tutorial describes networking capabilities of the Java platform, working with URLs, sockets, datagrams, and cookies" />
     <meta name="keywords" content="java programming, learn java, java sample code, java networking, java url, java socket, datagram, java cookie" />
        
<style type="text/css">
    .FigureCaption   { 
        margin-left: 1in; 
        margin-right: 1in; 
        font-family: sans-serif; 
        font-size: smaller; 
        text-align: justify;
    }
    #TopBar_bl {
        background: url(../../images/java_bar_bl.gif) 0 100% no-repeat;
        width: 100%;
        height: 60px;
    }
    #TopBar_br {
        background: url(../../images/java_bar_br.gif) 100% 100% no-repeat;
        width: 100%;
        height: 60px;
    }
    #TopBar_tl {
        background: url(../../images/java_bar_tl.gif) 0 0 no-repeat;
        width: 100%;
        height: 60px;
    }
    #TopBar_tr {
        background: url(../../images/java_bar_tr.gif) 100% 0 no-repeat;
        width: 100%;
        height: 60px;
    }
    #TopBar {
        background: #35556B url(../../images/java_bar.gif);
        margin: 10px 10px 0 10px;
        height:60px;
        min-width:700px;
        color: white;
        font-family: sans-serif; 
        font-weight: bold;
    }
    @media print {
        #BreadCrumbs, #Download {
            display: none;
        }
    }
    #TopBar_right {
        line-height: 14px;
        float: right;
        padding-top: 2px;
        padding-right: 30px;
        text-align: center;
    }
    @media print {
        #TopBar_right {
            display: none;
        }
    }
    #TopBar_right a {
        font-size: 12px;
        margin: 3px;
        padding: 0;
    }
    #TopBar a:visited, #TopBar a:link {
        color: white;
        text-decoration: none;
    }
    #TopBar a:hover, #TopBar a:active  {
        background-color: white;
        color: #35556B;
    }
    #BreadCrumbs {
        padding: 4px 5px 0.5em 0;
        font-family: sans-serif; 
        float: right;
    }
    #BreadCrumbs a {
        color: blue;
    }
    #BreadCrumbs a:visited, #BreadCrumbs a:link {
        text-decoration: none;
    }
    #BreadCrumbs a:hover, #BreadCrumbs a:active {
        text-decoration: underline;
    }
    #PageTitle {
        margin: 0 5px 0.5em 0;
        color: #F90000;
    }    
    #PageContent{
        margin: 0 5px 0 20px;
    }
    .LeftBar_shown {
        width: 13em;
        float: left;
        margin-left: 10px;
        margin-top: 4px;
        margin-bottom: 2em;
        margin-right: 10px;
    }
    @media print {
        .LeftBar_shown {
            display: none;
        }
    }
    .LeftBar_hidden {
        display: none;
    }
    #Footer {
        padding-top: 10px;
        padding-left: 10px;
        margin-right: 10px;
    }
    
    .footertext {
        font-size: 10px;
        font-family: sans-serif; 
        margin-top: 1px;
    }
    
    #Footer2 {
        padding-top: 10px;
        padding-left: 10px;
        margin-right: 10px;
    }
    .NavBit  {
        padding: 4px 5px 0.5em 0;
        font-family: sans-serif; 
    }
    @media print {
        .NavBit {
            display: none;
        }
    }
    #TagNotes {
        text-align: right;        
    }
    
    @media print {
        #TagNotes a:visited, #TagNotes a:link {
            color: #35556B;
            text-decoration: none;
        }
    }
    #Contents a, .NavBit a, #TagNotes a {
        color: blue
    }
    #TagNotes a:visited, #TagNotes a:link,
    #Contents a:visited, #Contents a:link,
    .NavBit a:visited, .NavBit a:link {
        text-decoration: none;
    }
    #TagNotes a:hover, #TagNotes a:active,   
    #Contents a:hover, #Contents a:active,   
    .NavBit a:hover, .NavBit a:active {  
        text-decoration: underline;
    }
    #Contents {
        float: left;
        font-family: sans-serif; 
    }
    @media print {
        #Contents {
            display: none;
        }
    }
    @media screen {
        div.PrintHeaders {
            display: none;
        }
    }
    .linkLESSON, .nolinkLESSON {
        margin-left: 0.5em;
        text-indent: -0.5em
    }
    .linkAHEAD, .nolinkAHEAD, .linkQUESTIONS, .nolinkQUESTIONS   {
        margin-left: 1.5em; 
        text-indent: -0.5em
    }
    .linkBHEAD, .nolinkBHEAD   {
        margin-left: 2.5em;
        text-indent: -0.5em
    }
    .linkCHEAD, .nolinkCHEAD   {
        margin-left: 3.5em;
        text-indent: -0.5em
    }
    .nolinkLESSON, .nolinkAHEAD, .nolinkBHEAD, .nolinkCHEAD,
    .nolinkQUESTIONS {
        font-weight: bold;
        color: #F90000;
    }
    .MainFlow_indented {
        margin-right: 10px;
        margin-left: 15em;
        margin-bottom: 2em;

    }
    .MainFlow_wide {
        margin-right: 10px;
        margin-left: 10px;
        margin-bottom: 2em;

    }
    @media print {
        .MainFlow_indented, .MainFlow_wide {
            padding-top: 0;
            margin-top: 10px;
            margin-right: 10px;
            margin-left: 0;
        }
    }
    h1, h2, h3, h4, h5 {
        color: #F90000;
        font-family: sans-serif;
    }

    h1 {
        font-weight: bold;
        font-size: 20px;
    }

    h2 {
        font-weight: bold;
        font-size: 17px;
    }

    h3 {
        font-weight: bold;
        font-size: 14px;
    }

    h4 {
        font-size: 15px;
    }

    h5 {
        font-size: 12px;
    }


    #ToggleLeft {
        display: none;
    }
    
    .note {
        margin: 0 30px 0px 30px;
    }
    
    .codeblock {
        margin: 0 30px 0px 30px;
    }

    /t

</style>
<script type="text/javascript">
    function leftBar() {
        var nameq = 'tutorial_showLeftBar='
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
            var cookieString = cookies[i];
            while (cookieString.charAt(0) == ' ') {
                cookieString = cookieString.substring(1, cookieString.length);
            }
            if (cookieString.indexOf(nameq) == 0) {
                cookieValue =  cookieString.substring(nameq.length,
                        cookieString.length);
                return cookieValue == 'yes';
            }
        }
        return true;
    }

    function showLeft(b) {
        var contents = document.getElementById("LeftBar");
        var main = document.getElementById("MainFlow");
        var toggle = document.getElementById("ToggleLeft");
        if (b) {
            contents.className = "LeftBar_shown";
            main.className = "MainFlow_indented";
            toggle.innerHTML = "Hide the TOC";
            document.cookie = 'tutorial_showLeftBar=yes; path=/';
        } else {
            contents.className = "LeftBar_hidden";
            main.className = "MainFlow_wide";
            toggle.innerHTML = "Show the TOC";
            document.cookie = 'tutorial_showLeftBar=no; path=/';
        }
    }

    function toggleLeft() {
        showLeft(document.getElementById("LeftBar").className ==
                "LeftBar_hidden");
        document.getElementById("ToggleLeft").blur();
    }

    function load() {
        showLeft(leftBar());
        document.getElementById("ToggleLeft").style.display="inline";
    }
    
</script>
<noscript> 
A browser with JavaScript enabled is required for this page to operate properly.
</noscript>

    </head>
<body onload="load()">
    <div id=TopBar> <div id=TopBar_tr> <div id=TopBar_tl> <div id=TopBar_br> <div id=TopBar_bl> 
                        <div id=TopBar_right> 
                            <a target="_blank"
                                href="http://java.sun.com/javase/6/download.jsp">Download
                                the JDK</a>
                            <br>
                            <a href="../../search.html" target="_blank">Search the
                                Tutorials</a>
                            <br>
                            <a href="javascript:toggleLeft()"
                                id="ToggleLeft">Hide the TOC</a>
                        </div>
                    </div> </div> </div> </div> </div>
    <div class=PrintHeaders>
        <b>Trail:</b> Custom Networking
        <br><b>Lesson:</b> All About Datagrams
    </div>

    <div id=LeftBar class=LeftBar_shown>
        <div id=Contents>
            <div class="linkLESSON"><a href="index.html">All About Datagrams</a></div>
<div class="linkAHEAD"><a href="definition.html">What Is a Datagram?</a></div>
<div class="linkAHEAD"><a href="clientServer.html">Writing a Datagram Client and Server</a></div>
<div class="nolinkAHEAD">Broadcasting to Multiple Recipients</div>
</div>
    </div>
    <div id=MainFlow class=MainFlow_indented>
            <span id=BreadCrumbs>
                <a href=../../index.html target=_top>Home Page</a>
                &gt;
                <a href=../index.html target=_top>Custom Networking</a>
                &gt;
                <a href=index.html target=_top>All About Datagrams</a>
            </span>
            <div class=NavBit>
                <a target=_top href=clientServer.html>&laquo;&nbsp;Previous</a>&nbsp;&bull;&nbsp;<a target=_top href=../TOC.html>Trail</a>&nbsp;&bull;&nbsp;<a target=_top href=../nifs/index.html>Next&nbsp;&raquo;</a>
            </div>
            <div id=PageTitle><h1>Broadcasting to Multiple Recipients</h1></div>
            <div id=PageContent>
In addition to <code>DatagramSocket</code>, which lets programs send
packets to one another, java.net includes a class called
<code>MulticastSocket</code>. This kind of socket is used on the
client-side to listen for packets that the server broadcasts to
multiple clients.
<p>
Let's rewrite the quote server so that it broadcasts
<code>DatagramPacket</code>s to multiple recipients. Instead of sending
quotes to a specific client that makes a request, the new server now
needs to broadcast quotes at a regular interval. The client needs to be
modified so that it passively listens for quotes and does so on a
<code>MulticastSocket</code>.
<p>
This example is comprised of three classes which are modifications of
the three classes from the previous example:

<a class="SourceLink" target="_blank" href="examples/MulticastServer.java"><code>MulticastServer</code></a>,

<a class="SourceLink" target="_blank" href="examples/MulticastServerThread.java"><code>MulticastServerThread</code></a>, and

<a class="SourceLink" target="_blank" href="examples/MulticastClient.java"><code>MulticastClient</code></a>.
This discussion highlights
the interesting parts of these classes.
<p>
Here is the new version of the server's main program.
The differences between this code and the previous version,
<code>QuoteServer</code>, are shown in bold:
<div class="codeblock"><pre>
import java.io.*;
public class <strong>MulticastServer</strong> {
    public static void main(String[] args) throws IOException {
        new <strong>MulticastServerThread</strong>().start();
    }
}
</pre></div>
Basically, the server got a new name
and creates a <code>MulticastServerThread</code>
instead of a <code>QuoteServerThread</code>.
Now let's look at the <code>MulticastServerThread</code>
which contains the heart of the server. Here's its class declaration:
<div class="codeblock"><pre>
public class MulticastServerThread extends QuoteServerThread {
    ...
}
</pre></div>
We've made this class a subclass of <code>QuoteServerThread</code>
so that it can use the constructor,
and inherit some member variable and the <code>getNextQuote</code> method.
Recall that <code>QuoteServerThread</code> creates a
<code>DatagramSocket</code> bound to port 4445 and opens the quote file.
The <code>DatagramSocket</code>'s port number doesn't actually matter
in this example because the client never send anything to the server.
<p>
The only method explicitly implemented in <code>MulticastServerThread</code>
is its <code>run</code> method. The differences between this <code>run</code>
method and the one in <code>QuoteServerThread</code> are shown in bold:
<div class="codeblock"><pre>
public void run() {
    while (moreQuotes) {
        try {
            byte[] buf = new byte[256];
            <strong>// don't wait for request...just send a quote</strong>

            String dString = null;
            if (in == null)
                dString = new Date().toString();
            else
                dString = getNextQuote();
            buf = dString.getBytes();

            <strong>InetAddress group = InetAddress.getByName(
                                            "203.0.113.0");</strong>
            DatagramPacket packet;
            packet = new DatagramPacket(buf, buf.length, 
                                        <strong>group, 4446</strong>);
            socket.send(packet);

            try {
                sleep((long)Math.random() * FIVE_SECONDS);
            } catch (InterruptedException e) { }
        } catch (IOException e) {
            e.printStackTrace();
            moreQuotes = false;
        }
    }
    socket.close();
}
</pre></div>
The interesting change is how the <code>DatagramPacket</code> is
constructed, in particular, the <code>InetAddress</code> and port used to construct
the <code>DatagramPacket</code>. Recall that the previous example
retrieved the <code>InetAddress</code> and port number from the packet sent to the
server from the client. This was because the server needed to reply
directly to the client. Now, the server needs to address multiple
clients. So this time both the <code>InetAddress</code> and the port number are
hard-coded.
<p>
The hard-coded port number is 4446 (the client must have a
<code>MulticastSocket</code> bound to this port). The hard-coded
<code>InetAddress</code> of the <code>DatagramPacket</code> is "203.0.113.0" and is a
group identifier (rather than the Internet address of the machine on
which a single client is running). This particular address was
arbitrarily chosen from the reserved for this purpose.
<p>
Created in this way, the <code>DatagramPacket</code> is destined for
all clients listening to port number 4446 who are member of the
"203.0.113.0" group.
<p>
To listen to port number 4446, the new client program just created its
<code>MulticastSocket</code> with that port number. To become a member
of the "203.0.113.0" group, the client calls the
<code>MulticastSocket</code>'s <code>joinGroup</code> method with the
<code>InetAddress</code> that identifies the group. Now, the client is set up to
receive <code>DatagramPacket</code>s destined for the port and group
specified. Here's the relevant code from the new client program (which
was also rewritten to passively receive quotes rather than actively
request them). The bold statements are the ones that interact with the
<code>MulticastSocket</code>:
<div class="codeblock"><pre>
<strong>MulticastSocket socket = new MulticastSocket(4446);
InetAddress group = InetAddress.getByName("203.0.113.0");
socket.joinGroup(group);</strong>

DatagramPacket packet;
for (int i = 0; i &lt; 5; i++) {
    byte[] buf = new byte[256];
    packet = new DatagramPacket(buf, buf.length);
    <strong>socket.receive(packet);</strong>

    String received = new String(packet.getData());
    System.out.println("Quote of the Moment: " + received);
}
<strong>socket.leaveGroup(group);</strong>
socket.close();
</pre></div>
Notice that the server uses a <code>DatagramSocket</code> to broadcast
packet received by the client over a <code>MulticastSocket</code>.
Alternatively, it could have used a <code>MulticastSocket</code>. The
socket used by the server to send the <code>DatagramPacket</code> is
not important. What's important when broadcasting packets is the
addressing information contained in the <code>DatagramPacket</code>,
and the socket used by the client to listen for it
<p>

<div class="note"><hr><strong>Try this:</strong>&nbsp;
Run the <code>MulticastServer</code> and several clients.
Watch how the clients all get the same quotes.	
<hr></div>

        </div>
        <div class=NavBit>
            <a target=_top href=clientServer.html>&laquo; Previous</a>
            &bull;
            <a target=_top href=../TOC.html>Trail</a>
            &bull;
            <a target=_top href=../nifs/index.html>Next &raquo;</a>
        </div>
    </div>
    <div id=Footer2>
<hr>
<div id=TagNotes>
    <p class="footertext">Problems with the examples? Try <a target="_blank"
        href=../../information/run-examples.html>Compiling and Running
        the Examples: FAQs</a>.
    <br>
    Complaints? Compliments? Suggestions? <a target="_blank"
        href="http://download.oracle.com/javase/feedback.html">Give
    us your feedback</a>.
    </p>
</div> 

<div id=Footer>
<p class="footertext"><a name="license_info">Your use of this</a> page and all the material on pages under &quot;The Java Tutorials&quot; banner,
and all the material on pages under &quot;The Java Tutorials&quot; banner is subject to the <a href="../../information/license.html">Java SE Tutorial Copyright
and License</a>.
Additionally, any example code contained in any of these Java
Tutorials pages is licensed under the
<a href="http://developers.sun.com/license/berkeley_license.html">Code
Sample License</a>.
</p>
<table border="0" cellspacing="0" cellpadding="5" summary="">
    <tr>
         <td headers="h1" width="20%">
	 <table width="100%" border="0" cellspacing="0" cellpadding="5">
            <tr>
              <td headers="h1" align="center"><img id=duke src=../../images/DukeWave.gif width=55 height=55 alt="duke image"></td>
              <td headers="h2" align="left" valign="middle"><img id=oracle src=../../images/logo_oracle_footer.gif width=100 height=29 alt="Oracle logo"></td>
           </tr>
          </table>
          </td>

          <td width="55%" valign="middle" align="center">
		<p class="footertext"><a href="http://www.oracle.com/us/corporate/index.html">About Oracle</a> | <a href="http://www.oracle.com/technology/index.html">Oracle Technology Network</a> | <a href="https://www.samplecode.oracle.com/servlets/CompulsoryClickThrough?type=TermsOfService">Terms of Service</a></p> 
	 </td>
          <td width="25%" valign="middle" align="right">
      		<p class="footertext">Copyright &copy; 1995, 2011 Oracle and/or its affiliates. All rights reserved.</p>
	 </td>
     </tr>     
</table>
</div>
    </div>
    <div class=PrintHeaders>
        <b>Previous page:</b> Writing a Datagram Client and Server
        <br><b>Next page:</b> Programmatic Access to Network Parameters
    </div>

<!-- Start SiteCatalyst code   -->
<script language="JavaScript" src="http://www.oracle.com/ocom/groups/systemobject/@mktg_admin/documents/systemobject/s_code_download.js"></script>
<script language="JavaScript" src="http://www.oracle.com/ocom/groups/systemobject/@mktg_admin/documents/systemobject/s_code.js"></script>
<noscript> 
A browser with JavaScript enabled is required for this page to operate properly.
</noscript>
 
<!-- ********** DO NOT ALTER ANYTHING BELOW THIS LINE ! *********** -->
<!--  Below code will send the info to Omniture server -->
<script language="javascript">var s_code=s.t();if(s_code)document.write(s_code)</script>

 
<!-- End SiteCatalyst code -->

</body>
</html> 
