<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<html lang="en-US">
    <head>
        <title>Capturing Audio (The Java&trade; Tutorials &gt;        
            Sound)
</title>

     <meta name="description" content="" />
     <meta name="keywords" content="java programming, learn java, java sample code, " />
        
<style type="text/css">
    .FigureCaption   { 
        margin-left: 1in; 
        margin-right: 1in; 
        font-family: sans-serif; 
        font-size: smaller; 
        text-align: justify;
    }
    #TopBar_bl {
        background: url(../images/java_bar_bl.gif) 0 100% no-repeat;
        width: 100%;
        height: 60px;
    }
    #TopBar_br {
        background: url(../images/java_bar_br.gif) 100% 100% no-repeat;
        width: 100%;
        height: 60px;
    }
    #TopBar_tl {
        background: url(../images/java_bar_tl.gif) 0 0 no-repeat;
        width: 100%;
        height: 60px;
    }
    #TopBar_tr {
        background: url(../images/java_bar_tr.gif) 100% 0 no-repeat;
        width: 100%;
        height: 60px;
    }
    #TopBar {
        background: #35556B url(../images/java_bar.gif);
        margin: 10px 10px 0 10px;
        height:60px;
        min-width:700px;
        color: white;
        font-family: sans-serif; 
        font-weight: bold;
    }
    @media print {
        #BreadCrumbs, #Download {
            display: none;
        }
    }
    #TopBar_right {
        line-height: 14px;
        float: right;
        padding-top: 2px;
        padding-right: 30px;
        text-align: center;
    }
    @media print {
        #TopBar_right {
            display: none;
        }
    }
    #TopBar_right a {
        font-size: 12px;
        margin: 3px;
        padding: 0;
    }
    #TopBar a:visited, #TopBar a:link {
        color: white;
        text-decoration: none;
    }
    #TopBar a:hover, #TopBar a:active  {
        background-color: white;
        color: #35556B;
    }
    #BreadCrumbs {
        padding: 4px 5px 0.5em 0;
        font-family: sans-serif; 
        float: right;
    }
    #BreadCrumbs a {
        color: blue;
    }
    #BreadCrumbs a:visited, #BreadCrumbs a:link {
        text-decoration: none;
    }
    #BreadCrumbs a:hover, #BreadCrumbs a:active {
        text-decoration: underline;
    }
    #PageTitle {
        margin: 0 5px 0.5em 0;
        color: #F90000;
    }    
    #PageContent{
        margin: 0 5px 0 20px;
    }
    .LeftBar_shown {
        width: 13em;
        float: left;
        margin-left: 10px;
        margin-top: 4px;
        margin-bottom: 2em;
        margin-right: 10px;
    }
    @media print {
        .LeftBar_shown {
            display: none;
        }
    }
    .LeftBar_hidden {
        display: none;
    }
    #Footer {
        padding-top: 10px;
        padding-left: 10px;
        margin-right: 10px;
    }
    
    .footertext {
        font-size: 10px;
        font-family: sans-serif; 
        margin-top: 1px;
    }
    
    #Footer2 {
        padding-top: 10px;
        padding-left: 10px;
        margin-right: 10px;
    }
    .NavBit  {
        padding: 4px 5px 0.5em 0;
        font-family: sans-serif; 
    }
    @media print {
        .NavBit {
            display: none;
        }
    }
    #TagNotes {
        text-align: right;        
    }
    
    @media print {
        #TagNotes a:visited, #TagNotes a:link {
            color: #35556B;
            text-decoration: none;
        }
    }
    #Contents a, .NavBit a, #TagNotes a {
        color: blue
    }
    #TagNotes a:visited, #TagNotes a:link,
    #Contents a:visited, #Contents a:link,
    .NavBit a:visited, .NavBit a:link {
        text-decoration: none;
    }
    #TagNotes a:hover, #TagNotes a:active,   
    #Contents a:hover, #Contents a:active,   
    .NavBit a:hover, .NavBit a:active {  
        text-decoration: underline;
    }
    #Contents {
        float: left;
        font-family: sans-serif; 
    }
    @media print {
        #Contents {
            display: none;
        }
    }
    @media screen {
        div.PrintHeaders {
            display: none;
        }
    }
    .linkLESSON, .nolinkLESSON {
        margin-left: 0.5em;
        text-indent: -0.5em
    }
    .linkAHEAD, .nolinkAHEAD, .linkQUESTIONS, .nolinkQUESTIONS   {
        margin-left: 1.5em; 
        text-indent: -0.5em
    }
    .linkBHEAD, .nolinkBHEAD   {
        margin-left: 2.5em;
        text-indent: -0.5em
    }
    .linkCHEAD, .nolinkCHEAD   {
        margin-left: 3.5em;
        text-indent: -0.5em
    }
    .nolinkLESSON, .nolinkAHEAD, .nolinkBHEAD, .nolinkCHEAD,
    .nolinkQUESTIONS {
        font-weight: bold;
        color: #F90000;
    }
    .MainFlow_indented {
        margin-right: 10px;
        margin-left: 15em;
        margin-bottom: 2em;

    }
    .MainFlow_wide {
        margin-right: 10px;
        margin-left: 10px;
        margin-bottom: 2em;

    }
    @media print {
        .MainFlow_indented, .MainFlow_wide {
            padding-top: 0;
            margin-top: 10px;
            margin-right: 10px;
            margin-left: 0;
        }
    }
    h1, h2, h3, h4, h5 {
        color: #F90000;
        font-family: sans-serif;
    }

    h1 {
        font-weight: bold;
        font-size: 20px;
    }

    h2 {
        font-weight: bold;
        font-size: 17px;
    }

    h3 {
        font-weight: bold;
        font-size: 14px;
    }

    h4 {
        font-size: 15px;
    }

    h5 {
        font-size: 12px;
    }


    #ToggleLeft {
        display: none;
    }
    
    .note {
        margin: 0 30px 0px 30px;
    }
    
    .codeblock {
        margin: 0 30px 0px 30px;
    }

    /t

</style>
<script type="text/javascript">
    function leftBar() {
        var nameq = 'tutorial_showLeftBar='
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
            var cookieString = cookies[i];
            while (cookieString.charAt(0) == ' ') {
                cookieString = cookieString.substring(1, cookieString.length);
            }
            if (cookieString.indexOf(nameq) == 0) {
                cookieValue =  cookieString.substring(nameq.length,
                        cookieString.length);
                return cookieValue == 'yes';
            }
        }
        return true;
    }

    function showLeft(b) {
        var contents = document.getElementById("LeftBar");
        var main = document.getElementById("MainFlow");
        var toggle = document.getElementById("ToggleLeft");
        if (b) {
            contents.className = "LeftBar_shown";
            main.className = "MainFlow_indented";
            toggle.innerHTML = "Hide the TOC";
            document.cookie = 'tutorial_showLeftBar=yes; path=/';
        } else {
            contents.className = "LeftBar_hidden";
            main.className = "MainFlow_wide";
            toggle.innerHTML = "Show the TOC";
            document.cookie = 'tutorial_showLeftBar=no; path=/';
        }
    }

    function toggleLeft() {
        showLeft(document.getElementById("LeftBar").className ==
                "LeftBar_hidden");
        document.getElementById("ToggleLeft").blur();
    }

    function load() {
        showLeft(leftBar());
        document.getElementById("ToggleLeft").style.display="inline";
    }
    
</script>
<noscript> 
A browser with JavaScript enabled is required for this page to operate properly.
</noscript>

    </head>
<body onload="load()">
    <div id=TopBar> <div id=TopBar_tr> <div id=TopBar_tl> <div id=TopBar_br> <div id=TopBar_bl> 
                        <div id=TopBar_right> 
                            <a target="_blank"
                                href="http://java.sun.com/javase/6/download.jsp">Download
                                the JDK</a>
                            <br>
                            <a href="../search.html" target="_blank">Search the
                                Tutorials</a>
                            <br>
                            <a href="javascript:toggleLeft()"
                                id="ToggleLeft">Hide the TOC</a>
                        </div>
                    </div> </div> </div> </div> </div>
    <div class=PrintHeaders>
        <b>Trail:</b> Sound
    </div>

    <div id=LeftBar class=LeftBar_shown>
        <div id=Contents>
            <div class="linkAHEAD"><a href="sampled-overview.html">Overview of the Sampled Package</a></div>
<div class="linkAHEAD"><a href="accessing.html">Accessing Audio System Resources</a></div>
<div class="linkAHEAD"><a href="playing.html">Playing Back Audio</a></div>
<div class="nolinkAHEAD">Capturing Audio</div>
<div class="linkAHEAD"><a href="controls.html">Processing Audio with Controls</a></div>
<div class="linkAHEAD"><a href="converters.html">Using Files and Format Converters</a></div>
<div class="linkAHEAD"><a href="overview-MIDI.html">Overview of the MIDI Package</a></div>
<div class="linkAHEAD"><a href="accessing-MIDI.html">Accessing MIDI System Resources</a></div>
<div class="linkAHEAD"><a href="MIDI-messages.html">Transmitting and Receiving MIDI Messages</a></div>
<div class="linkAHEAD"><a href="MIDI-seq-intro.html">Introduction to Sequencers</a></div>
<div class="linkAHEAD"><a href="MIDI-seq-methods.html">Using Sequencer Methods</a></div>
<div class="linkAHEAD"><a href="MIDI-seq-adv.html">Using Advanced Sequencer Features</a></div>
<div class="linkAHEAD"><a href="MIDI-synth.html">Synthesizing Sound</a></div>
<div class="linkAHEAD"><a href="SPI-intro.html">Introduction to the Service Provider Interfaces</a></div>
<div class="linkAHEAD"><a href="SPI-providing-sampled.html">Providing Sampled-Audio Services</a></div>
<div class="linkAHEAD"><a href="SPI-providing-MIDI.html">Providing MIDI Services</a></div>
</div>
    </div>
    <div id=MainFlow class=MainFlow_indented>
            <span id=BreadCrumbs>
                <a href=../index.html target=_top>Home Page</a>
                &gt;
                <a href=./index.html target=_top>Sound</a>
            </span>
            <div class=NavBit>
                <a target=_top href=playing.html>&laquo;&nbsp;Previous</a>&nbsp;&bull;&nbsp;<a target=_top href=./TOC.html>Trail</a>&nbsp;&bull;&nbsp;<a target=_top href=controls.html>Next&nbsp;&raquo;</a>
            </div>
            <div id=PageTitle><h1>Capturing Audio</h1></div>
            <div id=PageContent>
<p><a name="114180"> </a> <em>Capturing</em> refers to the process of obtaining 
  a signal from outside the computer. A common application of audio capture is 
  recording, such as recording the microphone input to a sound file. However, 
  capturing isn't synonymous with recording, because recording implies that the 
  application always saves the sound data that's coming in. An application that 
  captures audio doesn't necessarily store the audio. Instead it might do something 
  with the data as it's coming in &mdash; such as transcribe speech into text &mdash; but 
  then discard each buffer of audio as soon as it's finished with that buffer. 
</p>
<p><a name="114181"> </a> As discussed in  
  
<a class="TutorialLink" target="_top" href="sampled-overview.html">Overview of the Sampled Package</a>,
a typical audio-input 
  system in an implementation of the Java 
  Sound API consists of: </p>

<ol>
<li><a name="113952"> </a>An input port, such as a microphone port or a line-in port, which feeds
its incoming audio data into:</li>
<li><a name="115691"> </a>A mixer, which places the input data in:</li>
<li><a name="115692"> </a>One or more target data lines, from which an application can retrieve the
data.</li>
</ol>

<p><a name="113956"> </a>
Commonly, only one input port can be open at a time, but an audio-input mixer
that mixes audio from multiple ports is also possible. Another scenario consists
of a mixer that has no ports but instead gets its audio input over a network. 
</p>
    <p><a name="113958"> </a> The <code>TargetDataLine</code> interface was introduced 
      briefly under 

<a class="TutorialLink" target="_top" href="sampled-overview.html#lineHierarchy">The Line Interface Hierarchy</a>.


      <code>TargetDataLine</code> is directly analogous to the <code>SourceDataLine</code> 
      interface, which was discussed extensively in 
<a class="TutorialLink" target="_top" href="playing.html">Playing Back Audio</a>.


Recall that the <code>SourceDataLine</code> 
      interface consists of: </p>

<ul>
<li><a name="113960"> </a>A <code>write</code> method to send audio to the mixer</li>

<li><a name="113961"> </a>An <code>available</code> method to determine how much data can be written
to the buffer without blocking</li>
</ul>

<p>
<a name="113963"> </a>
Similarly, <code>TargetDataLine</code> consists of: 
<ul>

<li><a name="113965"> </a>A <code>read </code>method to get audio from the mixer</li>

<li><a name="113966"> </a>An <code>available</code> method to determine how much data can be read from
the buffer without blocking</li> 
</ul>

<H2><a name="113969"> </a>Setting Up a TargetDataLine</H2>

<p><a name="113971"> </a> The process of obtaining a target data line was described 
  in 
<a class="TutorialLink" target="_top" href="accessing.html">Accessing Audio System Resources</a>  but we repeat it here for convenience: </p>
<div class="codeblock"><pre>
TargetDataLine line;
DataLine.Info info = new DataLine.Info(TargetDataLine.class, 
    format); // format is an AudioFormat object
if (!AudioSystem.isLineSupported(info)) {
    // Handle the error ... 

}
// Obtain and open the line.
try {
    line = (TargetDataLine) AudioSystem.getLine(info);
    line.open(format);
} catch (LineUnavailableException ex) {
    // Handle the error ... 
}
</pre></div>

<p><a name="113992"> </a>
You could instead invoke <code>Mixer's</code> <code>getLine</code> method, rather than <code>AudioSystem's</code>.

<p></p>
<p><a name="113994"> </a> As shown in this example, once you've obtained a target 
  data line, you reserve it for your application's use by invoking the <code>SourceDataLine</code> 
  method <code>open</code>, exactly as was described in the case of a source data 
  line in 

<a class="TutorialLink" target="_top" href="playing.html">Playing Back Audio</a>.
 
  The single-parameter version of the <code>open</code> method causes the line's 
  buffer to have the default size. You can instead set the buffer size according 
  to your application's needs by invoking the two-parameter version: 

<div class="codeblock"><pre>
void open(AudioFormat format, int bufferSize)
</pre></div>

<p></p><a name="115741"> </a>

<H2>Reading the Data from the TargetDataLine</H2>


<p><a name="114004"> </a>
Once the line is open, it is ready to start capturing data, but it isn't active yet. To actually commence the audio capture, use the <code>DataLine</code> method <code>start</code>. This begins delivering input audio data to the line's buffer for your application to read. Your application should invoke start only when it's ready to begin reading from the line; otherwise a lot of processing is wasted on filling the capture buffer, only to have it overflow (that is, discard data).
</p><p><a name="114006"> </a>

To start retrieving data from the buffer, invoke <code>TargetDataLine's</code> read method:
</p>

<div class="codeblock"><pre>
int read(byte[] b, int offset, int length)
</pre></div>

This method attempts to read <code>length</code> bytes of data into the array <code>b</code>, starting at the byte position <code>offset</code> in the array. The method returns the number of bytes actually read. 
<p></p><p><a name="114011"> </a>

As with <code>SourceDataLine's write</code> method, you can request more data than actually fits in the buffer, because the method blocks until the requested amount of data has been delivered, even if you request many buffers' worth of data. 
</p><p><a name="115205"> </a>
To avoid having your application hang during recording, you can invoke the read method within a loop, until you've retrieved all the audio input, as in this example:
</p>

<div class="codeblock"><pre>
// Assume that the TargetDataLine, line, has already
// been obtained and opened.
ByteArrayOutputStream out  = new ByteArrayOutputStream();
int numBytesRead;
byte[] data = new byte[line.getBufferSize() / 5];

// Begin audio capture.
line.start();

// Here, stopped is a global boolean set by another thread.
while (!stopped) {
   // Read the next chunk of data from the TargetDataLine.
   numBytesRead =  line.read(data, 0, data.length);
   // Save this chunk of data.
   out.write(data, 0, numBytesRead);
}     
</pre></div>

<p>
Notice that in this example, the size of the byte array into which the data is
read is set to be one-fifth the size of the line's buffer. If you instead make
it as big as the line's buffer and try to read the entire buffer, you need to
be very exact in your timing, because data will be dumped if the mixer needs
to deliver data to the line while you are reading from it. By using some
fraction of the line's buffer size, as shown here, your application will be
more successful in sharing access to the line's buffer with the mixer.</p>

<p><a name="114034"> </a>
The <code>read</code> method of <code>TargetDataLine</code> takes three arguments: a byte array, an offset into the array, and the number of bytes of input data that you would like to read. In this example, the third argument is simply the length of your byte array. The <code>read</code> method returns the number of bytes that were actually read into your array. 
</p>

<p><a name="114036"> </a> Typically, you read data from the line in a loop, as 
  in this example. Within the <code>while</code> loop, each chunk of retrieved 
  data is processed in whatever way is appropriate for the application&#151;here, 
  it's written to a <code>ByteArrayOutputStream</code>. Not shown here is the 
  use of a separate thread to set the boolean <code>stopped</code>, which terminates 
  the loop. This boolean's value might be set to <code>true</code> when the user 
  clicks a Stop button, and also when a listener receives a <code>CLOSE</code> 
  or <code>STOP</code> event from the line. The listener is necessary for <code>CLOSE</code> 
  events and recommended for <code>STOP</code> events. Otherwise, if the line 
  gets stopped somehow without stopped being set to <code>true</code>, the <code>while</code> 
  loop will capture zero bytes on each iteration, running fast and wasting CPU 
  cycles. A more thorough code example would show the loop being re-entered if 
  capture becomes active again. </p>

<p><a name="114039"> </a>
As with a source data line, it's possible to drain or flush a target data line. For example, if you're recording the input to a file, you'll probably want to invoke the <code>drain</code> method when the user clicks a Stop button. The <code>drain</code> method will cause the mixer's remaining data to get delivered to the target data line's buffer. If you don't drain the data, the captured sound might seem to be truncated prematurely at the end.
</p><p><a name="114041"> </a>
There might be some cases where you instead want to flush the data. In any case, if you neither flush nor drain the data, it will be left in the mixer. This means that when capture recommences, there will be some leftover sound at the beginning of the new recording, which might be undesirable. It can be useful, then, to flush the target data line before restarting the capture.
</p><a name="114432"> </a>

<H2>Monitoring the Line's Status</H2>

<p><a name="114046"> </a> Because the <code>TargetDataLine</code> interface extends 
  <code>DataLine</code>, target data lines generate events in the same way source 
  data lines do. You can register an object to receive events whenever the target 
  data line opens, closes, starts, or stops. For more information, see 
 the previous discussion of 

<a class="TutorialLink" target="_top" href="playing.html#113711">Monitoring a Line's Status</a>.

</p>

<a name="114049"> </a>

<H2>Processing the Incoming Audio</H2>

<p><a name="114051"> </a> Like some source data lines, some mixers' target data 
  lines have signal-processing controls, such as gain, pan, reverb, or sample-rate 
  controls. The input ports might have similar controls, especially gain controls. 
  In the next section, you'll learn how to determine whether a line has such controls, and 
  how to use them if it does.
  </p>

        </div>
        <div class=NavBit>
            <a target=_top href=playing.html>&laquo; Previous</a>
            &bull;
            <a target=_top href=./TOC.html>Trail</a>
            &bull;
            <a target=_top href=controls.html>Next &raquo;</a>
        </div>
    </div>
    <div id=Footer2>
<hr>
<div id=TagNotes>
    <p class="footertext">Problems with the examples? Try <a target="_blank"
        href=../information/run-examples.html>Compiling and Running
        the Examples: FAQs</a>.
    <br>
    Complaints? Compliments? Suggestions? <a target="_blank"
        href="http://download.oracle.com/javase/feedback.html">Give
    us your feedback</a>.
    </p>
</div> 

<div id=Footer>
<p class="footertext"><a name="license_info">Your use of this</a> page and all the material on pages under &quot;The Java Tutorials&quot; banner,
and all the material on pages under &quot;The Java Tutorials&quot; banner is subject to the <a href="../information/license.html">Java SE Tutorial Copyright
and License</a>.
Additionally, any example code contained in any of these Java
Tutorials pages is licensed under the
<a href="http://developers.sun.com/license/berkeley_license.html">Code
Sample License</a>.
</p>
<table border="0" cellspacing="0" cellpadding="5" summary="">
    <tr>
         <td headers="h1" width="20%">
	 <table width="100%" border="0" cellspacing="0" cellpadding="5">
            <tr>
              <td headers="h1" align="center"><img id=duke src=../images/DukeWave.gif width=55 height=55 alt="duke image"></td>
              <td headers="h2" align="left" valign="middle"><img id=oracle src=../images/logo_oracle_footer.gif width=100 height=29 alt="Oracle logo"></td>
           </tr>
          </table>
          </td>

          <td width="55%" valign="middle" align="center">
		<p class="footertext"><a href="http://www.oracle.com/us/corporate/index.html">About Oracle</a> | <a href="http://www.oracle.com/technology/index.html">Oracle Technology Network</a> | <a href="https://www.samplecode.oracle.com/servlets/CompulsoryClickThrough?type=TermsOfService">Terms of Service</a></p> 
	 </td>
          <td width="25%" valign="middle" align="right">
      		<p class="footertext">Copyright &copy; 1995, 2011 Oracle and/or its affiliates. All rights reserved.</p>
	 </td>
     </tr>     
</table>
</div>
    </div>
    <div class=PrintHeaders>
        <b>Previous page:</b> Playing Back Audio
        <br><b>Next page:</b> Processing Audio with Controls
    </div>

<!-- Start SiteCatalyst code   -->
<script language="JavaScript" src="http://www.oracle.com/ocom/groups/systemobject/@mktg_admin/documents/systemobject/s_code_download.js"></script>
<script language="JavaScript" src="http://www.oracle.com/ocom/groups/systemobject/@mktg_admin/documents/systemobject/s_code.js"></script>
<noscript> 
A browser with JavaScript enabled is required for this page to operate properly.
</noscript>
 
<!-- ********** DO NOT ALTER ANYTHING BELOW THIS LINE ! *********** -->
<!--  Below code will send the info to Omniture server -->
<script language="javascript">var s_code=s.t();if(s_code)document.write(s_code)</script>

 
<!-- End SiteCatalyst code -->

</body>
</html> 
