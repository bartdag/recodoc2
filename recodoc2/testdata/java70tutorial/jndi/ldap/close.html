




<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<html lang="en-US">
    <head>
        <title> Closing (The Java&trade; Tutorials &gt;        
            Java Naming and Directory Interface(TM). &gt; Advanced Topics for LDAP Users)
</title>

     <meta name="description" content="This JNDI Java tutorial describes Java Naming and Directory Interface (JNDI) technology, naming and directory operations, and LDAP" />
     <meta name="keywords" content="java programming, learn java, java sample code, jndi, ldap, jndi service provider" />
        
<style type="text/css">
    .FigureCaption   { 
        margin-left: 1in; 
        margin-right: 1in; 
        font-family: sans-serif; 
        font-size: smaller; 
        text-align: justify;
    }
    #TopBar_bl {
        background: url(../../images/java_bar_bl.gif) 0 100% no-repeat;
        width: 100%;
        height: 60px;
    }
    #TopBar_br {
        background: url(../../images/java_bar_br.gif) 100% 100% no-repeat;
        width: 100%;
        height: 60px;
    }
    #TopBar_tl {
        background: url(../../images/java_bar_tl.gif) 0 0 no-repeat;
        width: 100%;
        height: 60px;
    }
    #TopBar_tr {
        background: url(../../images/java_bar_tr.gif) 100% 0 no-repeat;
        width: 100%;
        height: 60px;
    }
    #TopBar {
        background: #35556B url(../../images/java_bar.gif);
        margin: 10px 10px 0 10px;
        height:60px;
        min-width:700px;
        color: white;
        font-family: sans-serif; 
        font-weight: bold;
    }
    @media print {
        #BreadCrumbs, #Download {
            display: none;
        }
    }
    #TopBar_right {
        line-height: 14px;
        float: right;
        padding-top: 2px;
        padding-right: 30px;
        text-align: center;
    }
    @media print {
        #TopBar_right {
            display: none;
        }
    }
    #TopBar_right a {
        font-size: 12px;
        margin: 3px;
        padding: 0;
    }
    #TopBar a:visited, #TopBar a:link {
        color: white;
        text-decoration: none;
    }
    #TopBar a:hover, #TopBar a:active  {
        background-color: white;
        color: #35556B;
    }
    #BreadCrumbs {
        padding: 4px 5px 0.5em 0;
        font-family: sans-serif; 
        float: right;
    }
    #BreadCrumbs a {
        color: blue;
    }
    #BreadCrumbs a:visited, #BreadCrumbs a:link {
        text-decoration: none;
    }
    #BreadCrumbs a:hover, #BreadCrumbs a:active {
        text-decoration: underline;
    }
    #PageTitle {
        margin: 0 5px 0.5em 0;
        color: #F90000;
    }    
    #PageContent{
        margin: 0 5px 0 20px;
    }
    .LeftBar_shown {
        width: 13em;
        float: left;
        margin-left: 10px;
        margin-top: 4px;
        margin-bottom: 2em;
        margin-right: 10px;
    }
    @media print {
        .LeftBar_shown {
            display: none;
        }
    }
    .LeftBar_hidden {
        display: none;
    }
    #Footer {
        padding-top: 10px;
        padding-left: 10px;
        margin-right: 10px;
    }
    
    .footertext {
        font-size: 10px;
        font-family: sans-serif; 
        margin-top: 1px;
    }
    
    #Footer2 {
        padding-top: 10px;
        padding-left: 10px;
        margin-right: 10px;
    }
    .NavBit  {
        padding: 4px 5px 0.5em 0;
        font-family: sans-serif; 
    }
    @media print {
        .NavBit {
            display: none;
        }
    }
    #TagNotes {
        text-align: right;        
    }
    
    @media print {
        #TagNotes a:visited, #TagNotes a:link {
            color: #35556B;
            text-decoration: none;
        }
    }
    #Contents a, .NavBit a, #TagNotes a {
        color: blue
    }
    #TagNotes a:visited, #TagNotes a:link,
    #Contents a:visited, #Contents a:link,
    .NavBit a:visited, .NavBit a:link {
        text-decoration: none;
    }
    #TagNotes a:hover, #TagNotes a:active,   
    #Contents a:hover, #Contents a:active,   
    .NavBit a:hover, .NavBit a:active {  
        text-decoration: underline;
    }
    #Contents {
        float: left;
        font-family: sans-serif; 
    }
    @media print {
        #Contents {
            display: none;
        }
    }
    @media screen {
        div.PrintHeaders {
            display: none;
        }
    }
    .linkLESSON, .nolinkLESSON {
        margin-left: 0.5em;
        text-indent: -0.5em
    }
    .linkAHEAD, .nolinkAHEAD, .linkQUESTIONS, .nolinkQUESTIONS   {
        margin-left: 1.5em; 
        text-indent: -0.5em
    }
    .linkBHEAD, .nolinkBHEAD   {
        margin-left: 2.5em;
        text-indent: -0.5em
    }
    .linkCHEAD, .nolinkCHEAD   {
        margin-left: 3.5em;
        text-indent: -0.5em
    }
    .nolinkLESSON, .nolinkAHEAD, .nolinkBHEAD, .nolinkCHEAD,
    .nolinkQUESTIONS {
        font-weight: bold;
        color: #F90000;
    }
    .MainFlow_indented {
        margin-right: 10px;
        margin-left: 15em;
        margin-bottom: 2em;

    }
    .MainFlow_wide {
        margin-right: 10px;
        margin-left: 10px;
        margin-bottom: 2em;

    }
    @media print {
        .MainFlow_indented, .MainFlow_wide {
            padding-top: 0;
            margin-top: 10px;
            margin-right: 10px;
            margin-left: 0;
        }
    }
    h1, h2, h3, h4, h5 {
        color: #F90000;
        font-family: sans-serif;
    }

    h1 {
        font-weight: bold;
        font-size: 20px;
    }

    h2 {
        font-weight: bold;
        font-size: 17px;
    }

    h3 {
        font-weight: bold;
        font-size: 14px;
    }

    h4 {
        font-size: 15px;
    }

    h5 {
        font-size: 12px;
    }


    #ToggleLeft {
        display: none;
    }
    
    .note {
        margin: 0 30px 0px 30px;
    }
    
    .codeblock {
        margin: 0 30px 0px 30px;
    }

    /t

</style>
<script type="text/javascript">
    function leftBar() {
        var nameq = 'tutorial_showLeftBar='
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
            var cookieString = cookies[i];
            while (cookieString.charAt(0) == ' ') {
                cookieString = cookieString.substring(1, cookieString.length);
            }
            if (cookieString.indexOf(nameq) == 0) {
                cookieValue =  cookieString.substring(nameq.length,
                        cookieString.length);
                return cookieValue == 'yes';
            }
        }
        return true;
    }

    function showLeft(b) {
        var contents = document.getElementById("LeftBar");
        var main = document.getElementById("MainFlow");
        var toggle = document.getElementById("ToggleLeft");
        if (b) {
            contents.className = "LeftBar_shown";
            main.className = "MainFlow_indented";
            toggle.innerHTML = "Hide the TOC";
            document.cookie = 'tutorial_showLeftBar=yes; path=/';
        } else {
            contents.className = "LeftBar_hidden";
            main.className = "MainFlow_wide";
            toggle.innerHTML = "Show the TOC";
            document.cookie = 'tutorial_showLeftBar=no; path=/';
        }
    }

    function toggleLeft() {
        showLeft(document.getElementById("LeftBar").className ==
                "LeftBar_hidden");
        document.getElementById("ToggleLeft").blur();
    }

    function load() {
        showLeft(leftBar());
        document.getElementById("ToggleLeft").style.display="inline";
    }
    
</script>
<noscript> 
A browser with JavaScript enabled is required for this page to operate properly.
</noscript>

    </head>
<body onload="load()">
    <div id=TopBar> <div id=TopBar_tr> <div id=TopBar_tl> <div id=TopBar_br> <div id=TopBar_bl> 
                        <div id=TopBar_right> 
                            <a target="_blank"
                                href="http://java.sun.com/javase/6/download.jsp">Download
                                the JDK</a>
                            <br>
                            <a href="../../search.html" target="_blank">Search the
                                Tutorials</a>
                            <br>
                            <a href="javascript:toggleLeft()"
                                id="ToggleLeft">Hide the TOC</a>
                        </div>
                    </div> </div> </div> </div> </div>
    <div class=PrintHeaders>
        <b>Trail:</b> Java Naming and Directory Interface(TM).
        <br><b>Lesson:</b> Advanced Topics for LDAP Users
        <br><b>Section:</b> Connection Management
    </div>

    <div id=LeftBar class=LeftBar_shown>
        <div id=Contents>
            <div class="linkLESSON"><a href="index.html">Advanced Topics for LDAP Users</a></div>
<div class="linkAHEAD"><a href="ldap.html">LDAP v3</a></div>
<div class="linkAHEAD"><a href="jndi.html">JNDI as an LDAP API</a></div>
<div class="linkBHEAD"><a href="operations.html">How LDAP Operations Map to JNDI APIs</a></div>
<div class="linkBHEAD"><a href="exceptions.html">How LDAP Error Codes Map to JNDI Exceptions</a></div>
<div class="linkAHEAD"><a href="security.html">Security</a></div>
<div class="linkBHEAD"><a href="authentication.html">Modes of Authenticating to LDAP</a></div>
<div class="linkBHEAD"><a href="auth_mechs.html">Authentication Mechanisms</a></div>
<div class="linkBHEAD"><a href="anonymous.html">Anonymous</a></div>
<div class="linkBHEAD"><a href="simple.html">Simple</a></div>
<div class="linkBHEAD"><a href="sasl.html">SASL</a></div>
<div class="linkBHEAD"><a href="digest.html">Digest-MD5</a></div>
<div class="linkBHEAD"><a href="ssl.html">SSL and Custom Sockets</a></div>
<div class="linkAHEAD"><a href="rename.html">More LDAP Operations</a></div>
<div class="linkBHEAD"><a href="compare.html">LDAP Compare</a></div>
<div class="linkBHEAD"><a href="result.html">Search Results</a></div>
<div class="linkBHEAD"><a href="unsol.html"> LDAP Unsolicited Notifications</a></div>
<div class="linkAHEAD"><a href="connect.html">Connection Management</a></div>
<div class="linkBHEAD"><a href="create.html">Creation</a></div>
<div class="nolinkBHEAD"> Closing</div>
<div class="linkBHEAD"><a href="pool.html">Pooling</a></div>
<div class="linkBHEAD"><a href="config.html">Configuration</a></div>
<div class="linkAHEAD"><a href="faq.html">Frequently Asked Questions</a></div>
</div>
    </div>
    <div id=MainFlow class=MainFlow_indented>
            <span id=BreadCrumbs>
                <a href=../../index.html target=_top>Home Page</a>
                &gt;
                <a href=../index.html target=_top>Java Naming and Directory Interface(TM).</a>
                &gt;
                <a href=index.html target=_top>Advanced Topics for LDAP Users</a>
            </span>
            <div class=NavBit>
                <a target=_top href=create.html>&laquo;&nbsp;Previous</a>&nbsp;&bull;&nbsp;<a target=_top href=../TOC.html>Trail</a>&nbsp;&bull;&nbsp;<a target=_top href=pool.html>Next&nbsp;&raquo;</a>
            </div>
            <div id=PageTitle><h1> Closing</h1></div>
            <div id=PageContent>
Normal garbage collection takes care of removing <tt>Context</tt>
instances when they are no longer in use. Connections used by
<tt>Context</tt> instances being garbage collected will be closed
automatically. Therefore, you do not need to explicitly close
connections. Network connections, however, are limited resources and
for certain programs, you might want to have control over their
proliferation and usage.  This section contains information on how to
close connections and how to get notified if the server closes the
connection.

<h2>Explicit Closures</h2>

You invoke
<a class="APILink" target="_blank" href="http://download.oracle.com/javase/7/docs/api/javax/naming/Context.html#close()"><tt>Context.close()</tt></a>  on a <tt>Context</tt> instance to indicate that you no longer need to use it.

If the <tt>Context</tt> instance being closed is using a dedicated
connection, the connection is also closed.  If the <tt>Context</tt>
instance is sharing a connection with other <tt>Context</tt>
and unterminated <tt>NamingEnumeration</tt> instances, 
the connection will not be closed
until <tt>close()</tt> has been invoked on all such <tt>Context</tt> and
<tt>NamingEnumeration</tt> instances.
<p>
In the <a href=examples/Shared.java>example</a>
from the <a href=create.html#SHARE><tt>Connection Creation</tt></a> section,
all three <tt>Context</tt> instances must be closed before the underlying
connection is closed.
<div class="codeblock"><pre>
// Create initial context
DirContext ctx = new InitialDirContext(env);

// Get a copy of the same context
Context ctx2 = (Context)ctx.lookup("");

// Get a child context
Context ctx3 = (Context) ctx.lookup("ou=NewHires");

// do something useful with ctx, ctx2, ctx3

// Close the contexts when we're done
ctx.close();
ctx2.close();
ctx3.close();
</pre></div>

<h2>Forced Implicit Closures</h2>

As mentioned previously, 
for those <tt>Context</tt> and <tt>NamingEnumeration</tt>
instances that are no longer in scope,
the Java runtime system will eventually garbage collect them, thus
cleaning up the state that a <tt>close()</tt> would have done.
To force the garbage collection, you can use the following code.
<div class="codeblock"><pre>
Runtime.getRuntime().gc();
Runtime.getRuntime().runFinalization();
</pre></div>

Depending on the state of the program, performing this procedure can
cause serious (temporary) performance degradation.  If you need to
ensure that connections are closed, track <tt>Context</tt> instances
and close them explicitly.

<h2>Detecting Connection Closures</h2>

LDAP servers often have an idle timeout period after which they will
close connections no longer being used. 
When you subsequently invoke a method on
a <tt>Context</tt> instance that is using such a connection, 
the method will throw a 

<a class="APILink" target="_blank" href="http://download.oracle.com/javase/7/docs/api/javax/naming/CommunicationException.html"><tt>CommunicationException</tt></a>.

To detect when the server closes the connection that a
<tt>Context</tt> instance is using, you register an

<a class="APILink" target="_blank" href="http://download.oracle.com/javase/7/docs/api/javax/naming/ldap/UnsolicitedNotificationListener.html"><tt>UnsolicitedNotificationListener</tt></a>    with the <tt>Context</tt> instance.

<a href=examples/RegUnsol.java>An example</a> is shown in the LDAP Unsolicited 
Notifications section.

Although the example is designed for receiving unsolicited
notification from the server, it can also be used to detect connection
closures by the server.  After starting the program, stop the LDAP
server and observe that the listener's

<a class="APILink" target="_blank" href="http://download.oracle.com/javase/7/docs/api/javax/naming/event/NamingListener.html#namingExceptionThrown(javax.naming.event.NamingExceptionEvent)"><tt>namingExceptionThrown()</tt></a>   method gets called.
        </div>
        <div class=NavBit>
            <a target=_top href=create.html>&laquo; Previous</a>
            &bull;
            <a target=_top href=../TOC.html>Trail</a>
            &bull;
            <a target=_top href=pool.html>Next &raquo;</a>
        </div>
    </div>
    <div id=Footer2>
<hr>
<div id=TagNotes>
    <p class="footertext">Problems with the examples? Try <a target="_blank"
        href=../../information/run-examples.html>Compiling and Running
        the Examples: FAQs</a>.
    <br>
    Complaints? Compliments? Suggestions? <a target="_blank"
        href="http://download.oracle.com/javase/feedback.html">Give
    us your feedback</a>.
    </p>
</div> 

<div id=Footer>
<p class="footertext"><a name="license_info">Your use of this</a> page and all the material on pages under &quot;The Java Tutorials&quot; banner,
and all the material on pages under &quot;The Java Tutorials&quot; banner is subject to the <a href="../../information/license.html">Java SE Tutorial Copyright
and License</a>.
Additionally, any example code contained in any of these Java
Tutorials pages is licensed under the
<a href="http://developers.sun.com/license/berkeley_license.html">Code
Sample License</a>.
</p>
<table border="0" cellspacing="0" cellpadding="5" summary="">
    <tr>
         <td headers="h1" width="20%">
	 <table width="100%" border="0" cellspacing="0" cellpadding="5">
            <tr>
              <td headers="h1" align="center"><img id=duke src=../../images/DukeWave.gif width=55 height=55 alt="duke image"></td>
              <td headers="h2" align="left" valign="middle"><img id=oracle src=../../images/logo_oracle_footer.gif width=100 height=29 alt="Oracle logo"></td>
           </tr>
          </table>
          </td>

          <td width="55%" valign="middle" align="center">
		<p class="footertext"><a href="http://www.oracle.com/us/corporate/index.html">About Oracle</a> | <a href="http://www.oracle.com/technology/index.html">Oracle Technology Network</a> | <a href="https://www.samplecode.oracle.com/servlets/CompulsoryClickThrough?type=TermsOfService">Terms of Service</a></p> 
	 </td>
          <td width="25%" valign="middle" align="right">
      		<p class="footertext">Copyright &copy; 1995, 2011 Oracle and/or its affiliates. All rights reserved.</p>
	 </td>
     </tr>     
</table>
</div>
    </div>
    <div class=PrintHeaders>
        <b>Previous page:</b> Creation
        <br><b>Next page:</b> Pooling
    </div>

<!-- Start SiteCatalyst code   -->
<script language="JavaScript" src="http://www.oracle.com/ocom/groups/systemobject/@mktg_admin/documents/systemobject/s_code_download.js"></script>
<script language="JavaScript" src="http://www.oracle.com/ocom/groups/systemobject/@mktg_admin/documents/systemobject/s_code.js"></script>
<noscript> 
A browser with JavaScript enabled is required for this page to operate properly.
</noscript>
 
<!-- ********** DO NOT ALTER ANYTHING BELOW THIS LINE ! *********** -->
<!--  Below code will send the info to Omniture server -->
<script language="javascript">var s_code=s.t();if(s_code)document.write(s_code)</script>

 
<!-- End SiteCatalyst code -->

</body>
</html> 
