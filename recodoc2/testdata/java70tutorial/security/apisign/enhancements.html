 
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<html lang="en-US">
    <head>
        <title>Weaknesses and Alternatives (The Java&trade; Tutorials &gt;        
            Security Features in Java SE &gt; Generating and Verifying Signatures)
</title>

     <meta name="description" content="This security Java tutorial describes usage of digital signatures, keys, and cryptography services" />
     <meta name="keywords" content="java programming, learn java, java sample code, java security, cryptography, digital signature, verifying signature, signing code" />
        
<style type="text/css">
    .FigureCaption   { 
        margin-left: 1in; 
        margin-right: 1in; 
        font-family: sans-serif; 
        font-size: smaller; 
        text-align: justify;
    }
    #TopBar_bl {
        background: url(../../images/java_bar_bl.gif) 0 100% no-repeat;
        width: 100%;
        height: 60px;
    }
    #TopBar_br {
        background: url(../../images/java_bar_br.gif) 100% 100% no-repeat;
        width: 100%;
        height: 60px;
    }
    #TopBar_tl {
        background: url(../../images/java_bar_tl.gif) 0 0 no-repeat;
        width: 100%;
        height: 60px;
    }
    #TopBar_tr {
        background: url(../../images/java_bar_tr.gif) 100% 0 no-repeat;
        width: 100%;
        height: 60px;
    }
    #TopBar {
        background: #35556B url(../../images/java_bar.gif);
        margin: 10px 10px 0 10px;
        height:60px;
        min-width:700px;
        color: white;
        font-family: sans-serif; 
        font-weight: bold;
    }
    @media print {
        #BreadCrumbs, #Download {
            display: none;
        }
    }
    #TopBar_right {
        line-height: 14px;
        float: right;
        padding-top: 2px;
        padding-right: 30px;
        text-align: center;
    }
    @media print {
        #TopBar_right {
            display: none;
        }
    }
    #TopBar_right a {
        font-size: 12px;
        margin: 3px;
        padding: 0;
    }
    #TopBar a:visited, #TopBar a:link {
        color: white;
        text-decoration: none;
    }
    #TopBar a:hover, #TopBar a:active  {
        background-color: white;
        color: #35556B;
    }
    #BreadCrumbs {
        padding: 4px 5px 0.5em 0;
        font-family: sans-serif; 
        float: right;
    }
    #BreadCrumbs a {
        color: blue;
    }
    #BreadCrumbs a:visited, #BreadCrumbs a:link {
        text-decoration: none;
    }
    #BreadCrumbs a:hover, #BreadCrumbs a:active {
        text-decoration: underline;
    }
    #PageTitle {
        margin: 0 5px 0.5em 0;
        color: #F90000;
    }    
    #PageContent{
        margin: 0 5px 0 20px;
    }
    .LeftBar_shown {
        width: 13em;
        float: left;
        margin-left: 10px;
        margin-top: 4px;
        margin-bottom: 2em;
        margin-right: 10px;
    }
    @media print {
        .LeftBar_shown {
            display: none;
        }
    }
    .LeftBar_hidden {
        display: none;
    }
    #Footer {
        padding-top: 10px;
        padding-left: 10px;
        margin-right: 10px;
    }
    
    .footertext {
        font-size: 10px;
        font-family: sans-serif; 
        margin-top: 1px;
    }
    
    #Footer2 {
        padding-top: 10px;
        padding-left: 10px;
        margin-right: 10px;
    }
    .NavBit  {
        padding: 4px 5px 0.5em 0;
        font-family: sans-serif; 
    }
    @media print {
        .NavBit {
            display: none;
        }
    }
    #TagNotes {
        text-align: right;        
    }
    
    @media print {
        #TagNotes a:visited, #TagNotes a:link {
            color: #35556B;
            text-decoration: none;
        }
    }
    #Contents a, .NavBit a, #TagNotes a {
        color: blue
    }
    #TagNotes a:visited, #TagNotes a:link,
    #Contents a:visited, #Contents a:link,
    .NavBit a:visited, .NavBit a:link {
        text-decoration: none;
    }
    #TagNotes a:hover, #TagNotes a:active,   
    #Contents a:hover, #Contents a:active,   
    .NavBit a:hover, .NavBit a:active {  
        text-decoration: underline;
    }
    #Contents {
        float: left;
        font-family: sans-serif; 
    }
    @media print {
        #Contents {
            display: none;
        }
    }
    @media screen {
        div.PrintHeaders {
            display: none;
        }
    }
    .linkLESSON, .nolinkLESSON {
        margin-left: 0.5em;
        text-indent: -0.5em
    }
    .linkAHEAD, .nolinkAHEAD, .linkQUESTIONS, .nolinkQUESTIONS   {
        margin-left: 1.5em; 
        text-indent: -0.5em
    }
    .linkBHEAD, .nolinkBHEAD   {
        margin-left: 2.5em;
        text-indent: -0.5em
    }
    .linkCHEAD, .nolinkCHEAD   {
        margin-left: 3.5em;
        text-indent: -0.5em
    }
    .nolinkLESSON, .nolinkAHEAD, .nolinkBHEAD, .nolinkCHEAD,
    .nolinkQUESTIONS {
        font-weight: bold;
        color: #F90000;
    }
    .MainFlow_indented {
        margin-right: 10px;
        margin-left: 15em;
        margin-bottom: 2em;

    }
    .MainFlow_wide {
        margin-right: 10px;
        margin-left: 10px;
        margin-bottom: 2em;

    }
    @media print {
        .MainFlow_indented, .MainFlow_wide {
            padding-top: 0;
            margin-top: 10px;
            margin-right: 10px;
            margin-left: 0;
        }
    }
    h1, h2, h3, h4, h5 {
        color: #F90000;
        font-family: sans-serif;
    }

    h1 {
        font-weight: bold;
        font-size: 20px;
    }

    h2 {
        font-weight: bold;
        font-size: 17px;
    }

    h3 {
        font-weight: bold;
        font-size: 14px;
    }

    h4 {
        font-size: 15px;
    }

    h5 {
        font-size: 12px;
    }


    #ToggleLeft {
        display: none;
    }
    
    .note {
        margin: 0 30px 0px 30px;
    }
    
    .codeblock {
        margin: 0 30px 0px 30px;
    }

    /t

</style>
<script type="text/javascript">
    function leftBar() {
        var nameq = 'tutorial_showLeftBar='
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
            var cookieString = cookies[i];
            while (cookieString.charAt(0) == ' ') {
                cookieString = cookieString.substring(1, cookieString.length);
            }
            if (cookieString.indexOf(nameq) == 0) {
                cookieValue =  cookieString.substring(nameq.length,
                        cookieString.length);
                return cookieValue == 'yes';
            }
        }
        return true;
    }

    function showLeft(b) {
        var contents = document.getElementById("LeftBar");
        var main = document.getElementById("MainFlow");
        var toggle = document.getElementById("ToggleLeft");
        if (b) {
            contents.className = "LeftBar_shown";
            main.className = "MainFlow_indented";
            toggle.innerHTML = "Hide the TOC";
            document.cookie = 'tutorial_showLeftBar=yes; path=/';
        } else {
            contents.className = "LeftBar_hidden";
            main.className = "MainFlow_wide";
            toggle.innerHTML = "Show the TOC";
            document.cookie = 'tutorial_showLeftBar=no; path=/';
        }
    }

    function toggleLeft() {
        showLeft(document.getElementById("LeftBar").className ==
                "LeftBar_hidden");
        document.getElementById("ToggleLeft").blur();
    }

    function load() {
        showLeft(leftBar());
        document.getElementById("ToggleLeft").style.display="inline";
    }
    
</script>
<noscript> 
A browser with JavaScript enabled is required for this page to operate properly.
</noscript>

    </head>
<body onload="load()">
    <div id=TopBar> <div id=TopBar_tr> <div id=TopBar_tl> <div id=TopBar_br> <div id=TopBar_bl> 
                        <div id=TopBar_right> 
                            <a target="_blank"
                                href="http://java.sun.com/javase/6/download.jsp">Download
                                the JDK</a>
                            <br>
                            <a href="../../search.html" target="_blank">Search the
                                Tutorials</a>
                            <br>
                            <a href="javascript:toggleLeft()"
                                id="ToggleLeft">Hide the TOC</a>
                        </div>
                    </div> </div> </div> </div> </div>
    <div class=PrintHeaders>
        <b>Trail:</b> Security Features in Java SE
        <br><b>Lesson:</b> Generating and Verifying Signatures
    </div>

    <div id=LeftBar class=LeftBar_shown>
        <div id=Contents>
            <div class="linkLESSON"><a href="index.html">Generating and Verifying Signatures</a></div>
<div class="linkAHEAD"><a href="gensig.html">Generating a Digital Signature</a></div>
<div class="linkBHEAD"><a href="step1.html">Prepare Initial Program Structure</a></div>
<div class="linkBHEAD"><a href="step2.html">Generate Public and Private Keys</a></div>
<div class="linkBHEAD"><a href="step3.html">Sign the Data</a></div>
<div class="linkBHEAD"><a href="step4.html">Save the Signature and the Public Key in Files</a></div>
<div class="linkBHEAD"><a href="step5.html">Compile and Run the Program</a></div>
<div class="linkAHEAD"><a href="versig.html">Verifying a Digital Signature</a></div>
<div class="linkBHEAD"><a href="vstep1.html">Prepare Initial Program Structure</a></div>
<div class="linkBHEAD"><a href="vstep2.html">Input and Convert the Encoded Public Key Bytes</a></div>
<div class="linkBHEAD"><a href="vstep3.html">Input the Signature Bytes</a></div>
<div class="linkBHEAD"><a href="vstep4.html">Verify the Signature</a></div>
<div class="linkBHEAD"><a href="vstep5.html">Compile and Run the Program</a></div>
<div class="nolinkAHEAD">Weaknesses and Alternatives</div>
</div>
    </div>
    <div id=MainFlow class=MainFlow_indented>
            <span id=BreadCrumbs>
                <a href=../../index.html target=_top>Home Page</a>
                &gt;
                <a href=../index.html target=_top>Security Features in Java SE</a>
                &gt;
                <a href=index.html target=_top>Generating and Verifying Signatures</a>
            </span>
            <div class=NavBit>
                <a target=_top href=vstep5.html>&laquo;&nbsp;Previous</a>&nbsp;&bull;&nbsp;<a target=_top href=../TOC.html>Trail</a>&nbsp;&bull;&nbsp;<a target=_top href=../userperm/index.html>Next&nbsp;&raquo;</a>
            </div>
            <div id=PageTitle><h1>Weaknesses and Alternatives</h1></div>
            <div id=PageContent>
The  <code>GenSig</code> and <code>VerSig</code> programs
in this lesson illustrate the use of the JDK Security API
to generate a digital signature for
data and to verify that a signature is authentic.
However, the actual scenario depicted by those
programs, in which
a sender uses the JDK Security API to generate a new public/private key pair,
the sender stores the encoded public key bytes in a file, and
the receiver reads in the key bytes,
is not necessarily realistic, and has a potential major flaw.

<p>In many cases the keys do not need to be generated; they already exist,
either as encoded keys in files or as entries in a keystore.

<p>The potential major flaw is that nothing guarantees the
authenticity of the public key the receiver receives, and
the <code>VerSig</code> program 
correctly verifies the authenticity of a signature only if the
public key it is supplied is <i>itself</i> authentic!


<h2>Working with Encoded Key Bytes</h2>

Sometimes encoded key bytes already exist in files for the key pair
to be used for signing and verification. 
If that's the case the <code>GenSig</code> program can import the 
encoded private key bytes and convert them to a <code>PrivateKey</code>
needed for signing, via the following, assuming that the name of the file containing
the private key bytes is in the <code>privkeyfile</code> <code>String</code>
and that the bytes 
represent a DSA key that has been encoded by using the PKCS #8 standard.

<div class="codeblock"><pre>
    FileInputStream keyfis = new FileInputStream(privkeyfile);
    byte[] encKey = new byte[keyfis.available()];
    keyfis.read(encKey);
    keyfis.close();

    PKCS8EncodedKeySpec privKeySpec = new PKCS8EncodedKeySpec(encKey);

    KeyFactory keyFactory = KeyFactory.getInstance("DSA");
    PrivateKey privKey = keyFactory.generatePrivate(privKeySpec);
</pre></div>

<code>GenSig</code> no longer needs to save the public key bytes 
in a file, as they're already in one.

<p>In this case the sender sends the receiver

<ul>
<li>the already existing file containing the encoded public key
bytes (unless the receiver already has this) and</li>
<li>the data file and the signature file exported by <code>GenSig</code>.</li>
</ul>

<p>The <code>VerSig</code> program remains unchanged, as it already
expects encoded public key bytes in a file.

<p>But what about the potential problem of a malicious user
intercepting the files and replacing them all in such a way that their
switch cannot be detected?
In some cases this is not an issue, because
people have already exchanged public keys face to face or via a
trusted third party that does the face-to-face exchange. After that,
multiple subsequent file and signature exchanges may be done remotely
(that is, between two people in different locations),
and the public keys may be used to verify their authenticity. If a malicious user
tries to change the data or signature, this is detected by <code>VerSig</code>.

<p>If a face-to-face key exchange is not possible, you can try
other methods of increasing the likelihood of proper receipt.
For example, you could
send your public key via the most secure method possible
prior to subsequent exchanges of data and signature files,
perhaps using less secure mediums.

<p>In general, sending the data and the signature 
separately from your public key greatly reduces the likelihood of an attack. 
Unless all three files are changed, and in
a certain manner discussed in the next paragraph,
<code>VerSig</code> will detect any tampering.

<p>If all three files (data document, public key, and signature) were intercepted by a malicious user,
that person could replace the document with something else, 
sign it with a private key, and forward on to you the replaced 
document, the
new signature, and the public key corresponding to the private key
used to generate the new signature. Then <code>VerSig</code>
would report a successful verification, and you'd think that the
document came from the original sender. Thus you should take
steps to ensure that at least the public key is received intact
(<code>VerSig</code> detects any tampering of the other files),
or you can use certificates to facilitate authentication of
the public key, as described in the next section.






<h2>Working with Certificates</h2>



<p>It is more common in cryptography to exchange <i>certificates</i> 
containing public keys rather than the keys themselves.

<p>One benefit is that a certificate is signed by one entity (the
<i>issuer</i>) to verify that the enclosed public key is the actual 
public key of another entity (the <i>subject</i> or <i>owner</i>). 
Typically a trusted third-party <I>certification authority</I> (CA) 
verifies the identity of the subject and then vouches for its
being the owner of the public key by signing the certificate.

<p>Another benefit of using certificates is that you can check to ensure
the validity of a certificate you received by
verifying its digital signature, using its issuer's (signer's) public key, which
itself may be stored in a certificate whose signature can be verified
by using the public key of that certificate issuer; that public key itself 
may be stored in a certificate, and so on, until you reach a public key 
that you already trust.

<p>If you cannot establish a trust chain (perhaps because the required 
issuer certificates are not available to you), 
the certificate <b>fingerprint(s)</b> can be calculated.
Each fingerprint is a relatively short number that uniquely and 
reliably identifies the certificate. (Technically it's a
hash value of the certificate information, using a message digest,
also known as a one-way hash function.)
You can call up the
certificate owner and compare the fingerprints of the certificate you
received with the ones sent. If they're the same, the certificates are the 
same.

<p>It would be more secure for <code>GenSig</code> to create a 
certificate containing the public key and for <code>VerSig</code>
to then import the certificate and extract the public key. 
However, the JDK has no public certificate
APIs that would allow you to create a certificate from a public
key, so the <code>GenSig</code> program cannot create 
a certificate from the public key it generated. 
(There <i>are</i> public APIs for extracting a public
key from a certificate, though.)

<p>If you want, you can use the various security tools, not
APIs, to sign your important document(s) and work with certificates 
from a keystore, as was done in the

<a class="TutorialLink" target="_top" href="../toolfilex/index.html">Exchanging Files</a>
lesson.

<p>Alternatively you can use the API to modify your programs to
work with an already existing
private key and corresponding public key (in a certificate)
from your keystore.
To start, modify the <code>GenSig</code> program to extract a private
key from a keystore rather than generate new keys. First, let's assume the following:</P>

<ul>
<li>The keystore name is in the <code>String</code> <code>ksName</code></li>
<li>The keystore type is "JKS", the proprietary type created by Sun Microsystems</li>
<li>The keystore password is in the char array <code>spass</code></li>
<li>The alias to the keystore entry containing the private key,
and the public key certificate is in the <code>String</code> <code>alias</code></li>
<li>The private key password is in the char array <code>kpass</code></li>
</ul>

Then you can extract the private
key from the keystore via the following.

<div class="codeblock"><pre>
    KeyStore ks = KeyStore.getInstance("JKS");
    FileInputStream ksfis = new FileInputStream(ksName); 
    BufferedInputStream ksbufin = new BufferedInputStream(ksfis);

    ks.load(ksbufin, spass);
    PrivateKey priv = (PrivateKey) ks.getKey(alias, kpass);
</pre></div>

You can extract the public key certificate from the keystore
and save its encoded bytes to a file named <code>suecert</code>, via the following.

<div class="codeblock"><pre>
    java.security.cert.Certificate cert = ks.getCertificate(alias);
    byte[] encodedCert = cert.getEncoded();

    /* save the certificate in a file named "suecert" */
    FileOutputStream certfos = new FileOutputStream("suecert");
    certfos.write(encodedCert);
    certfos.close();
</pre></div>

Then you send the data file, the signature, and the certificate
to the receiver. The receiver verifes the authenticity of the
certificate by first getting the certificate's fingerprints, via the
<code>keytool -printcert</code> command.

<div class="codeblock"><pre>
<b>keytool -printcert -file suecert</b>
  Owner: CN=Susan Jones, OU=Purchasing, O=ABC, L=Cupertino, ST=CA, C=US
  Issuer: CN=Susan Jones, OU=Purchasing, O=ABC, L=Cupertino, ST=CA, C=US
  Serial number: 35aaed17
  Valid from: Mon Jul 13 22:31:03 PDT 1998 until:
  Sun Oct 11 22:31:03 PDT 1998
  Certificate fingerprints:
       MD5:  1E:B8:04:59:86:7A:78:6B:40:AC:64:89:2C:0F:DD:13
       SHA1: 1C:79:BD:26:A1:34:C0:0A:30:63:11:6A:F2:B9:67:DF:E5:8D:7B:5E
</pre></div>

Then the receiver verifies the fingerprints, 
perhaps by calling the sender up 
and comparing them with those of the sender's certificate or by
looking them up in a public repository.

<p>The receiver's verification program (a modified <code>VerSig</code>)
can then import
the certificate and extract the public key from it
via the following, assuming that the certificate file
name (for example, <code>suecert</code>) is in the 
<code>String</code> <code>certName</code>.

<div class="codeblock"><pre>
FileInputStream certfis = new FileInputStream(certName);
java.security.cert.CertificateFactory cf =
	java.security.cert.CertificateFactory.getInstance("X.509");
java.security.cert.Certificate cert = cf.generateCertificate(certfis);
PublicKey pub = cert.getPublicKey();
</pre></div>



<h2>Ensuring Data Confidentiality</h2>



Suppose that you want to keep the contents of the data confidential so people 
accidentally or maliciously trying to view it in transit (or on your own machine 
or disk) cannot do so. To keep the data confidential, you should
encrypt it and store and send only the encryption result (referred to as
<i>ciphertext</i>). The receiver can decrypt the ciphertext to obtain a
copy of the original data.

<!-- 
<p>APIs for data encryption and decryption, together with
some default algorithm implementations, are released 
separately in the Java
Cryptography Extension (JCE), an add-on package to the JDK, in
accordance with U.S. export control regulations.
-->


        </div>
        <div class=NavBit>
            <a target=_top href=vstep5.html>&laquo; Previous</a>
            &bull;
            <a target=_top href=../TOC.html>Trail</a>
            &bull;
            <a target=_top href=../userperm/index.html>Next &raquo;</a>
        </div>
    </div>
    <div id=Footer2>
<hr>
<div id=TagNotes>
    <p class="footertext">Problems with the examples? Try <a target="_blank"
        href=../../information/run-examples.html>Compiling and Running
        the Examples: FAQs</a>.
    <br>
    Complaints? Compliments? Suggestions? <a target="_blank"
        href="http://download.oracle.com/javase/feedback.html">Give
    us your feedback</a>.
    </p>
</div> 

<div id=Footer>
<p class="footertext"><a name="license_info">Your use of this</a> page and all the material on pages under &quot;The Java Tutorials&quot; banner,
and all the material on pages under &quot;The Java Tutorials&quot; banner is subject to the <a href="../../information/license.html">Java SE Tutorial Copyright
and License</a>.
Additionally, any example code contained in any of these Java
Tutorials pages is licensed under the
<a href="http://developers.sun.com/license/berkeley_license.html">Code
Sample License</a>.
</p>
<table border="0" cellspacing="0" cellpadding="5" summary="">
    <tr>
         <td headers="h1" width="20%">
	 <table width="100%" border="0" cellspacing="0" cellpadding="5">
            <tr>
              <td headers="h1" align="center"><img id=duke src=../../images/DukeWave.gif width=55 height=55 alt="duke image"></td>
              <td headers="h2" align="left" valign="middle"><img id=oracle src=../../images/logo_oracle_footer.gif width=100 height=29 alt="Oracle logo"></td>
           </tr>
          </table>
          </td>

          <td width="55%" valign="middle" align="center">
		<p class="footertext"><a href="http://www.oracle.com/us/corporate/index.html">About Oracle</a> | <a href="http://www.oracle.com/technology/index.html">Oracle Technology Network</a> | <a href="https://www.samplecode.oracle.com/servlets/CompulsoryClickThrough?type=TermsOfService">Terms of Service</a></p> 
	 </td>
          <td width="25%" valign="middle" align="right">
      		<p class="footertext">Copyright &copy; 1995, 2011 Oracle and/or its affiliates. All rights reserved.</p>
	 </td>
     </tr>     
</table>
</div>
    </div>
    <div class=PrintHeaders>
        <b>Previous page:</b> Compile and Run the Program
        <br><b>Next page:</b> Implementing Your Own Permission
    </div>

<!-- Start SiteCatalyst code   -->
<script language="JavaScript" src="http://www.oracle.com/ocom/groups/systemobject/@mktg_admin/documents/systemobject/s_code_download.js"></script>
<script language="JavaScript" src="http://www.oracle.com/ocom/groups/systemobject/@mktg_admin/documents/systemobject/s_code.js"></script>
<noscript> 
A browser with JavaScript enabled is required for this page to operate properly.
</noscript>
 
<!-- ********** DO NOT ALTER ANYTHING BELOW THIS LINE ! *********** -->
<!--  Below code will send the info to Omniture server -->
<script language="javascript">var s_code=s.t();if(s_code)document.write(s_code)</script>

 
<!-- End SiteCatalyst code -->

</body>
</html> 
